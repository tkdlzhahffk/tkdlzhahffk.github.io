/*! tw2overflow.min.js@2.0.0rc7 | Licence: WTFPL */
define("Lockr",function(e,t){"use strict";return t.prefix="",t._getPrefixedKey=function(e,t){return(t=t||{}).noPrefix?e:this.prefix+e},t.set=function(e,t,i){var a=this._getPrefixedKey(e,i);try{localStorage.setItem(a,JSON.stringify({data:t}))}catch(e){}},t.get=function(e,t,i){var a,n=this._getPrefixedKey(e,i);try{a=JSON.parse(localStorage.getItem(n))}catch(e){a=localStorage[n]?{data:localStorage.getItem(n)}:null}return null===a?t:"object"==typeof a&&void 0!==a.data?a.data:t},t}(0,{})),function(e,t){var i=injector.get("$rootScope"),a=injector.get("transferredSharedDataService"),n=injector.get("modelDataService"),o=injector.get("socketService"),l=injector.get("routeProvider"),r=injector.get("eventTypeProvider"),s=injector.get("windowDisplayService"),c=injector.get("windowManagerService"),d=(injector.get("hotkeys"),injector.get("armyService")),u=injector.get("villageService"),g=injector.get("mapService"),_=injector.get("$filter"),p=(injector.get("$timeout"),injector.get("storageService"));define("two/EventScope",["queues/EventQueue"],function(e){var t=function(e,t){if(void 0===e)throw new Error("EventScope: no windowId");this.windowId=e,this.onDestroy=t||function(){},this.listeners=[];var a=i.$on(r.WINDOW_CLOSED,(e,t)=>{t==="!"+this.windowId&&(this.destroy(),a())})};return t.prototype.register=function(t,a,n){n?this.listeners.push(i.$on(t,a)):(e.register(t,a),this.listeners.push(function(){e.unregister(t,a)}))},t.prototype.destroy=function(){this.listeners.forEach(e=>{e(),this.onDestroy()})},t}),define("two/utils",["helper/time","helper/math"],function(e,t){var a={randomSeconds:function(e){var t=(e=parseInt(e,10))+e/2,i=e-e/2;return Math.round(Math.random()*(t-i)+i)},time2seconds:function(e){return(e=e.split(":"))[0]=60*parseInt(e[0],10)*60,e[1]=60*parseInt(e[1],10),e[2]=parseInt(e[2],10),e.reduce(function(e,t){return e+t})},emitNotif:function(e,t){var a="success"===e?r.MESSAGE_SUCCESS:r.MESSAGE_ERROR;i.$broadcast(a,{message:t})},genVillageLabel:function(e){return e.name+" ("+e.x+"|"+e.y+")"},isValidCoords:function(e){return/\s*\d{2,3}\|\d{2,3}\s*/.test(e)},isValidDateTime:function(e){return/^\s*([01][0-9]|2[0-3]):[0-5]\d:[0-5]\d(:\d{1,3})? (0[1-9]|[12][0-9]|3[0-1])\/(0[1-9]|1[0-2])\/\d{4}\s*$/.test(e)},fixDate:function(e){var t=e.split(" "),i=t[0],a=t[1].split("/");return i+" "+a[1]+"/"+a[0]+"/"+a[2]},guid:function(){return Math.floor(16777216*Math.random()).toString(16)},matchesElem:function(e,t){return!!$(e).parents(t).length},getTimeFromString:function(e,t){var i=e.trim().split(" "),a=i[0].split(":"),n=i[1].split("/"),o=a[0],l=a[1],r=a[2],s=a[3]||null,c=parseInt(n[0],10)-1,d=n[1],u=n[2];return(n=new Date(u,c,d,o,l,r,s)).getTime()+(t||0)},formatDate:function(e,t){return _("readableDateFilter")(e,null,i.GAME_TIMEZONE,i.GAME_TIME_OFFSET,t||"HH:mm:ss dd/MM/yyyy")},getTimeOffset:function(){return 1e3*e.gameDate().getTimezoneOffset()*60+i.GAME_TIME_OFFSET},xhrGet:function(e,t,i){if(!e)return!1;var a;i=i||"text",t=t||function(){},(a=new XMLHttpRequest).open("GET",e,!0),a.responseType=i,a.addEventListener("load",function(){t(a.response)},!1),a.send()},obj2selectOptions:function(e,t){var i,a,n=[];for(a in e)i={name:e[a].name,value:e[a].id},t&&(i.leftIcon=e[a].icon),n.push(i);return n},getTravelTime:function(e,i,a,o,l){var r=!1,s=null===i.character_id,c=i.character_id&&i.tribe_id&&i.tribe_id===n.getSelectedCharacter().getTribeId();"attack"===o?("supporter"in l&&delete l.supporter,s&&(r=!0)):"support"===o&&(c&&(r=!0),"supporter"in l&&(r=!0));var u={units:a,officers:angular.copy(l)},g=d.calculateTravelTime(u,{barbarian:s,ownTribe:c,officers:l,effects:r},o),_=t.actualDistance(e,i);return 1e3*d.getTravelTimeForDistance(u,g,_,o)}};return a}),define("two/ready",["conf/gameStates"],function(e){var t=function(o,l){l=l||["map"];var s=function(e){(l=l.filter(function(t){return t!==e})).length||o()},c={map:function(){if(a.getSharedData("MapController").isInitialized)return s("map");i.$on(r.MAP_INITIALIZED,function(){s("map")})},tribe_relations:function(){var e=n.getSelectedCharacter();if(e){var t=e.getTribeRelations();if(!e.getTribeId()||t)return s("tribe_relations")}var a=i.$on(r.TRIBE_RELATION_LIST,function(){a(),s("tribe_relations")})},initial_village:function(){if(n.getGameState().getGameState(e.INITIAL_VILLAGE_READY))return s("initial_village");i.$on(r.GAME_STATE_INITIAL_VILLAGE_READY,function(){s("initial_village")})},all_villages_ready:function(){if(n.getGameState().getGameState(e.ALL_VILLAGES_READY))return s("all_villages_ready");i.$on(r.GAME_STATE_ALL_VILLAGES_READY,function(){s("all_villages_ready")})}};if(!a.getSharedData("MapController"))return setTimeout(function(){t(o,l)},100);l.forEach(function(e){c[e]()})};return t}),require(["two/ready","Lockr"],function(e,t){e(function(){var e=n.getSelectedCharacter();t.prefix=e.getId()+"_twOverflow_"+e.getWorldId()+"-"})}),define("two/language",["helper/i18n"],function(e){var t,a=!1,n={},o={en_dk:"en_us",pt_pt:"pt_br"},l=function(i){if(!a)throw new Error("Language module not initialized.");if(!(i in n))throw new Error("Language data for "+i+" does not exists.");var o=n[i][t]||n[i].en_us;e.setJSON(o)},r=function(e){(t=e)in o&&(t=o[t])},s={add:function(e,t){if(a||s.init(),e in n)return console.log("Language data for "+e+" already exists. Ignoring..."),!1;n[e]=t,l(e)},init:function(){if(a)return!1;a=!0,t=r(i.loc.ale),i.$watch("loc.ale",function(){var e;for(e in r(i.loc.ale),n)l(e)})}};return s}),require(["two/language","two/ready"],function(e,t){t(function(){e.add("core",{en_us:{common:{start:"Start",started:"Started",pause:"Pause",paused:"Paused",stop:"Stop",stopped:"Stopped",status:"Status",none:"None",info:"Information",settings:"Settings",others:"Others",village:"Village",villages:"Villages",building:"Building",buildings:"Buildings",level:"Level",registers:"Registers",filters:"Filters",add:"Add",waiting:"Waiting",attack:"Attack",support:"Support",relocate:"Transfer",activate:"Enable",deactivate:"Disable",units:"Units",officers:"Officers",origin:"Origin",target:"Target",save:"Save",logs:"Logs",headquarter:"Headquarters",barracks:"Barracks",tavern:"Tavern",hospital:"Hospital",preceptory:"Hall of Orders",chapel:"Chapel",church:"Church",academy:"Academy",rally_point:"Rally Point",statue:"Statue",market:"Market",timber_camp:"Timber Camp",clay_pit:"Clay Pit",iron_mine:"Iron Mine",farm:"Farm",warehouse:"Warehouse",wall:"Wall",spear:"Spearman",sword:"Swordsman",axe:"Axe Fighter",archer:"Archer",light_cavalry:"Light Cavalry",mounted_archer:"Mounted Archer",heavy_cavalry:"Heavy Cavalry",ram:"Ram",catapult:"Catapult",doppelsoldner:"Berserker",trebuchet:"Trebuchet",snob:"Nobleman",knight:"Paladin","no-results":"No results...",selected:"Selected",now:"Now",costs:"Costs",duration:"Duration",points:"Points",player:"Player",players:"Players",next_features:"Next features",misc:"Miscellaneous",colors:"Colors",reset:"Reset",here:"here",disabled:"�� Disabled ��",cancel:"Cancel",actions:"Actions",remove:"Remove",started_at:"Started at",arrive:"Arrive"}},pl_pl:{common:{start:"Start",started:"Uruchomiony",pause:"Pauza",paused:"Wstrzymany",stop:"Zatrzymany",stopped:"Zatrzymany",status:"Status",none:"탈aden",info:"Informacje",settings:"Ustawienia",others:"Inne",village:"Wioska",villages:"Wioski",building:"Budynek",buildings:"Budynki",level:"Poziom",registers:"Rejestry",filters:"Filtry",add:"Dodaj",waiting:"Oczekuj훳ce",attack:"Atak",support:"Wsparcie",relocate:"Przeniesienie",activate:"W흢훳cz",deactivate:"Wy흢훳cz",units:"Jednostki",officers:"Oficerowie",origin:"탁r처d흢o",target:"Cel",save:"Zapisz",logs:"Logi",headquarter:"Ratusz",barracks:"Koszary",tavern:"Tawerna",hospital:"Szpital",preceptory:"Komturia",chapel:"Kaplica",church:"Ko힄ci처흢",academy:"Akademia",rally_point:"Plac",statue:"Piedesta흢",market:"Rynek",timber_camp:"Tartak",clay_pit:"Kopalnia gliny",iron_mine:"Huta 탉elaza",farm:"Farma",warehouse:"Magazyn",wall:"Mur",spear:"Pikinier",sword:"Miecznik",axe:"Topornik",archer:"흟ucznik",light_cavalry:"Lekki kawalerzysta",mounted_archer:"흟ucznik konny",heavy_cavalry:"Ci휌탉ki kawalerzysta",ram:"Taran",catapult:"Katapulta",doppelsoldner:"Berserker",trebuchet:"Trebusz",snob:"Szlachcic",knight:"Rycerz","no-results":"Brak wynik처w...",selected:"Wybrana",now:"Teraz",costs:"Koszty",duration:"Czas trwania",points:"Punkty",player:"Gracz",players:"Gracze",next_features:"Nast휌pne funkcje",misc:"R처탉ne",colors:"Kolory",reset:"Reset",here:"here",disabled:"�� Wy흢훳czony ��",cancel:"Cancel",actions:"Actions",remove:"Remove",started_at:"Started at",arrive:"Arrive"}},pt_br:{common:{start:"Iniciar",started:"Iniciado",pause:"Pausar",paused:"Pausado",stop:"Parar",stopped:"Parado",status:"Status",none:"Nenhum",info:"Informa챌천es",settings:"Configura챌천es",others:"Outros",village:"Aldeia",villages:"Aldeias",building:"Edif챠cio",buildings:"Edif챠cios",level:"N챠vel",registers:"Registros",filters:"Filtros",add:"Adicionar",waiting:"Em espera",attack:"Ataque",support:"Apoio",relocate:"Transfer챗ncia",activate:"Ativar",deactivate:"Desativar",units:"Unidades",officers:"Oficiais",origin:"Origem",target:"Alvo",save:"Salvar",logs:"Eventos",headquarter:"Edif챠cio Principal",barracks:"Quartel",tavern:"Taverna",hospital:"Hospital",preceptory:"Sal찾o das Ordens",chapel:"Capela",church:"Igreja",academy:"Academia",rally_point:"Ponto de Encontro",statue:"Est찼tua",market:"Mercado",timber_camp:"Bosque",clay_pit:"Po챌o de Argila",iron_mine:"Mina de Ferro",farm:"Fazenda",warehouse:"Armaz챕m",wall:"Muralha",spear:"Lanceiro",sword:"Espadachim",axe:"Viking",archer:"Arqueiro",light_cavalry:"Cavalaria Leve",mounted_archer:"Arqueiro Montado",heavy_cavalry:"Cavalaria Pesada",ram:"Ar챠ete",catapult:"Catapulta",doppelsoldner:"Berserker",trebuchet:"Trabuco",snob:"Nobre",knight:"Paladino","no-results":"Sem resultados...",selected:"Selecionado",now:"Agora",costs:"Custos",duration:"Dura챌찾o",points:"Pontos",player:"Jogador",players:"Jogadores",next_features:"Pr처ximas funcionalidades",misc:"Diversos",colors:"Cores",reset:"Resetar",here:"aqui",disabled:"�� Desativado ��",cancel:"Cancelar",actions:"A챌천es",remove:"Remover",started_at:"Iniciado em",arrive:"Chegada"}}})})}),define("two/attackView",["two/ready","two/utils","two/attackView/columnTypes","two/attackView/commandTypes","two/attackView/filterTypes","two/attackView/unitSpeedOrder","conf/unitTypes","Lockr","helper/math","helper/mapconvert","struct/MapData","queues/EventQueue","models/CommandModel"],function(e,t,a,s,c,d,u,g,_,p,m,E,v){var f,T,b=injector.get("overviewService"),h=[],A=!1,S={},w={},O={reverse:!1,column:a.TIME_COMPLETED},I="attack_view_filters",R={},x={},C=function(){var e,t,i=[c.COMMAND_TYPES],a=n.getSelectedVillage().getId(),o={};for(e=0;e<i.length;e++)for(t in S[i[e]])if(o[i[e]]||(o[i[e]]=[]),S[i[e]][t])switch(i[e]){case c.COMMAND_TYPES:t===s.ATTACK?o[i[e]].push(s.ATTACK):t===s.SUPPORT?o[i[e]].push(s.SUPPORT):t===s.RELOCATE&&o[i[e]].push(s.RELOCATE)}(w=o).village=S[c.VILLAGE]?[a]:[]},L=function(){q.loadCommands()},y=function(e,t){E.trigger(r.ATTACK_VIEW_COMMAND_CANCELLED,[t.id||t.command_id])},N=function(e,t){var i;for(i=0;i<h.length;i++)h[i].command_id===t.command_id&&h.splice(i,1);E.trigger(r.ATTACK_VIEW_COMMAND_IGNORED,[t.command_id])},M=function(e,t){var i;for(i=0;i<h.length;i++)h[i].target_village_id===t.village_id?(h[i].target_village_name=t.name,h[i].targetVillage.name=t.name):h[i].origin_village_id===t.village_id&&(h[i].origin_village_name=t.name,h[i].originVillage.name=t.name);E.trigger(r.ATTACK_VIEW_VILLAGE_RENAMED,[t])},D=function(e,t){w[c.VILLAGE].length&&(w[c.VILLAGE]=[t],q.loadCommands())},G=function(e){var i=e.model.duration,a={},n={x:e.origin_x,y:e.origin_y},o={x:e.target_x,y:e.target_y},l=[];return d.forEach(function(i){a[i]=1,l.push({unit:i,duration:t.getTravelTime(n,o,a,e.command_type,{})})}),(l=l.map(function(e){return e.duration=Math.abs(e.duration-i),e}).sort(function(e,t){return e.duration-t.duration}))[0].unit},P=function(e,t){var i,a;return e.sort(function(e,n){return i=_.actualDistance(t,e),a=_.actualDistance(t,n),i-a})},k=function(e,t){var i,a,o,l,r,s,c,d,u,g,_,E=0;if(m.hasTownDataInChunk(e.x,e.y)){if(i=m.loadTownData(e.x,e.y,25,25,25),a=[],[],l=[],r=[],s=[],u=n.getSelectedCharacter().getTribeId(),g=n.getSelectedCharacter().getId(),i.forEach(function(e){for(c in e.data)for(d in e.data[c])a.push(e.data[c][d])}),l=a.filter(function(e){return null===e.character_id&&e.id>0}),r=a.filter(function(t){return t.character_id===g&&e.id!==t.id}),u&&(s=a.filter(function(e){return u&&e.tribe_id===u})),l.length)o=P(l,e);else if(r.length)o=P(r,e);else{if(!s.length)return t(!1);o=P(s,e)}return t(o[0])}_=p.scaledGridCoordinates(e.x,e.y,25,25,25),m.loadTownDataAsync(e.x,e.y,25,25,function(){++E===_.length&&k(e,t)})},U=function(e){var t;for(h=e.commands,t=0;t<h.length;t++)b.formatCommand(h[t]),h[t].slowestUnit=G(h[t]);h=h.filter(function(e){return S[c.INCOMING_UNITS][e.slowestUnit]}),E.trigger(r.ATTACK_VIEW_COMMANDS_LOADED,[h])},q={loadCommands:function(){var e=f.getCommandListModel().getIncomingCommands().length,t=e>25?e:25;o.emit(l.OVERVIEW_GET_INCOMING,{count:t,offset:0,sorting:O.column,reverse:O.reverse?1:0,groups:[],command_types:w[c.COMMAND_TYPES],villages:w[c.VILLAGE]},U)},getCommands:function(){return h},getFilters:function(){return S},getSortings:function(){return O},toggleFilter:function(e,t){t?S[e][t]=!S[e][t]:S[e]=!S[e],C(),g.set(I,S),q.loadCommands()},toggleSorting:function(e){e===O.column?O.reverse=!O.reverse:(O.column=e,O.reverse=!1),q.loadCommands()},setCommander:function(e,t){var i,a,n;k(e.targetVillage,function(o){i=e.targetVillage,n=null===(a=o).character_id?"attack":"support",T.addCommand({origin:i,target:a,date:t,dateType:"out",units:{spear:"*",sword:"*",axe:"*",archer:"*",light_cavalry:"*",mounted_archer:"*",heavy_cavalry:"*",ram:"*",catapult:"*",snob:"*",knight:"*",doppelsoldner:"*",trebuchet:"*"},officers:{},type:n,catapultTarget:"wall"}),T.isRunning()||T.start()})},commandQueueEnabled:function(){return A},init:function(){var t,a;for(a=0;a<d.length;a++)R[d[a]]=!0;for(a in s)x[s[a]]=!0;try{T=require("two/commandQueue"),A=!!T}catch(e){}(t={})[c.COMMAND_TYPES]=angular.copy(x),t[c.INCOMING_UNITS]=angular.copy(R),t[c.VILLAGE]=!1,!0,f=n.getSelectedCharacter().getGlobalInfo(),S=g.get(I,t,!0),e(function(){C(),i.$on(r.COMMAND_INCOMING,L),i.$on(r.COMMAND_CANCELLED,y),i.$on(r.MAP_SELECTED_VILLAGE,D),i.$on(r.VILLAGE_NAME_CHANGED,M),i.$on(r.COMMAND_IGNORED,N),q.loadCommands()},["initial_village"])}};return q}),define("two/attackView/columnTypes",[],function(){return{ORIGIN_VILLAGE:"origin_village_name",COMMAND_TYPE:"command_type",TARGET_VILLAGE:"target_village_name",TIME_COMPLETED:"time_completed",ORIGIN_CHARACTER:"origin_character_name"}}),define("two/attackView/commandTypes",[],function(){return{ATTACK:"attack",SUPPORT:"support",RELOCATE:"relocate"}}),define("two/attackView/events",[],function(){angular.extend(r,{ATTACK_VIEW_FILTERS_CHANGED:"attack_view_filters_changed",ATTACK_VIEW_SORTING_CHANGED:"attack_view_sorting_changed",ATTACK_VIEW_COMMAND_CANCELLED:"attack_view_command_cancelled",ATTACK_VIEW_COMMAND_IGNORED:"attack_view_command_ignored",ATTACK_VIEW_VILLAGE_RENAMED:"attack_view_village_renamed",ATTACK_VIEW_COMMANDS_LOADED:"attack_view_commands_loaded"})}),define("two/attackView/filterTypes",[],function(){return{COMMAND_TYPES:"command_types",VILLAGE:"village",INCOMING_UNITS:"incoming_units"}}),define("two/attackView/unitSpeedOrder",["conf/unitTypes"],function(e){return[e.LIGHT_CAVALRY,e.HEAVY_CAVALRY,e.AXE,e.SWORD,e.RAM,e.SNOB,e.TREBUCHET]}),require(["two/language","two/ready","two/attackView","two/attackView/ui","two/attackView/events"],function(e,t,i,a){if(i.initialized)return!1;t(function(){e.add("attack_view",{en_us:{attack_view:{filter_types:"Types",filter_show_attacks_tooltip:"Show attacks",filter_show_supports_tooltip:"Show supports",filter_show_relocations_tooltip:"Show relocations",filter_incoming_units:"Incoming Units",commands_copy_arrival_tooltip:"Copy arrival date.",commands_copy_backtime_tooltip:"Copy backtime date.",commands_set_remove_tooltip:"Set a CommandQueue to remove all troops before the attack hit.",command_type_tooltip:"Command Type",slowest_unit_tooltip:"Slowest Unit",command_type:"CT",slowest_unit:"SU",actions:"Actions",no_incoming:"No commands incoming.",copy:"Copy",current_only_tooltip:"Current village only"}},pl_pl:{attack_view:{filter_types:"Rodzaj",filter_show_attacks_tooltip:"Poka탉 ataki",filter_show_supports_tooltip:"Poka탉 wsparcia",filter_show_relocations_tooltip:"Poka탉 przeniesienia",filter_incoming_units:"Nadchodz훳ce jednostki",commands_copy_arrival_tooltip:"Kopiuj czas dotarcia.",commands_copy_backtime_tooltip:"Kopiuj czas powrotu do wioski 탄r처d흢owej.",commands_set_remove_tooltip:"Wstaw rozkaz wycofania wojsk przed dotarciem ataku do Kolejki rozkaz처w.",command_type_tooltip:"Rodzaj",slowest_unit_tooltip:"Najwolniejsza jednostka",command_type:"Rodzaj",slowest_unit:"Co?",actions:"Dost휌pne akcje",no_incoming:"Brak nadchodz훳cych wojsk.",copy:"Copy",current_only_tooltip:"Tylko aktywna wioska"}},pt_br:{attack_view:{filter_types:"Tipos",filter_show_attacks_tooltip:"Mostrar ataques",filter_show_supports_tooltip:"Mostrar apoios",filter_show_relocations_tooltip:"Mostrar transfer챗ncias",filter_incoming_units:"Unidades Chegando",commands_copy_arrival_tooltip:"Copiar data de chegada.",commands_copy_backtime_tooltip:"Copiar backtime.",commands_set_remove_tooltip:"Criar um comando no CommandQueue para remover todas tropas da aldeia antes do comando bater na aldeia.",command_type_tooltip:"Tipo de Comando",slowest_unit_tooltip:"Unidade mais Lenta",command_type:"TC",slowest_unit:"UL",actions:"A챌천es",no_incoming:"Nenhum comando chegando.",copy:"Copiar",current_only_tooltip:"Apenas aldeia selecionada"}}}),i.init(),a()})}),define("two/attackView/ui",["two/ui","two/ui/button","two/attackView","two/EventScope","two/utils","two/attackView/columnTypes","two/attackView/commandTypes","two/attackView/filterTypes","two/attackView/unitSpeedOrder","conf/unitTypes","queues/EventQueue","helper/time","battlecat"],function(t,a,o,l,d,u,m,E,v,f,T,b,h){var A,S,w=function(){return Date.now()/1e3},O=function(e){var t=i.$new();t.text=_("readableDateFilter")(1e3*e,i.loc.ale,i.GAME_TIMEZONE,i.GAME_TIME_OFFSET,"H:mm:ss:sss dd/MM/yyyy"),t.title=_("i18n")("copy",i.loc.ale,"attack_view"),c.getModal("!twoverflow_attack_view_show_text_modal",t)},I=function(e){var t=_("readableDateFilter")(1e3*(e.time_completed-10),i.loc.ale,i.GAME_TIMEZONE,i.GAME_TIME_OFFSET,"H:mm:ss:sss dd/MM/yyyy");o.setCommander(e,t)},R=function(){var e=h("#two-attack-view").parent(),t=h("#wrapper");e.toggleClass("fullsize"),t.toggleClass("window-fullsize")},x=function(){var e=A.pagination.offset,t=A.pagination.limit;A.visibleCommands=A.commands.slice(e,e+t),A.pagination.count=A.commands.length},C=function(){var e,t=Date.now();for(e=0;e<A.commands.length;e++)100===A.commands[e].model.percent(t)&&A.commands.splice(e,1);x()},L=function(e,t){o.toggleFilter(e,t),A.filters=o.getFilters()},y=function(e){o.toggleSorting(e),A.sorting=o.getSortings()},N=function(){A.commands=o.getCommands()},M=function(){A.selectedVillageId=n.getSelectedVillage().getId()},D=function(){(A=e.$scope=i.$new()).textObject="attack_view",A.textObjectCommon="common",A.commandQueueEnabled=o.commandQueueEnabled(),A.commands=o.getCommands(),A.selectedVillageId=n.getSelectedVillage().getId(),A.filters=o.getFilters(),A.sorting=o.getSortings(),A.UNIT_TYPES=f,A.FILTER_TYPES=E,A.COMMAND_TYPES=m,A.UNIT_SPEED_ORDER=v,A.COLUMN_TYPES=u,A.pagination={count:A.commands.length,offset:0,loader:x,limit:p.getPaginationLimit()},A.openCharacterProfile=s.openCharacterProfile,A.openVillageInfo=s.openVillageInfo,A.jumpToVillage=g.jumpToVillage,A.now=w,A.copyTimeModal=O,A.removeTroops=I,A.switchWindowSize=R,A.toggleFilter=L,A.toggleSorting=y,x(),(S=new l("twoverflow_queue_window",function(){b.timer.remove(C)})).register(r.MAP_SELECTED_VILLAGE,M,!0),S.register(r.ATTACK_VIEW_COMMANDS_LOADED,N),S.register(r.ATTACK_VIEW_COMMAND_CANCELLED,N),S.register(r.ATTACK_VIEW_COMMAND_IGNORED,N),S.register(r.ATTACK_VIEW_VILLAGE_RENAMED,N),c.getScreenWithInjectedScope("!twoverflow_attack_view_main",A),b.timer.add(C)};return function(){new a("AttackView",{classHover:!1,classBlur:!1,onClick:D});t.addTemplate("twoverflow_attack_view_main",'<div id="two-attack-view" class="win-content two-window"><header class="win-head"><h2>AttackView</h2><ul class="list-btn"><li><a href="#" class="size-34x34 btn-orange icon-26x26-double-arrow" ng-click="switchWindowSize()"></a></li><li><a href="#" class="size-34x34 btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main" scrollbar=""><div class="box-paper"><div class="scroll-wrap rich-text"><div class="filters"><table class="tbl-border-light"><tbody><tr><th>{{ \'village\' | i18n:loc.ale:textObjectCommon }}</th></tr><tr><td><div class="box-border-dark icon" ng-class="{\'active\': filters[FILTER_TYPES.VILLAGE]}" ng-click="toggleFilter(FILTER_TYPES.VILLAGE)" tooltip="" tooltip-content="{{ \'current_only_tooltip\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-village-info icon-bg-black"></span></div></td></tr></tbody></table><table class="tbl-border-light"><tbody><tr><th>{{ \'filter_types\' | i18n:loc.ale:textObject }}</th></tr><tr><td><div class="box-border-dark icon" ng-class="{\'active\': filters[FILTER_TYPES.COMMAND_TYPES][COMMAND_TYPES.ATTACK]}" ng-click="toggleFilter(FILTER_TYPES.COMMAND_TYPES, COMMAND_TYPES.ATTACK)" tooltip="" tooltip-content="{{ \'filter_show_attacks_tooltip\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-attack icon-bg-black"></span></div><div class="box-border-dark icon" ng-class="{\'active\': filters[FILTER_TYPES.COMMAND_TYPES][COMMAND_TYPES.SUPPORT]}" ng-click="toggleFilter(FILTER_TYPES.COMMAND_TYPES, COMMAND_TYPES.SUPPORT)" tooltip="" tooltip-content="{{ \'filter_show_supports_tooltip\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-support icon-bg-black"></span></div><div class="box-border-dark icon" ng-class="{\'active\': filters[FILTER_TYPES.COMMAND_TYPES][COMMAND_TYPES.RELOCATE]}" ng-click="toggleFilter(FILTER_TYPES.COMMAND_TYPES, COMMAND_TYPES.RELOCATE)" tooltip="" tooltip-content="{{ \'filter_show_relocations_tooltip\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-relocate icon-bg-black"></span></div></td></tr></tbody></table><table class="tbl-border-light"><tbody><tr><th>{{ \'filter_incoming_units\' | i18n:loc.ale:textObject }}</th></tr><tr><td><div ng-repeat="unit in ::UNIT_SPEED_ORDER" class="box-border-dark icon" ng-class="{\'active\': filters[FILTER_TYPES.INCOMING_UNITS][unit]}" ng-click="toggleFilter(FILTER_TYPES.INCOMING_UNITS, unit)" tooltip="" tooltip-content="{{ unit | i18n:loc.ale:\'unit_names\' }}"><span class="icon-34x34-unit-{{ unit }} icon-bg-black"></span></div></td></tr></tbody></table></div><div class="page-wrap" pagination="pagination"></div><p class="text-center" ng-show="!visibleCommands.length">{{ \'no_incoming\' | i18n:loc.ale:textObject }}</p><table class="tbl-border-light commands-table" ng-show="visibleCommands.length"><colgroup><col width="8%"><col width="14%"><col><col><col width="4%"><col width="15%"><col width="11%"></colgroup><thead class="sorting"><tr><th ng-click="toggleSorting(COLUMN_TYPES.COMMAND_TYPE)" tooltip="" tooltip-content="{{ \'command_type_tooltip\' | i18n:loc.ale:textObject }}">{{ \'command_type\' | i18n:loc.ale:textObject }} <span class="arrow" ng-show="sorting.column == COLUMN_TYPES.COMMAND_TYPE" ng-class="{\'icon-26x26-normal-arrow-down\': sorting.reverse, \'icon-26x26-normal-arrow-up\': !sorting.reverse}"></span></th><th ng-click="toggleSorting(COLUMN_TYPES.ORIGIN_CHARACTER)">{{ \'player\' | i18n:loc.ale:textObjectCommon }} <span class="arrow" ng-show="sorting.column == COLUMN_TYPES.ORIGIN_CHARACTER" ng-class="{\'icon-26x26-normal-arrow-down\': sorting.reverse, \'icon-26x26-normal-arrow-up\': !sorting.reverse}"></span></th><th ng-click="toggleSorting(COLUMN_TYPES.ORIGIN_VILLAGE)">{{ \'origin\' | i18n:loc.ale:textObjectCommon }} <span class="arrow" ng-show="sorting.column == COLUMN_TYPES.ORIGIN_VILLAGE" ng-class="{\'icon-26x26-normal-arrow-down\': sorting.reverse, \'icon-26x26-normal-arrow-up\': !sorting.reverse}"></span></th><th ng-click="toggleSorting(COLUMN_TYPES.TARGET_VILLAGE)">{{ \'target\' | i18n:loc.ale:textObjectCommon }} <span class="arrow" ng-show="sorting.column == COLUMN_TYPES.TARGET_VILLAGE" ng-class="{\'icon-26x26-normal-arrow-down\': sorting.reverse, \'icon-26x26-normal-arrow-up\': !sorting.reverse}"></span></th><th tooltip="" tooltip-content="{{ \'slowest_unit_tooltip\' | i18n:loc.ale:textObject }}">{{ \'slowest_unit\' | i18n:loc.ale:textObject }}</th><th ng-click="toggleSorting(COLUMN_TYPES.TIME_COMPLETED)">{{ \'arrive\' | i18n:loc.ale:textObjectCommon }} <span class="arrow" ng-show="sorting.column == COLUMN_TYPES.TIME_COMPLETED" ng-class="{\'icon-26x26-normal-arrow-down\': sorting.reverse, \'icon-26x26-normal-arrow-up\': !sorting.reverse}"></span></th><th>{{ \'actions\' | i18n:loc.ale:textObject }}</th></tr></thead><tbody><tr ng-repeat="command in visibleCommands" class="{{ command.command_type }}" ng-class="{\'snob\': command.slowestUnit === UNIT_TYPES.SNOB}"><td><span class="icon-20x20-{{ command.command_type }}"></span></td><td ng-click="openCharacterProfile(command.originCharacter.id)" class="character"><span class="name">{{ command.originCharacter.name }}</span></td><td ng-class="{\'selected\': command.originVillage.id === selectedVillageId}" class="village"><span class="name" ng-click="openVillageInfo(command.originVillage.id)">{{ command.originVillage.name }}</span> <span class="coords" ng-click="jumpToVillage(command.originVillage.x, command.originVillage.y)">({{ command.originVillage.x }}|{{ command.originVillage.y }})</span></td><td ng-class="{\'selected\': command.targetVillage.id === selectedVillageId}" class="village"><span class="name" ng-click="openVillageInfo(command.targetVillage.id)">{{ command.targetVillage.name }}</span> <span class="coords" ng-click="jumpToVillage(command.targetVillage.x, command.targetVillage.y)">({{ command.targetVillage.x }}|{{ command.targetVillage.y }})</span></td><td><span class="icon-20x20-unit-{{ command.slowestUnit }}"></span></td><td><div class="progress-wrapper" tooltip="" tooltip-content="{{ command.model.arrivalTime() | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}"><div class="progress-bar" ng-style="{width: command.model.percent() + \'%\'}"></div><div class="progress-text"><span>{{ command.model.countdown() }}</span></div></div></td><td><a ng-click="copyTimeModal(command.time_completed)" class="btn btn-orange size-20x20 icon-20x20-arrivetime" tooltip="" tooltip-content="{{ \'commands_copy_arrival_tooltip\' | i18n:loc.ale:textObject }}"></a> <a ng-click="copyTimeModal(command.time_completed + (command.time_completed - command.time_start))" class="btn btn-red size-20x20 icon-20x20-backtime" tooltip="" tooltip-content="{{ \'commands_copy_backtime_tooltip\' | i18n:loc.ale:textObject }}"></a> <a ng-if="commandQueueEnabled" ng-click="removeTroops(command)" class="btn btn-orange size-20x20 icon-20x20-units-outgoing" tooltip="" tooltip-content="{{ \'commands_set_remove_tooltip\' | i18n:loc.ale:textObject }}"></a></td></tr></tbody></table><div class="page-wrap" pagination="pagination"></div></div></div></div></div>'),t.addTemplate("twoverflow_attack_view_show_text_modal",'<div id="show-text-modal" class="win-content"><header class="win-head"><h3>{{ title }}</h3><ul class="list-btn sprite"><li><a href="#" class="btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main" scrollbar=""><div class="box-paper"><div class="scroll-wrap"><form ng-submit="closeWindow()"><input type="text" class="input-border text-center" ng-model="text"></form></div></div></div><footer class="win-foot sprite-fill"><ul class="list-btn list-center"><li><a href="#" class="btn-green btn-border" ng-click="closeWindow()">OK</a></li></ul></footer></div>'),t.addStyle('#two-attack-view table.commands-table{table-layout:fixed;font-size:13px;margin-bottom:10px}#two-attack-view table.commands-table th{text-align:center;padding:0px}#two-attack-view table.commands-table td{padding:1px 0;min-height:initial;border:none;text-align:center}#two-attack-view table.commands-table tr.attack.snob td{background:#bb8658}#two-attack-view table.commands-table tr.support td,#two-attack-view table.commands-table tr.relocate td{background:#9c9368}#two-attack-view table.commands-table .empty td{height:32px}#two-attack-view table.commands-table .sorting .arrow{margin-top:-4px}#two-attack-view .village .coords{font-size:11px;color:#71471a}#two-attack-view .village .coords:hover{color:#ffde00;text-shadow:0 1px 0 #000}#two-attack-view .village .name:hover{color:#fff;text-shadow:0 1px 0 #000}#two-attack-view .village.selected .name{font-weight:bold}#two-attack-view .character .name:hover{color:#fff;text-shadow:1px 1px 0 #000}#two-attack-view .progress-wrapper{height:20px;margin-bottom:0}#two-attack-view .progress-wrapper .progress-text{position:absolute;width:100%;height:100%;text-align:center;z-index:10;padding:0 5px;line-height:20px;color:#f0ffc9;overflow:hidden}#two-attack-view .filters{height:95px;margin-bottom:10px}#two-attack-view .filters table{width:auto;float:left;margin:5px}#two-attack-view .filters .icon{width:38px;float:left;margin:0 6px}#two-attack-view .filters .icon.active:before{box-shadow:0 0 0 1px #000,-1px -1px 0 2px #ac9c44,0 0 0 3px #ac9c44,0 0 0 4px #000;border-radius:1px;content:"";position:absolute;width:38px;height:38px;left:-1px;top:-1px}#two-attack-view .filters td{padding:6px}#two-attack-view .icon-20x20-backtime{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAEMklEQVQ4y42US2xUdRTGf3funZn/PHqnnVdpKZZ2RCWBVESgoZogSAKKEEAlGhVNLMGg0QiJKxYudIdoTEyDj8SFGo2seDUGhEQqRHk/UimDpdAptHMr8+jM3Dv35QJbi9KEszzJ+eU753z5JKYuOQGBUpAa2SLiuPgBPBKGrZAPlSlmoQLYk4ekqUCmEHHL0pslRb7fsNwWF8L/DIz5Fanftey0oogBr65rk8HS3WC6jyY8ckfZdNtfWdX++tzGIDMabAJmArte4my/l/c//vaLoFc6jmP3iCqD41B5Mi0BId1Hk+V6ljfEQlvWL2xZoY/lKOTLGCY01tZhVLMkRJEtqzoeyUvSnN70SNZRXC1iUylDVZmszhQiDmbH9Lrgpta4mKPlCjy95D6Wrn8GAKFEEfEmdG2Qowd+4I0XFrUC7+w7eL5sCu8hdL3imaQuYFl6c9l021vjYk7Y72Xjq4/z1IaNCCVKMRckq+moiQDJ2bN48uV3GbnSx9b1ra1l0223LL05AYF/Vw4S80jyonnN6paq5YTe3LyU2rpaYrFpJGfPItlcTzI1H8R8cC38NTFiaojhSzeJJ8KNJ/4YOmP43GsTCmWLiGG5LTUBb2LuzGm3e3Ij3321m5Hey6A0AVAcPjmhQcSbuDyU5sF6e5phuS2yRWQC6Lj4x62h1vjJ3BwjlUoiYn52ffolmUtnuXj4ADu2b7/DFoN9RVQ1gAthx8U/+Sk4LiGAQtFAHzXIajpr16yiu/tX98euzyWAzrc6Abj8+1G0TIZ8uYx/xJpgjANlWfEKqjaZbIlixQQgdDHDyuULWLFisZTVdBJxQTIVA2uQ+qZ6KoU0nhqV09f+QoIxj4ThAWRVJWLZToNXUaarYR8Hdm+iZBic7N5LbmgI0xclERcAFLIVAHRtkFOHjwBwNHNryK9I/bZCXlFVIk6ZuSbukidmR1Z+/cliAHzRBjKjBTq37bz9gEAAgA+2vQjAjb4j9F6pUCga/Hzm5v6A5KRDFkXF1UnWRcRj256d/vam9zrJXT0GwGc7V+ONRwAwtTwAa9bs4ND+PTy8MMW5az7+vJ7lXKZ4IeiVjsuIgaylVxTHxf/S84+u3bh5Mbmrx/D6Y1hjGtaYBjduH9g0RonNSmH4o/T1j9JzeoBixSRbsi9ktNIuRXJ6vFVbA2ypVoiZNuay+qj62r6u1R0ee4i65Iw7rDEOnLegC4CSqwxf18b23C0cFMenF5wKJzLZfLDtuW/4pWt1Ry6XY8/ug8jRB6gN3GI0k6VtXcq9csvqtm2rTyjS+YDkpGXEgLdq/z++EhA2hYjbmMtMx7P8+4/Wbdj64U89/cP5Xlli2HGcUsAnjziulMGxbrheRu4lYH21QjSarvXQoraZbQC/nUoflzwMyx6hVz26MRVkysROQNhQ8XmqQr1XwH/rb2Du69Eebp25AAAAAElFTkSuQmCC")}#two-attack-view .icon-20x20-arrivetime{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAEW0lEQVQ4y4WUWWxUZRiGn7PMnNPOVtvODHQBSlulAUFBoQiEaBHBhCsSFaIhIe6JSyAkRkO8NpErY2KoYuINISkkRFAjEUyAUCQsBSu1BVpKZ2DmTNuZzsyZMz3L70Vbgkjqe/Ul//89//K9eSX+KyUKFcVKQopDxBNoALJE2VXJBUzyBpQA9xG9SA+DbF2vdRxrvqQqLWVHNAkITm8saKo0KBz3hqrqt32WlXkUWHoQZvlpQFbWmLZo//zj7W8ua7JRUoKSz+DOXYVrSZMfjnV/W+mTuvHcs/okIw9DFYAoBCw/DY6QX9yycemer9/p6KiQE7ilIj4vwNXBFIO3M1iFLKta4suNvLUwZzpZTxWZiEvJhMkHgYpf1+cKSazfsnHpnve2rVqYTg2xdvMrPL76JWKNNSxesYB1LyyDiQQ9fWkCmhxzkRuLZTcpVC1lOU4eEDNPDUzitJVc6eUDn6zuSAwl2PDGLqrnx9ECPob6kkxaPiLBEK1LniIaFVz/c4SAJsf6U2ZaEfZwxMOYuaVCJTWypKz68LXV7y6sigWf7thMdfMKkMOgryA2r5pYYwWBaA3FzBhFM8uiRXFOnumn/jGt0SjYl8t+MWzbFABkxSFSdkTTE3F3zkDyBnptw/2J5VMXpwq1gfT1AQ4eOIyi1AHw5II5hCp80bIjmhSHyEyP7Ak0AcFwuIKR/vy/PLVv7156T/1M4u8e9n/1HXqNRnNzjMS9AuGQBlMfF5zxKoA6U2hph5xp0nv+ErX1KVqfXctbH+yk65tOAOa1tolNm56TjIyFNVpmIl8GwBMEHnSzKkuUJUHh8vAYcihMIFQi3hAHZ4T65hq27dyKkbGI1uqS7a/mXO8F+gZGuDZ0j4nClFsU1adj2wrgyq5KTlOlwTOJ8STApVO/Y2VGAJgwSgBEa3VsfzXZZJKLvxyjWC7z8+G3CQf9+FS13nG9ueEwEUBRqmywEfrAvWLF4rqq5fmiwCvcIjuqYCTu8v5nnXQd7+bgoZ/48dduXF8F4ZpaNj0/j60bgly+YLTeNMyUYosxPUhONaBUpeq3K7G7T/Ym2pfWh5ZU1MzBX/0XV/64iVYe4+jR3QD4aqeGaWdylPNjABw9upv9X3R+9GVXwsjmrZQCiJDjOI4scjnTyZZc0ZhKJmM9PcNYlsu4CLJjez3jt65ij45jpZPYhVG8SRNFrcQc7eeZ9evIl9xI96Xh4yqAAaXoJCOW3zuRGjfNwbRob6wNbkkYxTizaDx9B0+pY93rnWdTYxPf+xQ9p0yvCRPciEtJqFpKEfZwyXaupArOYLbM+JK2lS3HDhyRbgwanO6eoPvEaWLxOixLY+WOrrP5onUI4Z2TdMeQZgtYySaGrM6VJVFfmnRjsiwHXEG8KR5p2/fpxjWv7jpyyCd7JxR8v03nY0Fidt2H+z1dcz1LFx7xlctb2gHO9wz1+CS1L2tZSabD4f+Asx7g+a0JbYJJg6lgAPgHUh4QWRIJr4EAAAAASUVORK5CYII=")}')}}),define("two/autoCollector",["queues/EventQueue","helper/time","Lockr"],function(e,t,a){var s=!1,c=!1,d=!0,u=0,g=function(){o.emit(l.RESOURCE_DEPOSIT_GET_INFO,{})},_=function(){var e,t,i,a;return!!c&&(!!(e=n.getSelectedCharacter().getResourceDeposit())&&(!e.getCurrentJob()&&((t=e.getCollectibleJobs())?(a=t.shift(),void o.emit(l.RESOURCE_DEPOSIT_COLLECT,{job_id:a.id,village_id:n.getSelectedVillage().getId()})):(i=e.getReadyJobs())?function(e){o.emit(l.RESOURCE_DEPOSIT_START_JOB,{job_id:e.id})}(p(i)):void 0)))},p=function(e){return e.sort(function(e,t){return e.duration-t.duration})[0]},m={};return m.init=function(){s=!0,i.$on(r.RESOURCE_DEPOSIT_JOB_COLLECTIBLE,function(){if(!d||!c)return!1;d=!1,setTimeout(function(){d=!0,_()},1500)}),i.$on(r.RESOURCE_DEPOSIT_JOBS_REROLLED,_),i.$on(r.RESOURCE_DEPOSIT_JOB_COLLECTED,_),i.$on(r.RESOURCE_DEPOSIT_INFO,function(e,t){_(),function(e){var t=1e3*e.time_next_reset-Date.now()+1e3;clearTimeout(u),u=setTimeout(g,t)}(t)})},m.start=function(){e.trigger(r.AUTO_COLLECTOR_STARTED),c=!0,_()},m.stop=function(){e.trigger(r.AUTO_COLLECTOR_STOPPED),c=!1},m.isRunning=function(){return c},m.isInitialized=function(){return s},m}),define("two/autoCollector/events",[],function(){angular.extend(r,{AUTO_COLLECTOR_STARTED:"auto_collector_started",AUTO_COLLECTOR_STOPPED:"auto_collector_stopped",AUTO_COLLECTOR_SECONDVILLAGE_STARTED:"auto_collector_secondvillage_started",AUTO_COLLECTOR_SECONDVILLAGE_STOPPED:"auto_collector_secondvillage_stopped"})}),define("two/autoCollector/secondVillage",["two/autoCollector","queues/EventQueue","helper/time","models/SecondVillageModel"],function(e,t,a,s){var c=!1,d=!1,u=injector.get("secondVillageService"),g=function(){var e,t;e=_,o.emit(l.SECOND_VILLAGE_GET_INFO,{},function(i){t=new s(i),n.getSelectedCharacter().setSecondVillage(t),e()})},_=function(){var e,t,i,r,s,c,_,p,m,E,v=n.getSelectedCharacter().getSecondVillage();return!!(d&&v&&v.isAvailable())&&((e=function(e){var t,i=Date.now();for(t in e)if(e[t].time_started&&e[t].time_completed&&i<a.server2ClientTime(e[t].time_completed))return e[t];return!1}(v.data.jobs))?(t=a.server2ClientTime(e.time_completed)-Date.now()+1e3,setTimeout(g,t),!1):(i=function(e){var t,i=Date.now();for(t in e)if(e[t].time_started&&e[t].time_completed&&i>=a.server2ClientTime(e[t].time_completed)&&!e[t].collected)return t;return!1}(v.data.jobs))?(E=i,void o.emit(l.SECOND_VILLAGE_COLLECT_JOB_REWARD,{village_id:n.getSelectedVillage().getId(),job_id:E})):(r=u.getCurrentDayJobs(v.data.jobs,v.data.day),s=u.getCollectedJobs(v.data.jobs),c=n.getSelectedVillage().getResources().getResources(),void((_=u.getAvailableJobs(r,s,c,[]))&&function(e,t){o.emit(l.SECOND_VILLAGE_START_JOB,{village_id:n.getSelectedVillage().getId(),job_id:e},t)}(p=function(e){var t;for(t in e)return t;return!1}(_),function(){m=_[p],setTimeout(g,1e3*m.duration+1e3)}))))},p={start:function(){if(!c)return!1;t.trigger(r.AUTO_COLLECTOR_SECONDVILLAGE_STARTED),d=!0,g()},stop:function(){if(!c)return!1;t.trigger(r.AUTO_COLLECTOR_SECONDVILLAGE_STOPPED),d=!1},isRunning:function(){return d},isInitialized:function(){return c},init:function(){if(!u.isFeatureActive())return!1;c=!0,i.$on(r.SECOND_VILLAGE_VILLAGE_CREATED,g),i.$on(r.SECOND_VILLAGE_JOB_COLLECTED,g),i.$on(r.SECOND_VILLAGE_VILLAGE_CREATED,g)}};e.secondVillage=p}),require(["two/language","two/ready","two/autoCollector","two/autoCollector/ui","Lockr","queues/EventQueue","two/autoCollector/secondVillage","two/autoCollector/events"],function(e,t,i,a,n,o){var l="auto_collector_active";if(i.isInitialized())return!1;t(function(){e.add("auto_collector",{en_us:{auto_collector:{description:"Automatic Resource Deposit/Second Village collector.",activated:"Automatic Collector activated",deactivated:"Automatic Collector deactivated"}},pl_pl:{auto_collector:{description:"Automatyczny kolekcjoner depozytu/drugiej wioski.",activated:"Kolekcjoner aktywowany",deactivated:"Kolekcjoner deaktywowany"}},pt_br:{auto_collector:{description:"Coletor autom찼tico para Dep처sito de Recursos/Segunda Aldeia.",activated:"Coletor Autom찼tico ativado",deactivated:"Coletor Autom찼tico desativado"}}}),i.init(),i.secondVillage.init(),a(),t(function(){n.get(l,!1,!0)&&(i.start(),i.secondVillage.start()),o.register(r.AUTO_COLLECTOR_STARTED,function(){n.set(l,!0)}),o.register(r.AUTO_COLLECTOR_STOPPED,function(){n.set(l,!1)})},["initial_village"])})}),define("two/autoCollector/ui",["two/autoCollector","two/ui/button","two/utils","queues/EventQueue"],function(e,t,a,n){var o;return function(){return(o=new t("Collector",{classHover:!1,classBlur:!1,tooltip:_("i18n")("description",i.loc.ale,"auto_collector")})).click(function(){e.isRunning()?(e.stop(),e.secondVillage.stop(),a.emitNotif("success",_("i18n")("deactivated",i.loc.ale,"auto_collector"))):(e.start(),e.secondVillage.start(),a.emitNotif("success",_("i18n")("activated",i.loc.ale,"auto_collector")))}),n.register(r.AUTO_COLLECTOR_STARTED,function(){o.$elem.classList.remove("btn-green"),o.$elem.classList.add("btn-red")}),n.register(r.AUTO_COLLECTOR_STOPPED,function(){o.$elem.classList.remove("btn-red"),o.$elem.classList.add("btn-green")}),e.isRunning()&&n.trigger(r.AUTO_COLLECTOR_STARTED),o}}),define("two/builderQueue",["two/ready","two/utils","two/builderQueue/settings","two/builderQueue/settingsMap","two/builderQueue/errorCodes","conf/upgradeabilityStates","conf/buildingTypes","conf/locationTypes","queues/EventQueue","Lockr"],function(e,t,a,s,c,d,g,_,p,m){var E,v,f,T,b,h,A=injector.get("buildingService"),S=!1,w=!1,O={},I=!0,R={},x="builder_queue_log",C="builder_queue_settings",L=function(){var e,t,i,n=R[a.GROUP_VILLAGES]?T.getGroupVillageIds(R[a.GROUP_VILLAGES]):y();if(!I)return P.stop(),!1;n.forEach(function(a){return e=b.getVillage(a),t=e.checkReadyState(),(i=e.buildingQueue).getAmountJobs()!==i.getUnlockedSlots()&&(!(!t.buildingQueue||!t.buildings)&&(e.isInitialized()||u.initializeVillage(e),void N(e)))})},y=function(){var e,t=[],i=b.getVillages();for(e in i)t.push(e);return t},N=function(e){var t,i,n=angular.copy(e.buildingData.getBuildingLevels()),o=e.buildingQueue.getQueue(),l=angular.copy(O);if(o.forEach(function(e){n[e.building]++}),D(n))return!1;R[a.BUILDING_SEQUENCES][R[a.ACTIVE_SEQUENCE]].some(function(a){if(++l[a]>n[a])return A.compute(e),M(e,a,function(a,n){a&&(t=Date.now(),i=[{x:e.getX(),y:e.getY(),name:e.getName(),id:e.getId()},n.job.building,n.job.level,t],p.trigger(r.BUILDER_QUEUE_JOB_STARTED,i),h.unshift(i),m.set(x,h))}),!0})},M=function(e,t,i){e.getBuildingData().getDataForBuilding(t).upgradeability===d.POSSIBLE?o.emit(l.VILLAGE_UPGRADE_BUILDING,{building:t,village_id:e.getId(),location:_.MASS_SCREEN,premium:!1},function(e,t){i(!0,e)}):i(!1)},D=function(e){for(var t in e)if(e[t]<f[t])return!1;return!0},G=function(e){var t=R[a.BUILDING_SEQUENCES][e],i=angular.copy(O);return t.forEach(function(e){i[e]++}),i},P={start:function(){if(!I)return p.trigger(r.BUILDER_QUEUE_NO_SEQUENCES),!1;w=!0,v=setInterval(L,6e4),e(L,["all_villages_ready"]),p.trigger(r.BUILDER_QUEUE_START)},stop:function(){w=!1,clearInterval(v),p.trigger(r.BUILDER_QUEUE_STOP)},isRunning:function(){return w},isInitialized:function(){return S},updateSettings:function(e,t){var i,n;for(n in e){if(!s[n])return p.trigger(r.BUILDER_QUEUE_UNKNOWN_SETTING,[n]),!1;i=e[n],angular.equals(R[n],i)||(R[n]=i)}return I=Object.keys(R[a.BUILDING_SEQUENCES]).length,f=!!I&&G(R[a.ACTIVE_SEQUENCE]),m.set(C,R),t||p.trigger(r.BUILDER_QUEUE_SETTINGS_CHANGE),!0},getSettings:function(){return R},getLogs:function(){return h},clearLogs:function(){h=[],m.set(x,h),p.trigger(r.BUILDER_QUEUE_CLEAR_LOGS)},addBuildingSequence:function(e,t){return e in R[a.BUILDING_SEQUENCES]?c.SEQUENCE_EXISTS:angular.isArray(t)?(R[a.BUILDING_SEQUENCES][e]=t,m.set(C,R),p.trigger(r.BUILDER_QUEUE_BUILDING_SEQUENCES_ADDED,e),!0):c.SEQUENCE_INVALID}};return P.updateBuildingSequence=function(e,t){return e in R[a.BUILDING_SEQUENCES]?angular.isArray(t)&&function(e){e=angular.copy(O);var t,i,a=n.getGameData().getBuildings();for(i=0;i<e.length;i++)if(++e[t=e[i]]>a[t].max_level)return!1;return!0}(t)?(R[a.BUILDING_SEQUENCES][e]=t,m.set(C,R),p.trigger(r.BUILDER_QUEUE_BUILDING_SEQUENCES_UPDATED,e),!0):c.SEQUENCE_INVALID:c.SEQUENCE_NO_EXISTS},P.removeSequence=function(e){if(!(e in R[a.BUILDING_SEQUENCES]))return c.SEQUENCE_NO_EXISTS;delete R[a.BUILDING_SEQUENCES][e],m.set(C,R),p.trigger(r.BUILDER_QUEUE_BUILDING_SEQUENCES_REMOVED,e)},P.init=function(){var e,t,o,l;for(e in S=!0,E=m.get(C,{},!0),h=m.get(x,[],!0),b=n.getSelectedCharacter(),T=n.getGroupList(),s)t=s[e].default,R[e]=E.hasOwnProperty(e)?E[e]:t;for(o in g)O[g[o]]=0;I=Object.keys(R[a.BUILDING_SEQUENCES]).length,f=!!I&&G(R[a.ACTIVE_SEQUENCE]),i.$on(r.BUILDING_LEVEL_CHANGED,function(e,t){if(!w)return!1;setTimeout(function(){l=b.getVillage(t.village_id),N(l)},1e3)})},P}),define("two/builderQueue/defaultOrders",["conf/buildingTypes"],function(e){var t={},i=function(e){var t,i,a=[];for(t=0;t<e.length;t++)i=e[t],angular.isArray(i)?(i.sort(()=>Math.random()-.5),a=a.concat(i)):a.push(i);return a};return t.Essential=[e.HEADQUARTER,e.FARM,e.WAREHOUSE,e.RALLY_POINT,e.BARRACKS,[e.TIMBER_CAMP,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.HEADQUARTER,e.RALLY_POINT],[e.FARM,e.WAREHOUSE,e.CLAY_PIT,e.IRON_MINE],[e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.WAREHOUSE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE],[e.WAREHOUSE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.FARM,e.WAREHOUSE,e.HEADQUARTER],[e.STATUE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE],[e.BARRACKS,e.HEADQUARTER,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.FARM,e.HOSPITAL],[e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.WAREHOUSE,e.HEADQUARTER,e.WALL],[e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.FARM],e.FARM,e.FARM,[e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE],[e.BARRACKS,e.WAREHOUSE,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.WAREHOUSE],[e.HEADQUARTER,e.MARKET,e.BARRACKS,e.WALL,e.WALL],[e.FARM,e.FARM,e.BARRACKS,e.WAREHOUSE,e.FARM],[e.BARRACKS,e.WAREHOUSE,e.FARM,e.BARRACKS,e.WAREHOUSE,e.FARM],[e.WALL,e.WALL,e.WALL,e.MARKET,e.MARKET,e.MARKET],[e.BARRACKS,e.BARRACKS,e.HEADQUARTER,e.HEADQUARTER],[e.TAVERN,e.TAVERN,e.TAVERN,e.RALLY_POINT],[e.BARRACKS,e.BARRACKS,e.WAREHOUSE,e.FARM],[e.WAREHOUSE,e.FARM,e.BARRACKS,e.BARRACKS],[e.STATUE,e.STATUE,e.WALL,e.WALL],[e.HEADQUARTER,e.HEADQUARTER,e.WAREHOUSE,e.FARM,e.FARM],[e.IRON_MINE,e.IRON_MINE,e.IRON_MINE,e.WAREHOUSE],[e.BARRACKS,e.BARRACKS,e.WAREHOUSE,e.FARM],[e.WALL,e.WALL,e.TAVERN,e.TAVERN,e.TAVERN],[e.MARKET,e.MARKET,e.MARKET,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.FARM,e.WAREHOUSE,e.FARM],[e.IRON_MINE,e.IRON_MINE,e.IRON_MINE,e.RALLY_POINT],[e.BARRACKS,e.BARRACKS,e.FARM,e.FARM,e.FARM,e.FARM],[e.WAREHOUSE,e.WAREHOUSE,e.HEADQUARTER,e.HEADQUARTER],[e.STATUE,e.STATUE,e.FARM,e.BARRACKS],[e.HEADQUARTER,e.HEADQUARTER,e.FARM,e.BARRACKS],[e.HEADQUARTER,e.HEADQUARTER,e.BARRACKS,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER],[e.ACADEMY,e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.WAREHOUSE],[e.MARKET,e.MARKET,e.MARKET,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE],[e.TIMBER_CAMP,e.CLAY_PIT,e.TIMBER_CAMP,e.CLAY_PIT,e.TIMBER_CAMP,e.TIMBER_CAMP],[e.WALL,e.WALL,e.MARKET,e.MARKET,e.MARKET],[e.TIMBER_CAMP,e.CLAY_PIT,e.TIMBER_CAMP,e.CLAY_PIT,e.TAVERN,e.TAVERN,e.TAVERN],[e.WALL,e.WALL,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE],[e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.BARRACKS,e.BARRACKS,e.BARRACKS],[e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.TAVERN,e.TAVERN,e.TAVERN],[e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE],[e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.BARRACKS,e.BARRACKS],[e.FARM,e.WAREHOUSE,e.WAREHOUSE,e.WALL,e.WALL,e.WALL,e.WALL],[e.TAVERN,e.TAVERN,e.RALLY_POINT,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE],[e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE],[e.TIMBER_CAMP,e.CLAY_PIT,e.IRON_MINE,e.TIMBER_CAMP,e.CLAY_PIT,e.CLAY_PIT,e.IRON_MINE],[e.TIMBER_CAMP,e.CLAY_PIT,e.CLAY_PIT,e.IRON_MINE,e.WALL,e.WALL]],t["Full Village"]=[[e.HOSPITAL,e.HOSPITAL,e.HOSPITAL,e.HOSPITAL,e.MARKET,e.MARKET,e.MARKET,e.MARKET],[e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.PRECEPTORY,e.HOSPITAL,e.HOSPITAL,e.HOSPITAL,e.HOSPITAL,e.HOSPITAL],[e.MARKET,e.MARKET,e.MARKET,e.MARKET,e.PRECEPTORY,e.PRECEPTORY,e.MARKET,e.MARKET,e.MARKET,e.MARKET],[e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.HEADQUARTER,e.PRECEPTORY,e.PRECEPTORY,e.PRECEPTORY,e.PRECEPTORY,e.PRECEPTORY,e.PRECEPTORY,e.PRECEPTORY]],Array.prototype.unshift.apply(t["Full Village"],t.Essential),t["Essential Without Wall"]=t.Essential.filter(function(t){return t!==e.WALL}),t["Full Wall"]=[e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL,e.WALL],function(e){var t,a={};for(t in e)e.hasOwnProperty(t)&&(a[t]=i(e[t]));return a}(t)}),define("two/builderQueue/errorCodes",[],function(){return{SEQUENCE_NO_EXISTS:"sequence_no_exists",SEQUENCE_EXISTS:"sequence_exists",SEQUENCE_INVALID:"sequence_invalid"}}),define("two/builderQueue/events",[],function(){angular.extend(r,{BUILDER_QUEUE_JOB_STARTED:"Builder/jobStarted",BUILDER_QUEUE_START:"Builder/start",BUILDER_QUEUE_STOP:"Builder/stop",BUILDER_QUEUE_UNKNOWN_SETTING:"Builder/settings/unknownSetting",BUILDER_QUEUE_CLEAR_LOGS:"Builder/clearLogs",BUILDER_QUEUE_BUILDING_SEQUENCES_UPDATED:"Builder/buildingOrders/updated",BUILDER_QUEUE_BUILDING_SEQUENCES_ADDED:"Builder/buildingOrders/added",BUILDER_QUEUE_BUILDING_SEQUENCES_REMOVED:"Builder/buildingOrders/removed",BUILDER_QUEUE_SETTINGS_CHANGE:"Builder/settings/change",BUILDER_QUEUE_NO_SEQUENCES:"builder_queue_no_sequences"})}),define("two/builderQueue/settingsMap",["two/builderQueue/defaultOrders","two/builderQueue/settings"],function(e,t){return{[t.GROUP_VILLAGES]:{default:"",inputType:"select"},[t.ACTIVE_SEQUENCE]:{default:"Essential",inputType:"select"},[t.BUILDING_SEQUENCES]:{default:e,inputType:"buildingOrder"}}}),define("two/builderQueue/settings",[],function(){return{GROUP_VILLAGES:"group_villages",ACTIVE_SEQUENCE:"building_sequence",BUILDING_SEQUENCES:"building_orders"}}),require(["two/language","two/ready","two/builderQueue","two/builderQueue/ui","two/builderQueue/events"],function(e,t,i,a){if(i.isInitialized())return!1;t(function(){e.add("builder_queue",{en_us:{builder_queue:{started:"BuilderQueue started",stopped:"BuilderQueue stopped",settings:"Settings",settings_village_groups:"Build only on villages with the group",settings_building_sequence:"Building sequence",settings_building_sequence_final:"Buildings final levels",settings_saved:"Settings saved!",logs_no_builds:"No builds started",logs_clear:"Clear logs",sequences:"Sequences",sequences_move_up:"Move up",sequences_move_down:"Move down",sequences_add_building:"Add building",sequences_select_edit:"Select a sequence to edit",sequences_edit_sequence:"Edit sequence",sequence_updated:"Sequence %d updated.",sequence_added:"Building sequence %d added",select_group:"Select a group",add_building_success:"%d has added at position %d",add_building_limit_exceeded:"%d reached maximum level (%d)",position:"Position",remove_building:"Remove building from list",clone:"Clone",tooltip_clone:"Crate a new sequence from the selected sequence",tooltip_remove_sequence:"Remove selected sequence",name_sequence_min_lenght:"The sequence name must have at least 3 character.",sequence_created:"New sequence %d created.",sequence_removed:"Sequence %d removed.",error_sequence_exists:"This sequence already exists.",error_sequence_no_exists:"This sequence not exists.",error_sequence_invalid:"Some sequence's value is invalid.",logs_cleared:"Logs cleared.",create_sequence:"Create a sequence"},builder_queue_add_building_modal:{title:"Add new building"},builder_queue_name_sequence_modal:{title:"Sequence name"},builder_queue_remove_sequence_modal:{title:"Remove sequence",text:"Are you sure to remove this sequence? If this sequence is the active one, another sequence will be selected and the BuilderQueue stopped."}},pl_pl:{builder_queue:{started:"BuilderQueue uruchomiony",stopped:"BuilderQueue zatrzymany",settings:"Ustawienia",settings_village_groups:"Buduj w wioskach z grupy",settings_building_sequence:"Szablon kolejki budowy",settings_building_sequence_final:"Finalne poziomy budynk처w",settings_saved:"Ustawienia zapisane!",logs_no_builds:"Nie rozpocz휌to 탉adnej rozbudowy",logs_clear:"Wyczy힄훶 logi",sequences:"Szablony",sequences_move_up:"Przesu흦 w g처r휌",sequences_move_down:"Przesu흦 w d처흢",sequences_add_building:"Dodaj budynek",sequences_select_edit:"Wybierz szablon do edytowania",sequences_edit_sequence:"Edytuj szablon",sequence_updated:"Szablon %d zaktualizowany.",sequence_added:"Szablon budowy %d dodany",select_group:"Wybierz grup휌",add_building_success:"%d dodany na pozycji %d",add_building_limit_exceeded:"%d osi훳gn훳흢/e흢a maksymalny poziom (%d)",position:"Pozycja",remove_building:"Usu흦 budynek z listy",clone:"Klonuj",tooltip_clone:"Utw처rz nowy szablon na podstawie wybranego szablonu",tooltip_remove_sequence:"Usu흦 wybrany szablon",name_sequence_min_lenght:"The sequence name must have at least 3 character.",sequence_created:"Nowy szablon %d utworzony.",sequence_removed:"Szablon %d usuni휌ty.",error_sequence_exists:"Ten szablon ju탉 istnieje.",error_sequence_no_exists:"Ten szablon nie istnieje.",error_sequence_invalid:"Niekt처re z warto힄ci szablonu s훳 niepoprawne.",logs_cleared:"Logi wyczyszczone.",create_sequence:"Utw처rz szablon"},builder_queue_add_building_modal:{title:"Dodaj nowy budynek"},builder_queue_name_sequence_modal:{title:"Nazwa szablonu"},builder_queue_remove_sequence_modal:{title:"Usu흦 szablon",text:"Jeste힄 pewny, 탉e chcesz usun훳훶 ten szablon? Je힄li ten szablon jest teraz aktywny, inny szablon zostanie wybrany i BuilderQueue zatrzyma si휌."}},pt_br:{builder_queue:{started:"BuilderQueue iniciado",stopped:"BuilderQueue parado",settings:"Configura챌천es",settings_village_groups:"Construir apenas em aldeias do grupo",settings_building_sequence:"Sequ챗ncia de constru챌천es",settings_building_sequence_final:"N챠vel final das constru챌천es",settings_saved:"Configura챌천es salvas!",logs_no_builds:"Nenhuma constru챌찾o iniciada",logs_clear:"Limpar registros",sequences:"Sequ챗ncias",sequences_move_up:"Mover acima",sequences_move_down:"Mover abaixo",sequences_add_building:"Adicionar edif챠cio",sequences_select_edit:"Selecione uma sequ챗ncia para editar",sequences_edit_sequence:"Editar sequ챗ncia",sequence_updated:"Sequ챗ncia %d atualizada.",sequence_added:"Sequ챗ncia %d adicionada",select_group:"Selecione um grupo",add_building_success:"%d foi adicionado 횪 posi챌찾o %d",add_building_limit_exceeded:"%d chegou ao n챠vel m찼ximo (%d)",position:"Posi챌찾o",remove_building:"Remover edif챠cio da lista",clone:"Clonar",tooltip_clone:"Criar uma nova sequ챗ncia a partir da sequ챗ncia selecionada",tooltip_remove_sequence:"Remover sequ챗ncia selecionada",name_sequence_min_lenght:"O nome da sequ챗ncia deve ter pelo menos 3 caracteres.",sequence_created:"Nova sequ챗ncia %d criada.",sequence_removed:"Sequ챗ncia %d removida.",error_sequence_exists:"Esta sequ챗ncia j찼 existe.",error_sequence_no_exists:"Esta sequ챗ncia n찾o existe.",error_sequence_invalid:"Algum valor da sequ챗ncia 챕 inv찼lido.",logs_cleared:"Registro limpo.",create_sequence:"Criar uma sequ챗ncia"},builder_queue_add_building_modal:{title:"Adicionar novo edif챠cio"},builder_queue_name_sequence_modal:{title:"Nomear sequ챗ncia"},builder_queue_remove_sequence_modal:{title:"Remover sequ챗ncia",text:"Tem certeza que deseja remover esta sequ챗ncia? Se esta sequ챗ncia estiver ativa, outra ser찼 selecionada e o BuilderQueue ser찼 parado."}}}),i.init(),a()})}),define("two/builderQueue/ui",["two/ui","two/ui/button","two/builderQueue","two/utils","two/ready","two/builderQueue/settings","two/builderQueue/settingsMap","two/builderQueue/errorCodes","conf/buildingTypes","two/EventScope","queues/EventQueue","helper/time"],function(t,a,o,l,d,u,g,m,E,v,f,T){var b,h,A,S="builder_queue",w=n.getGroupList(),O={},I=!1,R={sequencesAvail:!0,modal:{}},x={sequencesAvail:!0},C={},L={SETTINGS:"settings",SEQUENCES:"sequences",LOGS:"logs"},y=function(){return{name:_("i18n")("disabled",i.loc.ale,"common"),value:!1}},N=function(e,t,i){return i?parseInt(Math.round(e*Math.pow(t,i-1)),10):0},M=function(e,t,i){if(i>=e.length)for(var a=i-e.length+1;a--;)e.push(void 0);e.splice(i,0,e.splice(t,1)[0])},D=function(e,t){switch(o.addBuildingSequence(e,t)){case m.SEQUENCE_EXISTS:return l.emitNotif("error",_("i18n")("error_sequence_exists",i.loc.ale,S)),!1;case m.SEQUENCE_INVALID:return l.emitNotif("error",_("i18n")("error_sequence_invalid",i.loc.ale,S)),!1}return!0};x.generateSequences=function(){var e=h.settings[u.BUILDING_SEQUENCES],t=Object.keys(e).length;if(x.sequencesAvail=t,!t)return!1;x.generateBuildingSequence(),x.generateBuildingSequenceFinal(),x.updateVisibleBuildingSequence()},x.generateBuildingSequence=function(){var e,t,i,a,o=h.settings[u.ACTIVE_SEQUENCE].value,l=h.settings[u.BUILDING_SEQUENCES][o],r=n.getGameData().getBuildings(),s={};if(x.sequencesAvail=!!l,!x.sequencesAvail)return!1;for(e in E)s[E[e]]=0;x.buildingSequence=l.map(function(e){return t=++s[e],a=r[e].individual_level_costs[t],i="not-reached",!function(e,t){return n.getSelectedVillage().getBuildingData().getBuildingLevel(e)>=t}(e,t)?function(e,t){var i=!1;return n.getSelectedVillage().getBuildingQueue().getQueue().some(function(a){if(a.building===e&&a.level===t)return i=!0}),i}(e,t)&&(i="progress"):i="reached",{level:t,price:r[e].individual_level_costs[t],building:e,duration:T.readableSeconds(a.build_time),levelPoints:O[e][t-1],state:i}})},x.generateBuildingSequenceFinal=function(e){var t,i=h.settings[u.ACTIVE_SEQUENCE].value,a=h.settings[u.BUILDING_SEQUENCES][e||i],n={},o=[];for(t in A)n[t]={level:0,order:A[t].order};for(t in a.forEach(function(e){n[e].level++}),n)0!==n[t].level&&o.push({building:t,level:n[t].level,order:n[t].order});x.buildingSequenceFinal=o},x.updateVisibleBuildingSequence=function(){var e=h.pagination.buildingSequence.offset,t=h.pagination.buildingSequence.limit;x.visibleBuildingSequence=x.buildingSequence.slice(e,e+t),h.pagination.buildingSequence.count=x.buildingSequence.length},x.generateBuildingsLevelPoints=function(){var e,t,i,a,o,l=n.getGameData();for(e in l.data.buildings)for(t=l.getBuildingDataForBuilding(e),i=0,O[e]=[],o=1;o<=t.max_level;o++)i+=a=N(t.points,t.points_factor,o)-i,O[e].push(a)},R.moveUp=function(){var e,t,i=angular.copy(R.buildingSequence);for(e=0;e<i.length;e++)(t=i[e]).checked&&0!==e&&(i[e-1].checked||(i[e-1].building===t.building&&(i[e-1].level++,t.level--),M(i,e,e-1)));R.buildingSequence=i,R.updateVisibleBuildingSequence()},R.moveDown=function(){var e,t,i=angular.copy(R.buildingSequence);for(e=i.length-1;e>=0;e--)(t=i[e]).checked&&e!==i.length-1&&(i[e+1].checked||(i[e+1].building===t.building&&(i[e+1].level--,t.level++),M(i,e,e+1)));R.buildingSequence=i,R.updateVisibleBuildingSequence()},R.addBuilding=function(e,t){var i=t-1,a=R.buildingSequence.slice();return a.splice(i,0,{level:null,building:e,checked:!1}),!!(a=R.updateLevels(a,e))&&(R.buildingSequence=a,R.updateVisibleBuildingSequence(),!0)},R.removeBuilding=function(e){var t=R.buildingSequence[e].building;R.buildingSequence.splice(e,1),R.buildingSequence=R.updateLevels(R.buildingSequence,t),R.updateVisibleBuildingSequence()},R.updateLevels=function(e,t){var i,a,n=0,o=[],l=!1;for(i=0;i<e.length;i++)if((a=e[i]).building===t){if(++n>A[t].max_level){l=!0;break}o.push({level:n,building:t,checked:!1})}else o.push(a);return!l&&o},R.generateBuildingSequence=function(){var e=h.settings[u.BUILDING_SEQUENCES],t=Object.keys(e).length;if(R.sequencesAvail=t,!t)return!1;var i,a=e[R.selectedSequence.value],n={};for(i in E)n[E[i]]=0;R.buildingSequence=a.map(function(e){return{level:++n[e],building:e,checked:!1}}),R.updateVisibleBuildingSequence()},R.updateVisibleBuildingSequence=function(){var e=h.pagination.buildingSequenceEditor.offset,t=h.pagination.buildingSequenceEditor.limit;R.visibleBuildingSequence=R.buildingSequence.slice(e,e+t),h.pagination.buildingSequenceEditor.count=R.buildingSequence.length},R.updateBuildingSequence=function(){var e=R.selectedSequence.value,t=R.buildingSequence.map(function(e){return e.building});switch(o.updateBuildingSequence(e,t)){case m.SEQUENCE_NO_EXISTS:l.emitNotif("error",_("i18n")("error_sequence_no_exits",i.loc.ale,S));break;case m.SEQUENCE_INVALID:l.emitNotif("error",_("i18n")("error_sequence_invalid",i.loc.ale,S))}},R.modal.removeSequence=function(){var e=i.$new(),t="builder_queue_remove_sequence_modal";e.title=_("i18n")("title",i.loc.ale,t),e.text=_("i18n")("text",i.loc.ale,t),e.submitText=_("i18n")("remove",i.loc.ale,"common"),e.cancelText=_("i18n")("cancel",i.loc.ale,"common"),e.submit=function(){e.closeWindow(),o.removeSequence(R.selectedSequence.value)},e.cancel=function(){e.closeWindow()},c.getModal("modal_attention",e)},R.modal.addBuilding=function(){var e,t=i.$new();for(e in t.buildings=[],t.position=1,t.indexLimit=R.buildingSequence.length+1,t.selectedBuilding={name:_("i18n")(E.HEADQUARTER,i.loc.ale,"building_names"),value:E.HEADQUARTER},A)t.buildings.push({name:_("i18n")(e,i.loc.ale,"building_names"),value:e});t.add=function(){var e=t.selectedBuilding.value,a=t.position,n=_("i18n")(e,i.loc.ale,"building_names"),o=A[e].max_level;R.addBuilding(e,a)?(t.closeWindow(),l.emitNotif("success",_("i18n")("add_building_success",i.loc.ale,S,n,a))):l.emitNotif("error",_("i18n")("add_building_limit_exceeded",i.loc.ale,S,n,o))},c.getModal("!twoverflow_builder_queue_add_building_modal",t)},R.modal.nameSequence=function(){var e=i.$new(),t=R.selectedSequence.name,a=h.settings[u.BUILDING_SEQUENCES][t];e.name=t,e.submit=function(){if(e.name.length<3)return l.emitNotif("error",_("i18n")("name_sequence_min_lenght",i.loc.ale,S)),!1;D(e.name,a)&&e.closeWindow()},c.getModal("!twoverflow_builder_queue_name_sequence_modal",e)},C.updateVisibleLogs=function(){var e=h.pagination.logs.offset,t=h.pagination.logs.limit;C.visibleLogs=C.logs.slice(e,e+t),h.pagination.logs.count=C.logs.length},C.clearLogs=function(){o.clearLogs()};var G=function(){var e=i.$new(),t=[E.HEADQUARTER];e.name="",e.submit=function(){if(e.name.length<3)return l.emitNotif("error",_("i18n")("name_sequence_min_lenght",i.loc.ale,S)),!1;D(e.name,t)&&(h.settings[u.ACTIVE_SEQUENCE]={name:e.name,value:e.name},h.settings[u.BUILDING_SEQUENCES][e.name]=t,k(!0),x.selectedSequence={name:e.name,value:e.name},R.selectedSequence={name:e.name,value:e.name},x.generateSequences(),R.generateBuildingSequence(),e.closeWindow(),P(L.SEQUENCES))},c.getModal("!twoverflow_builder_queue_name_sequence_modal",e)},P=function(e){h.selectedTab=e},k=function(e){var t,i=angular.copy(h.settings);for(t in g)"select"===g[t].inputType&&(i[t]=i[t].value);o.updateSettings(i,e)},U=function(){o.isRunning()?o.stop():o.start()},q={updateGroups:function(){h.groups=l.obj2selectOptions(w.getGroups(),!0),h.groups.unshift(y())},updateSequences:function(){var e,t=[],i=h.settings[u.BUILDING_SEQUENCES];for(e in i)t.push({name:e,value:e});h.sequences=t},generateBuildingSequences:function(){x.generateSequences()},generateBuildingSequencesEditor:function(){R.generateBuildingSequence()},updateLogs:function(){h.logs=o.getLogs(),C.updateVisibleLogs()},clearLogs:function(){l.emitNotif("success",_("i18n")("logs_cleared",i.loc.ale,S)),q.updateLogs()},buildingSequenceUpdate:function(e,t){var a=o.getSettings();h.settings[u.BUILDING_SEQUENCES][t]=a[u.BUILDING_SEQUENCES][t],h.settings[u.ACTIVE_SEQUENCE].value===t&&x.generateSequences(),l.emitNotif("success",_("i18n")("sequence_updated",i.loc.ale,S,t))},buildingSequenceAdd:function(e,t){var a=o.getSettings();h.settings[u.BUILDING_SEQUENCES][t]=a[u.BUILDING_SEQUENCES][t],q.updateSequences(),l.emitNotif("success",_("i18n")("sequence_created",i.loc.ale,S,t))},buildingSequenceRemoved:function(e,t){var a;delete h.settings[u.BUILDING_SEQUENCES][t],a=function(e){for(var t in e)if(e.hasOwnProperty(t))return t;return!1}(h.settings[u.BUILDING_SEQUENCES]),R.selectedSequence={name:a,value:a},q.updateSequences(),R.generateBuildingSequence(),h.settings[u.ACTIVE_SEQUENCE].value===t&&(h.settings[u.ACTIVE_SEQUENCE]={name:a,value:a},x.generateSequences()),l.emitNotif("success",_("i18n")("sequence_removed",i.loc.ale,S,t))},saveSettings:function(){l.emitNotif("success",_("i18n")("settings_saved",i.loc.ale,S))},started:function(){h.running=!0},stopped:function(){h.running=!1}},V=function(){var t,a,n,l;(h=e.$scope=i.$new()).textObject=S,h.textObjectCommon="common",h.selectedTab=L.SETTINGS,h.TAB_TYPES=L,h.SETTINGS=u,h.running=I,h.settings=(t=o.getSettings(),a=angular.copy(t),n=w.getGroups(),l=n[a[u.GROUP_VILLAGES]],a[u.GROUP_VILLAGES]=l?{name:n[a[u.GROUP_VILLAGES]].name,value:a[u.GROUP_VILLAGES]}:y(),a[u.ACTIVE_SEQUENCE]={name:a[u.ACTIVE_SEQUENCE],value:a[u.ACTIVE_SEQUENCE]},a),h.pagination={},h.editorView=R,h.editorView.buildingSequence={},h.editorView.visibleBuildingSequence={},h.editorView.selectedSequence=angular.copy(h.settings[u.ACTIVE_SEQUENCE]),h.settingsView=x,h.settingsView.buildingSequence={},h.settingsView.buildingSequenceFinal={},h.logsView=C,h.logsView.logs=o.getLogs(),h.selectTab=P,h.switchBuilder=U,h.saveSettings=k,h.createFirstSequence=G,h.openVillageInfo=s.openVillageInfo,q.updateGroups(),q.updateSequences(),h.pagination.buildingSequence={count:x.buildingSequence.length,offset:0,loader:x.updateVisibleBuildingSequence,limit:p.getPaginationLimit()},h.pagination.buildingSequenceEditor={count:R.buildingSequence.length,offset:0,loader:R.updateVisibleBuildingSequence,limit:p.getPaginationLimit()},h.pagination.logs={count:h.length,offset:0,loader:C.updateVisibleLogs,limit:p.getPaginationLimit()},x.generateSequences(),R.generateBuildingSequence(),h.$watch("settings[SETTINGS.ACTIVE_SEQUENCE].value",q.generateBuildingSequences),h.$watch("editorView.selectedSequence.value",q.generateBuildingSequencesEditor),(b=new v("twoverflow_builder_queue_window")).register(r.GROUPS_UPDATED,q.updateGroups,!0),b.register(r.GROUPS_CREATED,q.updateGroups,!0),b.register(r.GROUPS_DESTROYED,q.updateGroups,!0),b.register(r.VILLAGE_SELECTED_CHANGED,q.generateBuildingSequences,!0),b.register(r.BUILDING_UPGRADING,q.generateBuildingSequences,!0),b.register(r.BUILDING_LEVEL_CHANGED,q.generateBuildingSequences,!0),b.register(r.BUILDING_TEARING_DOWN,q.generateBuildingSequences,!0),b.register(r.VILLAGE_BUILDING_QUEUE_CHANGED,q.generateBuildingSequences,!0),b.register(r.BUILDER_QUEUE_JOB_STARTED,q.updateLogs),b.register(r.BUILDER_QUEUE_CLEAR_LOGS,q.clearLogs),b.register(r.BUILDER_QUEUE_BUILDING_SEQUENCES_UPDATED,q.buildingSequenceUpdate),b.register(r.BUILDER_QUEUE_BUILDING_SEQUENCES_ADDED,q.buildingSequenceAdd),b.register(r.BUILDER_QUEUE_BUILDING_SEQUENCES_REMOVED,q.buildingSequenceRemoved),b.register(r.BUILDER_QUEUE_SETTINGS_CHANGE,q.saveSettings),b.register(r.BUILDER_QUEUE_START,q.started),b.register(r.BUILDER_QUEUE_STOP,q.stopped),c.getScreenWithInjectedScope("!twoverflow_builder_queue_window",h)};return function(){A=n.getGameData().getBuildings(),x.generateBuildingsLevelPoints();var e=new a("Builder",{classHover:!1,classBlur:!1,onClick:V});f.register(r.BUILDER_QUEUE_START,function(){I=!0,e.$elem.classList.remove("btn-green"),e.$elem.classList.add("btn-red"),l.emitNotif("success",_("i18n")("started",i.loc.ale,S))}),f.register(r.BUILDER_QUEUE_STOP,function(){I=!1,e.$elem.classList.remove("btn-red"),e.$elem.classList.add("btn-green"),l.emitNotif("success",_("i18n")("stopped",i.loc.ale,S))}),t.addTemplate("twoverflow_builder_queue_window",'<div id="two-builder-queue" class="win-content two-window"><header class="win-head"><h2>BuilderQueue</h2><ul class="list-btn"><li><a href="#" class="size-34x34 btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main small-select" scrollbar=""><div class="tabs tabs-bg"><div class="tabs-three-col"><div class="tab" ng-click="selectTab(TAB_TYPES.SETTINGS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.SETTINGS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.SETTINGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.SETTINGS}">{{ TAB_TYPES.SETTINGS | i18n:loc.ale:textObjectCommon }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.SEQUENCES)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.SEQUENCES}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.SEQUENCES}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.SEQUENCES}">{{ TAB_TYPES.SEQUENCES | i18n:loc.ale:textObject }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.LOGS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.LOGS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.LOGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.LOGS}">{{ TAB_TYPES.LOGS | i18n:loc.ale:textObjectCommon }}</a></div></div></div></div></div><div class="box-paper footer"><div class="scroll-wrap"><div ng-show="selectedTab === TAB_TYPES.SETTINGS"><h5 class="twx-section">{{ \'settings\' | i18n:loc.ale:textObject }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="ff-cell-fix">{{ \'settings_village_groups\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="groups" selected="settings[SETTINGS.GROUP_VILLAGES]" drop-down="true"></div></td></tr><tr ng-show="settingsView.sequencesAvail"><td><span class="ff-cell-fix">{{ \'settings_building_sequence\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="sequences" selected="settings[SETTINGS.ACTIVE_SEQUENCE]" drop-down="true"></div></td></tr></tbody></table><h5 class="twx-section">{{ \'settings_building_sequence\' | i18n:loc.ale:textObject }}</h5><p ng-show="!settingsView.sequencesAvail" class="text-center"><a href="#" class="btn-orange btn-border create-sequence" ng-click="createFirstSequence()">{{ \'create_sequence\' | i18n:loc.ale:textObject }}</a></p><div ng-if="settingsView.sequencesAvail"><div class="page-wrap" pagination="pagination.buildingSequence"></div><table class="tbl-border-light header-center building-sequence"><colgroup><col width="5%"><col width="30%"><col width="7%"><col width="13%"><col width="8%"><col></colgroup><tr><th tooltip="" tooltip-content="{{ \'position\' | i18n:loc.ale:textObject }}">#</th><th>{{ \'building\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'level\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'duration\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'points\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'costs\' | i18n:loc.ale:textObjectCommon }}</th></tr><tr ng-repeat="item in settingsView.visibleBuildingSequence track by $index" class="{{ item.state }}"><td>{{ pagination.buildingSequence.offset + $index + 1 }}</td><td><span class="building-icon icon-20x20-building-{{ item.building }}"></span> {{ item.building | i18n:loc.ale:\'building_names\' }}</td><td>{{ item.level }}</td><td>{{ item.duration }}</td><td class="green">+{{ item.levelPoints }}</td><td><span class="icon-26x26-resource-wood"></span> {{ item.price.wood }} <span class="icon-26x26-resource-clay"></span> {{ item.price.clay }} <span class="icon-26x26-resource-iron"></span> {{ item.price.iron }}</td></tr></table><div class="page-wrap" pagination="pagination.buildingSequence"></div></div><h5 ng-if="settingsView.sequencesAvail" class="twx-section">{{ \'settings_building_sequence_final\' | i18n:loc.ale:textObject }}</h5><table ng-if="settingsView.sequencesAvail" class="tbl-border-light tbl-striped header-center building-sequence-final"><colgroup><col width="5%"><col width="70%"><col></colgroup><tr><th colspan="2">{{ \'building\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'level\' | i18n:loc.ale:textObjectCommon }}</th></tr><tr ng-repeat="item in settingsView.buildingSequenceFinal | orderBy:\'order\'"><td><span class="building-icon icon-20x20-building-{{ item.building }}"></span></td><td>{{ item.building | i18n:loc.ale:\'building_names\' }}</td><td>{{ item.level }}</td></tr></table></div><div ng-show="selectedTab === TAB_TYPES.SEQUENCES"><h5 class="twx-section">{{ \'sequences_edit_sequence\' | i18n:loc.ale:textObject }}</h5><p ng-show="!editorView.sequencesAvail" class="text-center"><a href="#" class="btn-orange btn-border create-sequence" ng-click="createFirstSequence()">{{ \'create_sequence\' | i18n:loc.ale:textObject }}</a></p><table ng-if="editorView.sequencesAvail" class="tbl-border-light tbl-striped editor-select-sequence"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="ff-cell-fix">{{ \'sequences_select_edit\' | i18n:loc.ale:textObject }}</span></td><td><div class="select-sequence-editor" select="" list="sequences" selected="editorView.selectedSequence" drop-down="true"></div><a class="btn btn-orange clone-sequence" ng-click="editorView.modal.nameSequence()" tooltip="" tooltip-content="{{ \'tooltip_clone\' | i18n:loc.ale:textObject }}">{{ \'clone\' | i18n:loc.ale:textObject }}</a> <a href="#" class="btn-red remove-sequence icon-20x20-close" ng-click="editorView.modal.removeSequence()" tooltip="" tooltip-content="{{ \'tooltip_remove_sequence\' | i18n:loc.ale:textObject }}"></a></td></tr></tbody></table><div ng-if="editorView.sequencesAvail"><div class="page-wrap" pagination="pagination.buildingSequenceEditor"></div><table class="tbl-border-light tbl-striped header-center building-sequence-editor"><colgroup><col width="5%"><col width="5%"><col><col width="7%"><col width="10%"></colgroup><tr><th></th><th tooltip="" tooltip-content="{{ \'position\' | i18n:loc.ale:textObject }}">#</th><th>{{ \'building\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'level\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'actions\' | i18n:loc.ale:textObjectCommon }}</th></tr><tr ng-repeat="item in editorView.visibleBuildingSequence track by $index" ng-class="{\'selected\': item.checked}"><td><label class="size-26x26 btn-orange icon-26x26-checkbox" ng-class="{\'icon-26x26-checkbox-checked\': item.checked}"><input type="checkbox" ng-model="item.checked"></label></td><td>{{ pagination.buildingSequenceEditor.offset + $index + 1 }}</td><td><span class="building-icon icon-20x20-building-{{ item.building }}"></span> {{ item.building | i18n:loc.ale:\'building_names\' }}</td><td>{{ item.level }}</td><td><a href="#" class="size-20x20 btn-red icon-20x20-close" ng-click="editorView.removeBuilding(pagination.buildingSequenceEditor.offset + $index)" tooltip="" tooltip-content="{{ \'remove_building\' | i18n:loc.ale:textObject }}"></a></td></tr></table><div class="page-wrap" pagination="pagination.buildingSequenceEditor"></div></div></div><div ng-show="selectedTab === TAB_TYPES.LOGS" class="rich-text"><div class="page-wrap" pagination="pagination.logs"></div><table class="tbl-border-light tbl-striped header-center logs"><colgroup><col width="40%"><col width="30%"><col width="5%"><col width="25%"><col></colgroup><thead><tr><th>{{ \'village\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'building\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'level\' | i18n:loc.ale:textObjectCommon }}</th><th>{{ \'started_at\' | i18n:loc.ale:textObjectCommon }}</th></tr></thead><tbody><tr ng-show="!logsView.logs.length"><td colspan="4">{{ \'logs_no_builds\' | i18n:loc.ale:textObject }}</td></tr><tr ng-repeat="log in logsView.logs"><td><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(log[0].id)">{{ log[0].name }} ({{ log[0].x }}|{{ log[0].y }})</span></td><td><span class="building-icon icon-20x20-building-{{ log[1] }}"></span> {{ log[1] | i18n:loc.ale:\'building_names\' }}</td><td>{{ log[2] }}</td><td>{{ log[3] | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</td></tr></tbody></table><div class="page-wrap" pagination="pagination.logs"></div></div></div></div></div><footer class="win-foot"><ul class="list-btn list-center"><li ng-show="selectedTab === TAB_TYPES.SETTINGS && settingsView.sequencesAvail"><a href="#" class="btn-border btn-orange" ng-click="saveSettings()">{{ \'save\' | i18n:loc.ale:textObjectCommon }}</a></li><li ng-show="selectedTab === TAB_TYPES.SETTINGS && settingsView.sequencesAvail"><a href="#" ng-class="{false:\'btn-orange\', true:\'btn-red\'}[running]" class="btn-border" ng-click="switchBuilder()"><span ng-show="running">{{ \'pause\' | i18n:loc.ale:textObjectCommon }}</span> <span ng-show="!running">{{ \'start\' | i18n:loc.ale:textObjectCommon }}</span></a></li><li ng-show="selectedTab === TAB_TYPES.LOGS"><a href="#" class="btn-border btn-orange" ng-click="logsView.clearLogs()">{{ \'logs_clear\' | i18n:loc.ale:textObject }}</a></li><li ng-show="selectedTab === TAB_TYPES.SEQUENCES && editorView.sequencesAvail"><a href="#" class="btn-border btn-orange" ng-click="editorView.moveUp()">{{ \'sequences_move_up\' | i18n:loc.ale:textObject }}</a></li><li ng-show="selectedTab === TAB_TYPES.SEQUENCES && editorView.sequencesAvail"><a href="#" class="btn-border btn-orange" ng-click="editorView.moveDown()">{{ \'sequences_move_down\' | i18n:loc.ale:textObject }}</a></li><li ng-show="selectedTab === TAB_TYPES.SEQUENCES && editorView.sequencesAvail"><a href="#" class="btn-border btn-orange" ng-click="editorView.modal.addBuilding()">{{ \'sequences_add_building\' | i18n:loc.ale:textObject }}</a></li><li ng-show="selectedTab === TAB_TYPES.SEQUENCES && editorView.sequencesAvail"><a href="#" class="btn-border btn-red" ng-click="editorView.updateBuildingSequence()">{{ \'save\' | i18n:loc.ale:textObjectCommon }}</a></li></ul></footer></div>'),t.addTemplate("twoverflow_builder_queue_add_building_modal",'<div id="add-building-modal" class="win-content" ng-init="textObject = \'builder_queue_add_building_modal\'"><header class="win-head"><h3>{{ \'title\' | i18n:loc.ale:textObject }}</h3><ul class="list-btn sprite"><li><a href="#" class="btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main" scrollbar=""><div class="box-paper"><div class="scroll-wrap unit-operate-slider"><table class="tbl-border-light tbl-striped header-center"><colgroup><col width="15%"><col><col width="15%"></colgroup><tr><td>{{ \'building\' | i18n:loc.ale:\'common\' }}</td><td colspan="2"><div select="" list="buildings" selected="selectedBuilding" drop-down="true"></div></td></tr><tr><td>{{ \'position\' | i18n:loc.ale:\'builder_queue\' }}</td><td><div range-slider="" min="1" max="indexLimit" value="position" enabled="true"></div></td><td><input type="text" class="input-border text-center" ng-model="position"></td></tr></table></div></div></div><footer class="win-foot sprite-fill"><ul class="list-btn list-center"><li><a href="#" class="btn-red btn-border btn-premium" ng-click="closeWindow()">{{ \'cancel\' | i18n:loc.ale:\'common\' }}</a></li><li><a href="#" class="btn-orange btn-border" ng-click="add()">{{ \'add\' | i18n:loc.ale:\'common\' }}</a></li></ul></footer></div>'),t.addTemplate("twoverflow_builder_queue_name_sequence_modal",'<div id="name-sequence-modal" class="win-content" ng-init="textObject = \'builder_queue_name_sequence_modal\'"><header class="win-head"><h3>{{ \'title\' | i18n:loc.ale:textObject }}</h3><ul class="list-btn sprite"><li><a href="#" class="btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main" scrollbar=""><div class="box-paper"><div class="scroll-wrap"><div class="box-border-light input-wrapper name_preset"><form ng-submit="submit()"><input type="text" focus="true" ng-model="name" minlength="3"></form></div></div></div></div><footer class="win-foot sprite-fill"><ul class="list-btn list-center"><li><a href="#" class="btn-red btn-border btn-premium" ng-click="closeWindow()">{{ \'cancel\' | i18n:loc.ale:\'common\' }}</a></li><li><a href="#" class="btn-orange btn-border" ng-click="submit()">{{ \'add\' | i18n:loc.ale:\'common\' }}</a></li></ul></footer></div>'),t.addStyle('#two-builder-queue tr.reached td{background-color:#b9af7e}#two-builder-queue tr.progress td{background-color:#af9d57}#two-builder-queue .building-sequence,#two-builder-queue .building-sequence-final,#two-builder-queue .building-sequence-editor,#two-builder-queue .logs{margin-bottom:10px}#two-builder-queue .building-sequence td,#two-builder-queue .building-sequence-final td,#two-builder-queue .building-sequence-editor td,#two-builder-queue .logs td,#two-builder-queue .building-sequence th,#two-builder-queue .building-sequence-final th,#two-builder-queue .building-sequence-editor th,#two-builder-queue .logs th{text-align:center}#two-builder-queue .building-sequence-editor .selected td{background-color:#b9af7e}#two-builder-queue .editor-select-sequence{margin-bottom:13px}#two-builder-queue a.btn{height:28px;line-height:28px;padding:0 10px}#two-builder-queue .clone-sequence{float:left;margin-right:10px}#two-builder-queue .select-sequence-editor{float:left;margin-top:1px;margin-right:10px}#two-builder-queue .remove-sequence{width:28px;height:28px}#two-builder-queue .create-sequence{padding:8px 20px 8px 20px}#add-building-modal td{text-align:center}#add-building-modal .select-wrapper{width:250px}#add-building-modal input[type="text"]{width:60px}')}}),define("two/commandQueue",["two/utils","two/commandQueue/dateTypes","two/commandQueue/eventCodes","two/commandQueue/filterTypes","two/commandQueue/commandTypes","two/commandQueue/storageKeys","queues/EventQueue","helper/time","helper/math","struct/MapData","Lockr"],function(t,i,a,s,c,d,u,g,_,p,m){var E,v="invalid_rigin",f="invalid_target",T=[],b={},h=[],A=[],S=!1,w={[s.SELECTED_VILLAGE]:function(e){return e.origin.id===n.getSelectedVillage().getId()},[s.BARBARIAN_TARGET]:function(e){return!e.target.character_id},[s.ALLOWED_TYPES]:function(e,t){return t[s.ALLOWED_TYPES][e.type]},[s.ATTACK]:function(e){return e.type!==c.ATTACK},[s.SUPPORT]:function(e){return e.type!==c.SUPPORT},[s.RELOCATE]:function(e){return e.type!==c.RELOCATE},[s.TEXT_MATCH]:function(e,t){var i=!0,a=t[s.TEXT_MATCH].toLowerCase().split(/\W/),n=[e.origin.name,e.origin.x+"|"+e.origin.y,e.origin.character_name||"",e.target.name,e.target.x+"|"+e.target.y,e.target.character_name||"",e.target.tribe_name||"",e.target.tribe_tag||""];return n=n.join("").toLowerCase(),a.some(function(e){if(e.length&&!n.includes(e))return i=!1,!0}),i}},O=function(e){return e<g.gameTime()+E},I=function(e){T.push(e)},R=function(e){b[e.id]=e},x=function(){m.set(d.QUEUE_COMMANDS,T)},C=function(e){if(e.hasOwnProperty("countdown"))return!1;e.countdown=function(){return g.readableMilliseconds(Date.now()-e.sendTime)}},L={initialized:!1};return L.init=function(){E=t.getTimeOffset(),n.getSelectedCharacter(),L.initialized=!0,h=m.get(d.QUEUE_SENT,[],!0),A=m.get(d.QUEUE_EXPIRED,[],!0),function(){var e=m.get(d.QUEUE_COMMANDS,[],!0);if(e.length)for(var t=0;t<e.length;t++){var i=e[t];g.gameTime()>i.sendTime?L.expireCommand(i,a.TIME_LIMIT):(C(i),I(i),R(i))}}(),setInterval(function(){T.length&&T.some(function(e){if(!O(e.sendTime))return!0;S?L.sendCommand(e):L.expireCommand(e,a.TIME_LIMIT)})},100),e.addEventListener("beforeunload",function(e){S&&T.length&&(e.returnValue=!0)})},L.sendCommand=function(e){var t=function(e){var t,i,o,l,r=n.getVillages()[e.origin.id];if(!r)return a.NOT_OWN_VILLAGE;for(o in t=r.unitInfo.units,i={},e.units){if("*"===(l=e.units[o])){if(0===(l=t[o].available))continue}else if(l<0){if((l=t[o].available-Math.abs(l))<0)return a.NOT_ENOUGH_UNITS}else if(l>0&&l>t[o].available)return a.NOT_ENOUGH_UNITS;i[o]=l}return angular.equals({},i)?a.NOT_ENOUGH_UNITS:i}(e);if("string"==typeof t)return L.expireCommand(e,t);e.units=t,o.emit(l.SEND_CUSTOM_ARMY,{start_village:e.origin.id,target_village:e.target.id,type:e.type,units:e.units,icon:0,officers:e.officers,catapult_target:e.catapultTarget}),function(e){h.push(e)}(e),m.set(d.QUEUE_SENT,h),L.removeCommand(e,a.COMMAND_SENT),u.trigger(r.COMMAND_QUEUE_SEND,e)},L.expireCommand=function(e,t){!function(e){A.push(e)}(e),m.set(d.QUEUE_EXPIRED,A),L.removeCommand(e,t)},L.addCommand=function(e){if(!e.origin)return u.trigger(r.COMMAND_QUEUE_ADD_INVALID_ORIGIN,e);if(!e.target)return u.trigger(r.COMMAND_QUEUE_ADD_INVALID_TARGET,e);if(!t.isValidDateTime(e.date))return u.trigger(r.COMMAND_QUEUE_ADD_INVALID_DATE,e);if(!e.units||angular.equals(e.units,{}))return u.trigger(r.COMMAND_QUEUE_ADD_NO_UNITS,e);var a=new Promise(function(t,i){L.getVillageByCoords(e.origin.x,e.origin.y,function(e){e?t(e):i(v)})}),n=new Promise(function(t,i){L.getVillageByCoords(e.target.x,e.target.y,function(e){e?t(e):i(f)})}),o=Promise.all([a,n]);for(var l in e.officers)e.officers[l]?e.officers[l]=1:delete e.officers[l];o.then(function(a){e.origin=a[0],e.target=a[1],e.units=function(e){var t,i,a={};for(t in e)"*"!==(i=e[t])&&0===i||(a[t]=i);return a}(e.units),e.date=t.fixDate(e.date),e.travelTime=t.getTravelTime(e.origin,e.target,e.units,e.type,e.officers);var n=t.getTimeFromString(e.date);if(e.dateType===i.ARRIVE)e.sendTime=n-e.travelTime,e.arriveTime=n;else{if(e.dateType!==i.OUT)throw new Error("CommandQueue: wrong dateType:"+e.dateType);e.sendTime=n,e.arriveTime=n+e.travelTime}if(O(e.sendTime))return u.trigger(r.COMMAND_QUEUE_ADD_ALREADY_SENT,e);e.type===c.ATTACK&&"supporter"in e.officers&&delete e.officers.supporter,e.type===c.ATTACK&&e.units.catapult?e.catapultTarget=e.catapultTarget||"headquarter":e.catapultTarget=null,e.id=t.guid(),C(e),I(e),R(e),T=T.sort(function(e,t){return e.sendTime-t.sendTime}),x(),u.trigger(r.COMMAND_QUEUE_ADD,e)}),o.catch(function(t){switch(t){case v:u.trigger(r.COMMAND_QUEUE_ADD_INVALID_ORIGIN,e);break;case f:u.trigger(r.COMMAND_QUEUE_ADD_INVALID_TARGET,e)}})},L.removeCommand=function(e,t){var i=!1;delete b[e.id];for(var n=0;n<T.length;n++)if(T[n].id==e.id){T.splice(n,1),x(),i=!0;break}if(i){switch(t){case a.TIME_LIMIT:u.trigger(r.COMMAND_QUEUE_SEND_TIME_LIMIT,e);break;case a.NOT_OWN_VILLAGE:u.trigger(r.COMMAND_QUEUE_SEND_NOT_OWN_VILLAGE,e);break;case a.NOT_ENOUGH_UNITS:u.trigger(r.COMMAND_QUEUE_SEND_NO_UNITS_ENOUGH,e);break;case a.COMMAND_REMOVED:u.trigger(r.COMMAND_QUEUE_REMOVE,e)}return!0}return u.trigger(r.COMMAND_QUEUE_REMOVE_ERROR,e),!1},L.clearRegisters=function(){m.set(d.QUEUE_EXPIRED,[]),m.set(d.QUEUE_SENT,[]),A=[],h=[]},L.start=function(e){S=!0,u.trigger(r.COMMAND_QUEUE_START,{disableNotif:!!e})},L.stop=function(){S=!1,u.trigger(r.COMMAND_QUEUE_STOP)},L.isRunning=function(){return S},L.getWaitingCommands=function(){return T},L.getWaitingCommandsObject=function(){return b},L.getSentCommands=function(){return h},L.getExpiredCommands=function(){return A},L.getVillageByCoords=function(e,t,i){p.loadTownDataAsync(e,t,1,1,i)},L.filterCommands=function(e,t,i){var a=w[e];return(i||T).filter(function(e){return a(e,t)})},L}),define("two/commandQueue/commandTypes",[],function(){return{ATTACK:"attack",SUPPORT:"support",RELOCATE:"relocate"}}),define("two/commandQueue/dateTypes",[],function(){return{ARRIVE:"date_type_arrive",OUT:"date_type_out"}}),define("two/commandQueue/eventCodes",[],function(){return{NOT_OWN_VILLAGE:"not_own_village",NOT_ENOUGH_UNITS:"not_enough_units",TIME_LIMIT:"time_limit",COMMAND_REMOVED:"command_removed",COMMAND_SENT:"command_sent"}}),define("two/commandQueue/events",[],function(){angular.extend(r,{COMMAND_QUEUE_SEND:"commandqueue_send",COMMAND_QUEUE_SEND_TIME_LIMIT:"commandqueue_send_time_limit",COMMAND_QUEUE_SEND_NOT_OWN_VILLAGE:"commandqueue_send_not_own_village",COMMAND_QUEUE_SEND_NO_UNITS_ENOUGH:"commandqueue_send_no_units_enough",COMMAND_QUEUE_ADD:"commandqueue_add",COMMAND_QUEUE_ADD_INVALID_ORIGIN:"commandqueue_add_invalid_origin",COMMAND_QUEUE_ADD_INVALID_TARGET:"commandqueue_add_invalid_target",COMMAND_QUEUE_ADD_INVALID_DATE:"commandqueue_add_invalid_date",COMMAND_QUEUE_ADD_NO_UNITS:"commandqueue_add_no_units",COMMAND_QUEUE_ADD_ALREADY_SENT:"commandqueue_add_already_sent",COMMAND_QUEUE_ADD_INVALID_ORIGIN:"commandqueue_add_invalid_origin",COMMAND_QUEUE_ADD_INVALID_TARGET:"commandqueue_add_invalid_target",COMMAND_QUEUE_REMOVE:"commandqueue_remove",COMMAND_QUEUE_REMOVE_ERROR:"commandqueue_remove_error",COMMAND_QUEUE_START:"commandqueue_start",COMMAND_QUEUE_STOP:"commandqueue_stop"})}),define("two/commandQueue/filterTypes",[],function(){return{SELECTED_VILLAGE:"selected_village",BARBARIAN_TARGET:"barbarian_target",ALLOWED_TYPES:"allowed_types",ATTACK:"attack",SUPPORT:"support",RELOCATE:"relocate",TEXT_MATCH:"text_match"}}),define("two/commandQueue/storageKeys",[],function(){return{QUEUE_COMMANDS:"command_queue_commands",QUEUE_SENT:"command_queue_sent",QUEUE_EXPIRED:"command_queue_expired",LAST_DATE_TYPE:"command_queue_last_date_type"}}),require(["two/language","two/ready","two/commandQueue","two/commandQueue/ui","two/commandQueue/events"],function(e,t,i,a){if(i.initialized)return!1;t(function(){e.add("command_queue",{en_us:{command_queue:{attack:"Attack",support:"Support",relocate:"Transfer",sent:"sent",activated:"enabled",deactivated:"disabled",expired:"expired",removed:"removed",added:"added",general_clear:"Clear logs",general_next_command:"Next command",add_basics:"Basic information",add_origin:"Origin",add_selected:"Active village",add_target:"Target",add_map_selected:"Selected village on a map",date_type_arrive:"Command arrive at date",date_type_out:"Command leave at date",add_current_date:"Current date",add_current_date_plus:"Increase date in 100 milliseconds.",add_current_date_minus:"Reduce date in 100 milliseconds.",add_travel_times:"Unit travel time",add_date:"Date/time",add_no_village:"select a village...",add_village_search:"Village search...",add_clear:"Clear fields",add_insert_preset:"Insert preset",queue_waiting:"Waiting commands",queue_none_added:"No command added.",queue_sent:"Commands sent",queue_none_sent:"No command sent.",queue_expired:"Expired commands",queue_none_expired:"No command expired.",queue_remove:"Remove command form list",queue_filters:"Filter commands",filters_selected_village:"Show only commands from the selected village",filters_barbarian_target:"Show only commands with barbarian villages as target",filters_attack:"Show attacks",filters_support:"Show supports",filters_relocate:"Show transfers",filters_text_match:"Filter by text...",command_out:"Out",command_time_left:"Time remaining",command_arrive:"Arrival",error_no_units_enough:"No units enough to send the command!",error_not_own_village:"The origin village is not owned by you!",error_origin:"Invalid origin village!",error_target:"Invalid target village!",error_no_units:"No units specified!",error_invalid_date:"Invalid date",error_already_sent:"This %{type} should have left %{date}",error_no_map_selected_village:"No selected village on map.",error_remove_error:"Error removing command.",tab_add:"Add command",tab_waiting:"Queued commands",tab_logs:"Command logs"}},pl_pl:{command_queue:{attack:"Atak",support:"Wsparcie",relocate:"przenie힄",sent:"wys흢any/e",activated:"w흢훳czony",deactivated:"wy흢훳czony",expired:"przedawniony/e",removed:"usuni휌ty/e",added:"dodany/e",general_clear:"Wyczy힄훶 logi",general_next_command:"Nast휌pny rozkaz",add_basics:"Podstawowe informacje",add_origin:"탁r처d흢o",add_selected:"Aktywna wioska",add_target:"Cel",add_map_selected:"Wybrana wioska na mapie",date_type_arrive:"Czas dotarcia na cel",date_type_out:"Czas wyj힄cia z  twojej wioski",add_current_date:"Obecny czas",add_current_date_plus:"Zwi휌ksz czas o 100 milisekund.",add_current_date_minus:"Zmniejsz czas o 100 milisekund.",add_travel_times:"Czas podr처탉y jednostek",add_date:"Czas/Data",add_no_village:"Wybierz wiosk휌...",add_village_search:"Znajd탄 wiosk휌...",add_clear:"wyczy힄훶",add_insert_preset:"Wybierz szablon",queue_waiting:"Rozkazy",queue_none_added:"Brak dodanych rozkaz처w.",queue_sent:"Rozkazy wys흢ane",queue_none_sent:"Brak wys흢anych rozkaz처w.",queue_expired:"Przedawnione rozkazy",queue_none_expired:"Brak przedawnionych rozkaz처w.",queue_remove:"Usu흦 rozkaz z listy",queue_filters:"Filtruj rozkazy",filters_selected_village:"Poka탉 tylko rozkazy z aktywnej wioski",filters_barbarian_target:"Poka탉 tylko rozkazy na wioski barbarzy흦skie",filters_attack:"Poka탉 ataki",filters_support:"Poka탉 wsparcia",filters_relocate:"Poka탉 przeniesienia",filters_text_match:"Filtruj za pomoc훳 tekstu...",command_out:"Czas wyj힄cia",command_time_left:"Pozosta흢y czas",command_arrive:"Czas dotarcia",error_no_units_enough:"Brak wystarczaj훳cej liczby jednostek do wys흢ania rozkazu!",error_not_own_village:"Wioska 탄r처d흢owa nie nale탉y do ciebie!",error_origin:"Nieprawid흢owa wioska 탄r처d흢owa!",error_target:"Nieprawid흢owa wioska cel!",error_no_units:"Nie wybrano jednostek!",error_invalid_date:"Nieprawid흢owy Czas",error_already_sent:"Ten rozkaz %{type} powinien zosta훶 wys흢any %{date}",error_no_map_selected_village:"Nie zaznaczono wioski na mapie.",error_remove_error:"B흢훳d usuwania rozkazu.",tab_add:"Dodaj rozkaz",tab_waiting:"Oczekuj훳ce",tab_logs:"Logi"}},pt_br:{command_queue:{attack:"Ataque",support:"Apoio",relocate:"Transfer챗ncia",sent:"enviado",activated:"ativado",deactivated:"desativado",expired:"expirado",removed:"removido",added:"adicionado",general_clear:"Limpar registros",general_next_command:"Pr처ximo comando",add_basics:"Informa챌천es b찼sicas",add_origin:"Aldeia de origem",add_selected:"Selecionar aldeia ativa",add_target:"Aldea alvo",add_map_selected:"Selecionar aldeia selecionada no mapa",date_type_arrive:"Data de chegada",date_type_out:"Data de sa챠da",add_current_date:"Data/hora",add_current_date_plus:"Aumentar data em 100 milisegunds.",add_current_date_minus:"Reduzir data em 100 milisegunds.",add_travel_times:"Tempos de viagem",add_date:"Data",add_no_village:"selecione uma aldeia...",add_village_search:"Procurar aldeia...",add_clear:"Limpar campos",add_insert_preset:"Inserir predefini챌찾o",queue_waiting:"Comandos em espera",queue_none_added:"Nenhum comando adicionado.",queue_sent:"Comandos enviados",queue_none_sent:"Nenhum comando enviado.",queue_expired:"Comandos expirados",queue_none_expired:"Nenhum comando expirado.",queue_remove:"Remover comando da lista",queue_filters:"Filtro de comandos",filters_selected_village:"Mostrar apenas comandos com origem da aldeia selecionada",filters_barbarian_target:"Mostrar apenas comandos com aldeias b찼rbaras como alvo",filters_attack:"Mostrar ataques",filters_support:"Mostrar apoios",filters_relocate:"Mostrar transfer챗ncias",filters_text_match:"Filtrar por texto...",command_out:"Sa챠da na data",command_time_left:"Tempo restante",command_arrive:"Chegada na data",error_no_units_enough:"Sem unidades o sulficientes para enviar o comando!",error_not_own_village:"A aldeia de origem n찾o pertence a voc챗!",error_origin:"Aldeia de origem inv찼lida!",error_target:"Aldeia alvo inv찼lida!",error_no_units:"Nenhuma unidade especificada!",error_invalid_date:"Data inv찼lida",error_already_sent:"Esse %d deveria ter sa챠do %d",error_no_map_selected_village:"Nenhuma aldeia selecionada no mapa.",error_remove_error:"Erro ao remover comando.",tab_add:"Adicionar comando",tab_waiting:"Comandos em espera",tab_logs:"Registro de comandos"}}}),i.init(),a(),i.getWaitingCommands().length>0&&i.start(!0)})}),define("two/commandQueue/ui",["two/ui","two/ui/button","two/commandQueue","two/EventScope","two/utils","two/commandQueue/dateTypes","two/commandQueue/eventCodes","two/commandQueue/filterTypes","two/commandQueue/commandTypes","two/commandQueue/storageKeys","queues/EventQueue","helper/time","helper/util","Lockr"],function(e,t,a,o,l,d,u,g,p,m,E,v,f,T){var b,h,A,S,w,O,I,R="command_queue",x=n.getGameData(),C=x.getOrderedUnitNames(),L=x.getOrderedOfficerNames(),y=n.getPresetList(),N=!1,M={ADD:"add",WAITING:"waiting",LOGS:"logs"},D=M.ADD,G=[],P={},k={},U=["light_cavalry","heavy_cavalry","archer","sword","ram","snob","trebuchet"],q=[g.SELECTED_VILLAGE,g.BARBARIAN_TARGET,g.ALLOWED_TYPES,g.TEXT_MATCH],V=function(e,t){N=t.data},j=function(){N=!1},B=function(e){var t=new Date(e||v.gameTime()+l.getTimeOffset()),i=t.getMilliseconds(),a=v.zerofill(i-i%100,3),n=v.zerofill(t.getSeconds(),2),o=v.zerofill(t.getMinutes(),2);return v.zerofill(t.getHours(),2)+":"+o+":"+n+":"+a+" "+v.zerofill(t.getDate(),2)+"/"+v.zerofill(t.getMonth()+1,2)+"/"+t.getFullYear()},H=function(e,t){return l.isValidDateTime(e)?(e=l.fixDate(e),e=l.getTimeFromString(e),B(e+=t)):""},z=function(){if(h.isValidDate=l.isValidDateTime(S.date),!S.origin||!S.target)return!1;var e,t,i,a,n,o;for(o in p)n=p[o],h.travelTimes[n]={},U.forEach(function(o){i=l.getTravelTime(S.origin,S.target,{[o]:1},n,S.officers),h.selectedDateType.value===d.OUT?h.isValidDate?(e=l.fixDate(S.date),outTime=l.getTimeFromString(e),a=Y(outTime)?"valid":"invalid"):a="neutral":h.selectedDateType.value===d.ARRIVE&&(h.isValidDate?(e=l.fixDate(S.date),t=l.getTimeFromString(e),a=Y(t-i)?"valid":"invalid"):a="invalid"),h.travelTimes[n][o]={value:_("readableMillisecondsFilter")(i),valueType:a}})},Y=function(e){return!!h.isValidDate&&v.gameTime()+w<e},F=function(){S.dateType=h.selectedDateType.value,T.set(m.LAST_DATE_TYPE,h.selectedDateType.value),z()},Q=function(){var e=h.selectedInsertPreset.value;if(!e)return!1;var t=n.getPresetList().getPresets()[e];h.selectedInsertPreset={name:_("i18n")("add_insert_preset",i.loc.ale,R),value:null},S.units=angular.copy(t.units),S.officers=angular.copy(t.officers),t.catapult_target&&(S.catapultTarget=t.catapult_target,h.catapultTarget={name:_("i18n")(t.catapult_target,i.loc.ale,"building_names"),value:t.catapult_target},h.showCatapultSelect=!0)},W=function(){h.waitingCommands=a.getWaitingCommands()},K=function(){h.sentCommands=a.getSentCommands()},X=function(){h.expiredCommands=a.getExpiredCommands()},$=function(){var e=h.waitingCommands;q.forEach(function(t){h.activeFilters[t]&&(e=a.filterCommands(t,h.filtersData,e))}),h.visibleWaitingCommands=e},Z=function(e){0===S.units[e]&&(S.units[e]="")},J=function(e){""===S.units[e]&&(S.units[e]=0)},ee=function(){h.showCatapultSelect=!!S.units.catapult},te=function(e){h.selectedTab=e},ie=function(){var e=n.getSelectedVillage().data;S.origin={id:e.villageId,x:e.x,y:e.y,name:e.name}},ae=function(){if(!N)return l.emitNotif("error",_("i18n")("error_no_map_selected_village",i.loc.ale,R));a.getVillageByCoords(N.x,N.y,function(e){S.target={id:e.id,x:e.x,y:e.y,name:e.name}})},ne=function(){S.date=B()},oe=function(){if(!S.date)return!1;S.date=H(S.date,100)},le=function(){if(!S.date)return!1;S.date=H(S.date,-100)},re=function(){S.units=angular.copy(P),S.officers=angular.copy(k),S.catapultTarget="wall",h.catapultTarget={name:_("i18n")("wall",i.loc.ale,"building_names"),value:"wall"},h.showCatapultSelect=!1},se=function(e){var t=angular.copy(S);t.type=e,a.addCommand(t)},ce=function(){a.clearRegisters(),K(),X()},de=function(){a.isRunning()?a.stop():a.start()},ue=function(e,t,a){return a&&(e=a+"."+e),_("i18n")(e,i.loc.ale,R)+" "+_("i18n")(t,i.loc.ale,R)},ge=function(e,t){h.activeFilters[e]=!h.activeFilters[e],t&&(h.filtersData[g.ALLOWED_TYPES][e]=!h.filtersData[g.ALLOWED_TYPES][e]),$()},_e=function(){h.activeFilters[g.TEXT_MATCH]=h.filtersData[g.TEXT_MATCH].length>0,$()},pe={updatePresets:function(){h.presets=l.obj2selectOptions(y.getPresets())},autoCompleteSelected:function(e,t,i,a){if("commandqueue_village_search"!==t)return!1;S[a]={id:i.raw.id,x:i.raw.x,y:i.raw.y,name:i.raw.name},h.searchQuery[a]=""},addInvalidOrigin:function(e){l.emitNotif("error",_("i18n")("error_origin",i.loc.ale,R))},addInvalidTarget:function(e){l.emitNotif("error",_("i18n")("error_target",i.loc.ale,R))},addInvalidDate:function(e){l.emitNotif("error",_("i18n")("error_invalid_date",i.loc.ale,R))},addNoUnits:function(e){l.emitNotif("error",_("i18n")("error_no_units",i.loc.ale,R))},addAlreadySent:function(e,t){var a=_("i18n")(t.type,i.loc.ale,"common"),n=l.formatDate(t.sendTime);l.emitNotif("error",_("i18n")("error_already_sent",i.loc.ale,R,a,n))},removeCommand:function(e,t){W(),$(),i.$broadcast(r.TOOLTIP_HIDE,"twoverflow-tooltip"),l.emitNotif("success",ue(t.type,"removed"))},removeError:function(e,t){l.emitNotif("error",_("i18n")("error_remove_error",i.loc.ale,R))},sendTimeLimit:function(e,t){K(),X(),W(),$(),l.emitNotif("error",ue(t.type,"expired"))},sendNotOwnVillage:function(e,t){K(),X(),W(),$(),l.emitNotif("error",_("i18n")("error_not_own_village",i.loc.ale,R))},sendNoUnitsEnough:function(e,t){K(),X(),W(),$(),l.emitNotif("error",_("i18n")("error_no_units_enough",i.loc.ale,R))},addCommand:function(e,t){W(),$(),l.emitNotif("success",ue(t.type,"added"))},sendCommand:function(e,t){K(),W(),$(),l.emitNotif("success",ue(t.type,"sent"))},start:function(e,t){if(h.running=a.isRunning(),t.disableNotif)return!1;l.emitNotif("success",ue("title","activated"))},stop:function(e){h.running=a.isRunning(),l.emitNotif("success",ue("title","deactivated"))},onAutoCompleteOrigin:function(e){S.origin={id:e.id,x:e.x,y:e.y,name:e.name}},onAutoCompleteTarget:function(e){S.target={id:e.id,x:e.x,y:e.y,name:e.name}}},me=function(){var e=T.get(m.LAST_DATE_TYPE,d.OUT,!0);(h=i.$new()).textObject=R,h.textObjectCommon="common",h.textObjectVillageInfo="screen_village_info",h.textObjectUnitNames="unit_names",h.textObjectMilitaryOperations="military_operations",h.selectedTab=D,h.inventory=n.getInventory(),h.presets=l.obj2selectOptions(y.getPresets()),h.travelTimes={},h.unitOrder=A,h.officers=x.getOrderedOfficerNames(),h.searchQuery={origin:"",target:""},h.isValidDate=!1,h.dateTypes=f.toActionList(d,function(e){return _("i18n")(e,i.loc.ale,R)}),h.selectedDateType={name:_("i18n")(e,i.loc.ale,R),value:e},h.selectedInsertPreset={name:_("i18n")("add_insert_preset",i.loc.ale,R),value:null},h.catapultTarget={name:_("i18n")("wall",i.loc.ale,"building_names"),value:"wall"},h.autoCompleteOrigin={type:["village"],placeholder:_("i18n")("add_village_search",i.loc.ale,R),onEnter:pe.onAutoCompleteOrigin,tooltip:_("i18n")("add_origin",i.loc.ale,R),dropDown:!0},h.autoCompleteTarget={type:["village"],placeholder:_("i18n")("add_village_search",i.loc.ale,R),onEnter:pe.onAutoCompleteTarget,tooltip:_("i18n")("add_target",i.loc.ale,R),dropDown:!0},h.showCatapultSelect=!!S.units.catapult,h.attackableBuildings=G,h.commandData=S,h.activeFilters=O,h.filtersData=I,h.running=a.isRunning(),h.waitingCommands=a.getWaitingCommands(),h.visibleWaitingCommands=a.getWaitingCommands(),h.sentCommands=a.getSentCommands(),h.expiredCommands=a.getExpiredCommands(),h.EVENT_CODES=u,h.FILTER_TYPES=g,h.TAB_TYPES=M,h.COMMAND_TYPES=p,h.onUnitInputFocus=Z,h.onUnitInputBlur=J,h.catapultTargetVisibility=ee,h.selectTab=te,h.addSelected=ie,h.addMapSelected=ae,h.addCurrentDate=ne,h.incrementDate=oe,h.reduceDate=le,h.cleanUnitInputs=re,h.addCommand=se,h.clearRegisters=ce,h.switchCommandQueue=de,h.removeCommand=a.removeCommand,h.openVillageInfo=s.openVillageInfo,h.toggleFilter=ge,h.$watch("commandData.origin",z),h.$watch("commandData.target",z),h.$watch("commandData.date",z),h.$watch("selectedDateType.value",F),h.$watch("selectedInsertPreset.value",Q),h.$watch("filtersData[FILTER_TYPES.TEXT_MATCH]",_e),(b=new o("twoverflow_queue_window")).register(r.ARMY_PRESET_UPDATE,pe.updatePresets,!0),b.register(r.ARMY_PRESET_DELETED,pe.updatePresets,!0),b.register(r.SELECT_SELECTED,pe.autoCompleteSelected,!0),b.register(r.COMMAND_QUEUE_ADD_INVALID_ORIGIN,pe.addInvalidOrigin),b.register(r.COMMAND_QUEUE_ADD_INVALID_TARGET,pe.addInvalidTarget),b.register(r.COMMAND_QUEUE_ADD_INVALID_DATE,pe.addInvalidDate),b.register(r.COMMAND_QUEUE_ADD_NO_UNITS,pe.addNoUnits),b.register(r.COMMAND_QUEUE_ADD_ALREADY_SENT,pe.addAlreadySent),b.register(r.COMMAND_QUEUE_REMOVE,pe.removeCommand),b.register(r.COMMAND_QUEUE_REMOVE_ERROR,pe.removeError),b.register(r.COMMAND_QUEUE_SEND_TIME_LIMIT,pe.sendTimeLimit),b.register(r.COMMAND_QUEUE_SEND_NOT_OWN_VILLAGE,pe.sendNotOwnVillage),b.register(r.COMMAND_QUEUE_SEND_NO_UNITS_ENOUGH,pe.sendNoUnitsEnough),b.register(r.COMMAND_QUEUE_ADD,pe.addCommand),b.register(r.COMMAND_QUEUE_SEND,pe.sendCommand),b.register(r.COMMAND_QUEUE_START,pe.start),b.register(r.COMMAND_QUEUE_STOP,pe.stop),c.getScreenWithInjectedScope("!twoverflow_queue_window",h)};return function(){w=l.getTimeOffset();var a,n=x.getAttackableBuildings();for(a in n)G.push({name:_("i18n")(a,i.loc.ale,"building_names"),value:a});(A=angular.copy(C)).splice(A.indexOf("catapult"),1),C.forEach(function(e){P[e]=0}),L.forEach(function(e){k[e]=!1}),S={origin:!1,target:!1,date:"",dateType:d.OUT,units:angular.copy(P),officers:angular.copy(k),catapultTarget:"wall",type:null},O={[g.SELECTED_VILLAGE]:!1,[g.BARBARIAN_TARGET]:!1,[g.ALLOWED_TYPES]:!0,[g.ATTACK]:!0,[g.SUPPORT]:!0,[g.RELOCATE]:!0,[g.TEXT_MATCH]:!1},I={[g.ALLOWED_TYPES]:{[g.ATTACK]:!0,[g.SUPPORT]:!0,[g.RELOCATE]:!0},[g.TEXT_MATCH]:""},opener=new t("Commander",{classHover:!1,classBlur:!1,onClick:me}),E.register(r.COMMAND_QUEUE_START,function(){opener.$elem.classList.remove("btn-green"),opener.$elem.classList.add("btn-red")}),E.register(r.COMMAND_QUEUE_STOP,function(){opener.$elem.classList.remove("btn-red"),opener.$elem.classList.add("btn-green")}),i.$on(r.SHOW_CONTEXT_MENU,V),i.$on(r.DESTROY_CONTEXT_MENU,j),e.addTemplate("twoverflow_queue_window",'<div id="two-command-queue" class="win-content two-window"><header class="win-head"><h2>CommandQueue</h2><ul class="list-btn"><li><a href="#" class="size-34x34 btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main small-select" scrollbar=""><div class="tabs tabs-bg"><div class="tabs-three-col"><div class="tab" ng-click="selectTab(TAB_TYPES.ADD)" ng-class="{true:\'tab-active\', false:\'\'}[selectedTab == TAB_TYPES.ADD]"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.ADD}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.ADD}">{{ \'tab_add\' | i18n:loc.ale:textObject }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.WAITING)" ng-class="{true:\'tab-active\', false:\'\'}[selectedTab == TAB_TYPES.WAITING]"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.WAITING}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.WAITING}">{{ \'tab_waiting\' | i18n:loc.ale:textObject }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.LOGS)" ng-class="{true:\'tab-active\', false:\'\'}[selectedTab == TAB_TYPES.LOGS]"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.LOGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.LOGS}">{{ \'tab_logs\' | i18n:loc.ale:textObject }}</a></div></div></div></div></div><div class="box-paper footer"><div class="scroll-wrap"><div class="add" ng-show="selectedTab === TAB_TYPES.ADD"><form class="addForm"><div><table class="tbl-border-light tbl-striped"><colgroup><col width="30%"><col width="5%"><col><col width="18%"></colgroup><tbody><tr><td><div auto-complete="autoCompleteOrigin"></div></td><td class="text-center"><span class="icon-26x26-rte-village"></span></td><td ng-if="!commandData.origin">{{ \'add_no_village\' | i18n:loc.ale:textObject }}</td><td ng-if="commandData.origin">{{ commandData.origin.name }} ({{ commandData.origin.x }}|{{ commandData.origin.y }})</td><td class="actions"><a class="btn btn-orange" ng-click="addSelected()" tooltip="" tooltip-content="{{ \'add_selected\' | i18n:loc.ale:textObject }}">{{ \'selected\' | i18n:loc.ale:textObjectCommon }}</a></td></tr><tr><td><div auto-complete="autoCompleteTarget"></div></td><td class="text-center"><span class="icon-26x26-rte-village"></span></td><td ng-if="!commandData.target">{{ \'add_no_village\' | i18n:loc.ale:textObject }}</td><td ng-if="commandData.target">{{ commandData.target.name }} ({{ commandData.target.x }}|{{ commandData.target.y }})</td><td class="actions"><a class="btn btn-orange" ng-click="addMapSelected()" tooltip="" tooltip-content="{{ \'add_map_selected\' | i18n:loc.ale:textObject }}">{{ \'selected\' | i18n:loc.ale:textObjectCommon }}</a></td></tr><tr><td><input ng-model="commandData.date" type="text" class="textfield-border date" pattern="\\s*\\d{1,2}:\\d{1,2}:\\d{1,2}(:\\d{1,3})? \\d{1,2}\\/\\d{1,2}\\/\\d{4}\\s*" placeholder="{{ \'add_date\' | i18n:loc.ale:textObject }}" tooltip="" tooltip-content="hh:mm:ss:SSS dd/MM/yyyy"></td><td class="text-center"><span class="icon-26x26-time"></span></td><td><div select="" list="dateTypes" selected="selectedDateType" drop-down="true"></div></td><td class="actions"><a class="btn btn-orange" ng-click="reduceDate()" tooltip="" tooltip-content="{{ \'add_current_date_minus\' | i18n:loc.ale:textObject }}">-</a><a class="btn btn-orange" ng-click="addCurrentDate()" tooltip="" tooltip-content="{{ \'add_current_date\' | i18n:loc.ale:textObject }}">{{ \'now\' | i18n:loc.ale:textObjectCommon }}</a><a class="btn btn-orange" ng-click="incrementDate()" tooltip="" tooltip-content="{{ \'add_current_date_plus\' | i18n:loc.ale:textObject }}">+</a></td></tr></tbody></table><table ng-show="commandData.origin && commandData.target" class="tbl-border-light tbl-units tbl-speed screen-village-info"><thead><tr><th colspan="7">{{ \'speed_title\' | i18n:loc.ale:textObjectVillageInfo }}</th></tr></thead><tbody><tr><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-knight" tooltip="" tooltip-content="{{ \'knight\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-light_cavalry" tooltip="" tooltip-content="{{ \'light_cavalry\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-mounted_archer" tooltip="" tooltip-content="{{ \'mounted_archer\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub-icon time-support" ng-class="{\'text-red\': travelTimes.support.light_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.light_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}"><div class="time-icon icon-20x20-support-check"></div>{{ travelTimes.support.light_cavalry.value }}</div><div class="box-time-sub-icon time-attack" ng-class="{\'text-red\': travelTimes.attack.light_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.attack.light_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}"><div class="time-icon icon-20x20-attack-check"></div>{{ travelTimes.attack.light_cavalry.value }}</div><div class="box-time-sub-icon time-relocate" ng-class="{\'text-red\': travelTimes.relocate.light_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.relocate.light_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}"><div class="time-icon icon-20x20-relocate"></div>{{ travelTimes.relocate.light_cavalry.value }}</div></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-heavy_cavalry" tooltip="" tooltip-content="{{ \'heavy_cavalry\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.heavy_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.heavy_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.heavy_cavalry.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.heavy_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.heavy_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.heavy_cavalry.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.heavy_cavalry.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.heavy_cavalry.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.relocate.heavy_cavalry.value }}</div></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-archer" tooltip="" tooltip-content="{{ \'archer\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-spear" tooltip="" tooltip-content="{{ \'spear\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-axe" tooltip="" tooltip-content="{{ \'axe\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-doppelsoldner" tooltip="" tooltip-content="{{ \'doppelsoldner\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.archer.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.archer.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.archer.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.archer.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.archer.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.archer.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.archer.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.archer.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.relocate.archer.value }}</div></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-sword" tooltip="" tooltip-content="{{ \'sword\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.sword.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.sword.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.sword.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.sword.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.sword.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.sword.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.sword.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.sword.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.relocate.sword.value }}</div></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-34x34-unit-catapult" tooltip="" tooltip-content="{{ \'catapult\' | i18n:loc.ale:textObjectUnitNames }}"></span> <span class="icon icon-34x34-unit-ram" tooltip="" tooltip-content="{{ \'ram\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.ram.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.ram.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.ram.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.ram.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.ram.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.ram.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.ram.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.ram.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.relocate.ram.value }}</div></div></td><td><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-snob" tooltip="" tooltip-content="{{ \'snob\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.snob.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.snob.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.snob.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.snob.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.snob.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.snob.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.snob.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.snob.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'cannot_relocate_snob\' | i18n:loc.ale:textObjectMilitaryOperations }}">-</div></div></td><td class="odd"><div class="unit-wrap"><span class="icon icon-single icon-34x34-unit-trebuchet" tooltip="" tooltip-content="{{ \'trebuchet\' | i18n:loc.ale:textObjectUnitNames }}"></span></div><div><div class="box-time-sub time-support" ng-class="{\'text-red\': travelTimes.support.trebuchet.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.trebuchet.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_support\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.support.trebuchet.value }}</div><div class="box-time-sub time-attack" ng-class="{\'text-red\': travelTimes.support.trebuchet.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.trebuchet.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_attack\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.attack.trebuchet.value }}</div><div class="box-time-sub time-relocate" ng-class="{\'text-red\': travelTimes.support.trebuchet.valueType == \'invalid\', \'text-green-bright\': travelTimes.support.trebuchet.valueType == \'valid\'}" tooltip="" tooltip-content="{{ \'travel_time_relocate\' | i18n:loc.ale:textObjectMilitaryOperations }}">{{ travelTimes.relocate.trebuchet.value }}</div></div></td></tr></tbody></table></div><h5 class="twx-section">{{ \'units\' | i18n:loc.ale:textObjectCommon }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><tbody class="add-units"><tr><td colspan="4" class="actions"><ul class="list-btn list-center"><li><div select="" list="presets" selected="selectedInsertPreset" drop-down="true"></div></li><li><a class="clear-units btn btn-orange" ng-click="cleanUnitInputs()">{{ \'add_clear\' | i18n:loc.ale:textObject }}</a></li></ul></td></tr><tr ng-repeat="i in [] | range:(unitOrder.length / 4);"><td class="cell-space-left"><span class="icon-bg-black" ng-class="\'icon-34x34-unit-\' + unitOrder[i * 4]" tooltip="" tooltip-content="{{ unitOrder[i * 4] | i18n:loc.ale:textObjectUnitNames }}"></span> <input remove-zero="" type="text" ng-model="commandData.units[unitOrder[i * 4]]" maxlength="5" placeholder="{{ commandData.units[unitOrder[i * 4]] }}" ng-focus="onUnitInputFocus(unitOrder[i * 4])" ng-blur="onUnitInputBlur(unitOrder[i * 4])"></td><td class="cell-space-left"><span class="icon-bg-black" ng-class="\'icon-34x34-unit-\' + unitOrder[i * 4 + 1]" tooltip="" tooltip-content="{{ unitOrder[i * 4 + 1] | i18n:loc.ale:textObjectUnitNames }}"></span> <input remove-zero="" type="text" ng-model="commandData.units[unitOrder[i * 4 + 1]]" maxlength="5" placeholder="{{ commandData.units[unitOrder[i * 4 + 1]] }}" ng-focus="onUnitInputFocus(unitOrder[i * 4 + 1])" ng-blur="onUnitInputBlur(unitOrder[i * 4 + 1])"></td><td class="cell-space-left"><span class="icon-bg-black" ng-class="\'icon-34x34-unit-\' + unitOrder[i * 4 + 2]" tooltip="" tooltip-content="{{ unitOrder[i * 4 + 2] | i18n:loc.ale:textObjectUnitNames }}"></span> <input remove-zero="" type="text" ng-model="commandData.units[unitOrder[i * 4 + 2]]" maxlength="5" placeholder="{{ commandData.units[unitOrder[i * 4 + 2]] }}" ng-focus="onUnitInputFocus(unitOrder[i * 4 + 2])" ng-blur="onUnitInputBlur(unitOrder[i * 4 + 2])"></td><td class="cell-space-left"><span class="icon-bg-black" ng-class="\'icon-34x34-unit-\' + unitOrder[i * 4 + 3]" tooltip="" tooltip-content="{{ unitOrder[i * 4 + 3] | i18n:loc.ale:textObjectUnitNames }}"></span> <input remove-zero="" type="text" ng-model="commandData.units[unitOrder[i * 4 + 3]]" maxlength="5" placeholder="{{ commandData.units[unitOrder[i * 4 + 3]] }}" ng-focus="onUnitInputFocus(unitOrder[i * 4 + 3])" ng-blur="onUnitInputBlur(unitOrder[i * 4 + 3])"></td></tr><tr><td class="cell-space-left"><span class="icon-bg-black icon-34x34-unit-catapult" tooltip="" tooltip-content="{{ \'catapult\' | i18n:loc.ale:textObjectUnitNames }}"></span> <input remove-zero="" type="text" ng-model="commandData.units.catapult" maxlength="5" placeholder="{{ commandData.units.catapult }}" ng-keyup="catapultTargetVisibility()" ng-focus="onUnitInputFocus(\'catapult\')" ng-blur="onUnitInputBlur(\'catapult\')"></td><td class="cell-space-left" colspan="3"><div ng-visible="showCatapultSelect"><div class="unit-border box-slider"><div class="height-wrapper"><div select="" list="attackableBuildings" selected="catapultTarget"></div></div></div></div></td></tr></tbody></table><h5 class="twx-section">{{ \'officers\' | i18n:loc.ale:textObjectCommon }}</h5><table class="add-officers margin-top tbl-border-light tbl-officers"><tbody><tr><td class="cell-officers" ng-repeat="officer in officers"><table class="tbl-border-dark tbl-officer"><tbody><tr><td class="cell-space"><span class="icon-44x44-premium_officer_{{ officer }}"></span></td><td class="cell-officer-switch" rowspan="2"><div switch-slider="" enabled="true" value="commandData.officers[officer]" vertical="true" size="\'34x66\'"></div></td></tr><tr><td tooltip="" tooltip-content="{{ \'available_officers\' | i18n:loc.ale:\'modal_preset_edit\' }}"><div class="amount">{{ inventory.getItemAmountByType(\'premium_officer_\' + officer) | number }}</div></td></tr></tbody></table></td></tr></tbody></table></form></div><div class="waiting rich-text" ng-show="selectedTab === TAB_TYPES.WAITING"><div class="filters"><table class="tbl-border-light"><tbody><tr><td><div ng-class="{\'active\': activeFilters[FILTER_TYPES.SELECTED_VILLAGE]}" ng-click="toggleFilter(FILTER_TYPES.SELECTED_VILLAGE)" class="box-border-dark icon selectedVillage" tooltip="" tooltip-content="{{ \'filters_selected_village\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-village-info icon-bg-black"></span></div><div ng-class="{\'active\': activeFilters[FILTER_TYPES.BARBARIAN_TARGET]}" ng-click="toggleFilter(FILTER_TYPES.BARBARIAN_TARGET)" class="box-border-dark icon barbarianTarget" tooltip="" tooltip-content="{{ \'filters_barbarian_target\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-barbarian-village icon-bg-black"></span></div><div ng-class="{\'active\': activeFilters[FILTER_TYPES.ATTACK]}" ng-click="toggleFilter(FILTER_TYPES.ATTACK, true)" class="box-border-dark icon allowedTypes" tooltip="" tooltip-content="{{ \'filters_attack\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-attack icon-bg-black"></span></div><div ng-class="{\'active\': activeFilters[FILTER_TYPES.SUPPORT]}" ng-click="toggleFilter(FILTER_TYPES.SUPPORT, true)" class="box-border-dark icon allowedTypes" tooltip="" tooltip-content="{{ \'filters_support\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-support icon-bg-black"></span></div><div ng-class="{\'active\': activeFilters[FILTER_TYPES.RELOCATE]}" ng-click="toggleFilter(FILTER_TYPES.RELOCATE, true)" class="box-border-dark icon allowedTypes" tooltip="" tooltip-content="{{ \'filters_relocate\' | i18n:loc.ale:textObject }}"><span class="icon-34x34-relocate icon-bg-black"></span></div><div class="text"><input ng-model="filtersData[FILTER_TYPES.TEXT_MATCH]" type="text" class="box-border-dark" placeholder="{{ \'filters_text_match\' | i18n:loc.ale:textObject }}"></div></td></tr></tbody></table></div><div class="queue"><h5 class="twx-section">{{ \'queue_waiting\' | i18n:loc.ale:textObject }}</h5><p class="text-center" ng-show="!visibleWaitingCommands.length">{{ \'queue_none_added\' | i18n:loc.ale:textObject }}</p><table class="tbl-border-light" ng-repeat="command in visibleWaitingCommands"><colgroup><col width="100px"></colgroup><tbody><tr><th colspan="2"><span ng-class="{true: \'icon-bg-red\', false:\'icon-bg-blue\'}[command.type === COMMAND_TYPES.ATTACK]" class="icon-26x26-{{ command.type }}" tooltip="" tooltip-content="{{ command.type | i18n:loc.ale:textObjectCommon }}"></span> <span class="size-26x26 icon-bg-black icon-26x26-time-duration" tooltip="" tooltip-content="{{ \'command_time_left\' | i18n:loc.ale:textObject }}"></span> <span class="time-left">{{ command.countdown() }}</span> <span class="size-26x26 icon-bg-black icon-20x20-units-outgoing" tooltip="" tooltip-content="{{ \'command_out\' | i18n:loc.ale:textObject }}"></span> <span class="sent-time">{{ command.sendTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span> <span class="size-26x26 icon-bg-black icon-20x20-time-arrival" tooltip="" tooltip-content="{{ \'command_arrive\' | i18n:loc.ale:textObject }}"></span> <span class="arrive-time">{{ command.arriveTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span> <a href="#" class="remove-command size-20x20 btn-red icon-20x20-close" ng-click="removeCommand(command, EVENT_CODES.COMMAND_REMOVED)" tooltip="" tooltip-content="{{ \'queue_remove\' | i18n:loc.ale:textObject }}"></a></th></tr><tr><td>{{ \'villages\' | i18n:loc.ale:textObjectCommon }}</td><td><a class="origin"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.origin.id)">{{ command.origin.name }} ({{ command.origin.x }}|{{ command.origin.y }})</span></a> <span class="size-20x20 icon-26x26-{{ command.type }}"></span> <a class="target"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.target.id)">{{ command.target.name }} ({{ command.target.x }}|{{ command.target.y }})</span></a></td></tr><tr><td>{{ \'units\' | i18n:loc.ale:textObjectCommon }}</td><td class="units"><div class="unit" ng-repeat="(unit, amount) in command.units"><span class="icon-34x34-unit-{{ unit }} icon"></span> <span class="amount">{{ amount }}</span> <span ng-if="unit === \'catapult\' && command.type === COMMAND_TYPES.ATTACK">({{ command.catapultTarget | i18n:loc.ale:textObjectCommon }})</span></div><div class="officer" ng-repeat="(officer, enabled) in command.officers"><span class="icon-34x34-premium_officer_{{ officer }}"></span></div></td></tr></tbody></table></div></div><div class="logs rich-text" ng-show="selectedTab === TAB_TYPES.LOGS"><h5 class="twx-section">{{ \'queue_sent\' | i18n:loc.ale:textObject }}</h5><p class="text-center" ng-show="!sentCommands.length">{{ \'queue_none_sent\' | i18n:loc.ale:textObject }}</p><table class="tbl-border-light" ng-repeat="command in sentCommands track by $index"><colgroup><col width="100px"></colgroup><tbody><tr><th colspan="2"><span ng-class="{true: \'icon-bg-red\', false:\'icon-bg-blue\'}[command.type === COMMAND_TYPES.ATTACK]" class="icon-26x26-{{ command.type }}" tooltip="" tooltip-content="{{ command.type | i18n:loc.ale:textObjectCommon }}"></span> <span class="size-26x26 icon-bg-black icon-20x20-units-outgoing" tooltip="" tooltip-content="{{ \'command_out\' | i18n:loc.ale:textObject }}"></span> <span class="sent-time">{{ command.sendTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span> <span class="size-26x26 icon-bg-black icon-20x20-time-arrival" tooltip="" tooltip-content="{{ \'command_arrive\' | i18n:loc.ale:textObject }}"></span> <span class="arrive-time">{{ command.arriveTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span></th></tr><tr><td>{{ \'villages\' | i18n:loc.ale:textObjectCommon }}</td><td><a class="origin"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.origin.id)">{{ command.origin.name }} ({{ command.origin.x }}|{{ command.origin.y }})</span></a> <span class="size-20x20 icon-26x26-{{ command.type }}"></span> <a class="target"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.target.id)">{{ command.target.name }} ({{ command.target.x }}|{{ command.target.y }})</span></a></td></tr><tr><td>{{ \'units\' | i18n:loc.ale:textObjectCommon }}</td><td class="units"><div class="unit" ng-repeat="(unit, amount) in command.units"><span class="icon-34x34-unit-{{ unit }} icon"></span> <span class="amount">{{ amount }}</span> <span ng-if="unit === \'catapult\' && command.type === COMMAND_TYPES.ATTACK">({{ command.catapultTarget | i18n:loc.ale:textObjectCommon }})</span></div><div class="officer" ng-repeat="(officer, enabled) in command.officers"><span class="icon-34x34-premium_officer_{{ officer }}"></span></div></td></tr></tbody></table><h5 class="twx-section">{{ \'queue_expired\' | i18n:loc.ale:textObject }}</h5><p class="text-center" ng-show="!expiredCommands.length">{{ \'queue_none_expired\' | i18n:loc.ale:textObject }}</p><table class="tbl-border-light" ng-repeat="command in expiredCommands track by $index"><colgroup><col width="100px"></colgroup><tbody><tr><th colspan="2"><span ng-class="{true: \'icon-bg-red\', false:\'icon-bg-blue\'}[command.type === COMMAND_TYPES.ATTACK]" class="icon-26x26-{{ command.type }}" tooltip="" tooltip-content="{{ command.type | i18n:loc.ale:textObjectCommon }}"></span> <span class="size-26x26 icon-bg-black icon-20x20-units-outgoing" tooltip="" tooltip-content="{{ \'command_out\' | i18n:loc.ale:textObject }}"></span> <span class="sent-time">{{ command.sendTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span> <span class="size-26x26 icon-bg-black icon-20x20-time-arrival" tooltip="" tooltip-content="{{ \'command_arrive\' | i18n:loc.ale:textObject }}"></span> <span class="arrive-time">{{ command.arriveTime | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span></th></tr><tr><td>{{ \'villages\' | i18n:loc.ale:textObjectCommon }}</td><td><a class="origin"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.origin.id)">{{ command.origin.name }} ({{ command.origin.x }}|{{ command.origin.y }})</span></a> <span class="size-20x20 icon-26x26-{{ command.type }}"></span> <a class="target"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(command.target.id)">{{ command.target.name }} ({{ command.target.x }}|{{ command.target.y }})</span></a></td></tr><tr><td>{{ \'units\' | i18n:loc.ale:textObjectCommon }}</td><td class="units"><div class="unit" ng-repeat="(unit, amount) in command.units"><span class="icon-34x34-unit-{{ unit }} icon"></span> <span class="amount">{{ amount }}</span> <span ng-if="unit === \'catapult\' && command.type === COMMAND_TYPES.ATTACK">({{ command.catapultTarget | i18n:loc.ale:textObjectCommon }})</span></div><div class="officer" ng-repeat="(officer, enabled) in command.officers"><span class="icon-34x34-premium_officer_{{ officer }}"></span></div></td></tr></tbody></table></div></div></div></div><footer class="win-foot"><ul class="list-btn list-center"><li ng-show="selectedTab === TAB_TYPES.LOGS"><a class="btn-orange btn-border" ng-click="clearRegisters()">{{ \'general_clear\' | i18n:loc.ale:textObject }}</a></li><li ng-show="selectedTab === TAB_TYPES.ADD"><a class="btn-orange btn-border add" ng-click="addCommand(COMMAND_TYPES.ATTACK)"><span class="icon-26x26-attack-small"></span> {{ COMMAND_TYPES.ATTACK | i18n:loc.ale:textObjectCommon }}</a></li><li ng-show="selectedTab === TAB_TYPES.ADD"><a class="btn-orange btn-border add" ng-click="addCommand(COMMAND_TYPES.SUPPORT)"><span class="icon-26x26-support"></span> {{ COMMAND_TYPES.SUPPORT | i18n:loc.ale:textObjectCommon }}</a></li><li ng-show="selectedTab === TAB_TYPES.ADD"><a class="btn-orange btn-border add" ng-click="addCommand(COMMAND_TYPES.RELOCATE)"><span class="icon-26x26-relocate"></span> {{ COMMAND_TYPES.RELOCATE | i18n:loc.ale:textObjectCommon }}</a></li><li><a href="#" ng-class="{false:\'btn-green\', true:\'btn-red\'}[running]" class="btn-border" ng-click="switchCommandQueue()"><span ng-show="running">{{ \'deactivate\' | i18n:loc.ale:textObjectCommon }}</span> <span ng-show="!running">{{ \'activate\' | i18n:loc.ale:textObjectCommon }}</span></a></li></ul></footer></div>'),e.addStyle('#two-command-queue input[type="text"]{width:200px}#two-command-queue input.unit{width:80px;height:34px}#two-command-queue form .padded{padding:2px 8px}#two-command-queue a.select-handler{-webkit-box-shadow:none;box-shadow:none;height:22px;line-height:22px}#two-command-queue a.select-button{height:22px}#two-command-queue .custom-select{width:240px}#two-command-queue .originVillage,#two-command-queue .targetVillage{padding:0 7px}#two-command-queue a.btn{height:28px;line-height:28px;padding:0 10px}#two-command-queue .actions{text-align:center}#two-command-queue .add-units td{text-align:center}#two-command-queue .add-units .unit-icon{top:-1px}#two-command-queue .add-units input{height:34px;line-height:26px;color:#fff3d0;font-size:14px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAABGdBTUEAALGPC/xhBQAAALRQTFRFr6+vmJiYoKCgrKysq6urpaWltLS0s7OzsLCwpKSkm5ubqKiojY2NlZWVk5OTqampbGxsWFhYUVFRhISEgYGBmpqaUFBQnp6eYmJidnZ2nZ2dY2NjW1tbZ2dnoaGhe3t7l5eXg4ODVVVVWVlZj4+PXFxcVlZWkpKSZmZmdXV1ZWVlc3NzjIyMXl5eVFRUeHh4hoaGYWFhXV1dbW1tampqb29veXl5fHx8gICAiYmJcnJyTk5Ooj6l1wAAADx0Uk5TGhkZGhoaGxoaGRkaGRkZGhkbHBgYGR0ZGhkZGhsZGRgZGRwbGRscGRoZGhkZGhwZGRobGRkZGRkZGRkeyXExWQAABOJJREFUSMeNVgdy4zgQxIW9TQ7KOVEUo5gz0f//1/WA0sple6+OLokQiUk9PQ2rvlzvT0vA6xDXU3R5hQmqddDVaIELsMl3KLUGoFHugUphjt25PWkE6KMAqPkO/Qh7HRadPmTNxKJpWuhSjLZAoSZmXYoPXh0w2R2z10rjBxpMNRfomhbNFUfUFbfUCh6TWmO4ZqNn6Jxekx6lte3h9IgYv9ZwzIZXfhQ/bejmsYkgOeVInoDGT6KGP9MMbsj7mtEKphKgVFKkJGUM+r/00zybNkPMFWYske+jY9hUblbrK4YosyPtrxl+5kNRWSb2B3+pceKT05SQRPZY8pVSGoWutgen2junRVKPZJ0v5Nu9HAk/CFPr+T1XTkXYFWSJXfTyLPcpcPXtBZIPONq/cFQ0Y0Lr1GF6f5doHdm2RLTbQMpMmCIf/HGm53OLFPiiEOsBKtgHccgKTVwn8l7kbt3iPvqniMX4jgWj4aqlX43xLwXVet5XTG1cYp/29m58q6ULSa7V0M3UQFyjd+AD+1W9WLBpDd9uej7emFbea/+Yw8faySElQQrBDksTpTOVIG/SE2HpPvZsplJWsblRLEGXATEW9YLUY1rPSdivBDmuK3exNiAysfPALfYZFWJrsA4Zt+fftEeRY0UsMDqfyNCKJpdrtI1r2k0vp9LMSwdO0u5SpjBeEYz5ebhWNbwT2g7OJXy1vjW+pEwyd1FTkAtbzzcbmX1yZlkR2pPiXZ/mDbPNWvHRsaKfLH8+FqiZbnodbOK9RGWlNMli8k+wsgbSNwS35QB6qxn53xhu2DFqUilisB9q2Zqw4nNI9tOB2z8GbkvEdNjPaD2j+9pwEC+YlWJvI7xN7xMC09eqhq/qwRvz3JWcFWmkjrWBWSiOysEmc4LmMb0iSsxR8+Z8pk3+oE39cdAmh1xSDXuAryRLZgpp9V62+8IOeBSICjs8LlbtKGN4E7XGoGASIJ+vronVa5mjagPHIFJA2b+BKkZC5I/78wOqmzYp1N8vzTkWIWz6YfsS3eh3w8pBkfKz6TSLxK9Qai5DUGTMZ8NNmrW8ldNudIJq+eJycwjv+xbeOJwPv1jjsSV/rCBaS/IBrafaUQ+5ksHwwl9y9X7kmvvIKWoBDFvbWySGyMU3XflxZRkNeRU63otWb0+P8H8BrRokbJivpWkk6m6LccSlrC2K0i6+4otx4dN3mbAVKt0wbaqBab4/MW8rgrS8JP06HU6UYSTYsQ5pYETpo87ZonORvbPlvYbXwmsMgoQGKr8PUQ5dDEO0EcXp2oOfSk+YpR/Eg4R46O0/Sf7jVnbqbXBrRkCPsZFOQTN8h+aqlcRw9FjJ/j8V7SXZ3hVNXYsOYcxzpfPNgFrvB9S6Dej2PqDqq0su+5ng0WMi527p/pA+OiW0fsYzDa6sPS9C1qxTtxVRMuySrwPD6qGPRKc4uIx4oceJ9FPjxWaqPPebzyXxU7W1jNqqOw+9z6X/k+Na3SBa0v+VjgoaULR30G1nxvZN1vsha2UaSrKy/PyCaHK5zAYnJzm9RSpSPDWbDVu0dkUujMmB/ly4w8EnDdXXoyX/VfhB3yKzMJ2BSaZO+A9GiNQMbll+6z1WGLWpEGMeEg85MESSep0IPFaHYZZ1QOW/xcjfxGhNjP0tRtbhFHOmhhjAv/p77JrCX3+ZAAAAAElFTkSuQmCC) top left #b89064;box-shadow:inset 0 0 0 1px #000,inset 0 0 0 2px #a2682c,inset 0 0 0 3px #000,inset -3px -3px 2px 0 #fff,inset 0 0 9px 5px rgba(99,54,0,0.5);text-align:center;width:80px}#two-command-queue .add-officers .cell-officers{padding:7px 11px 5px 11px}#two-command-queue .add-officers .amount{color:#fff;text-align:center}#two-command-queue .command{margin-bottom:10px}#two-command-queue .command .time-left{width:93px;display:inline-block;padding:0 0 0 3px}#two-command-queue .command .sent-time,#two-command-queue .command .arrive-time{width:160px;display:inline-block;padding:0 0 0 5px}#two-command-queue .command td{padding:3px 6px}#two-command-queue .officers td{width:111px;text-align:center}#two-command-queue .officers label{margin-left:5px}#two-command-queue .officers span{margin-left:2px}#two-command-queue .units div.unit{float:left}#two-command-queue .units div.unit span.icon{transform:scale(.7);width:25px;height:25px}#two-command-queue .units div.unit span.amount{vertical-align:-2px;margin:0 5px 0 2px}#two-command-queue .units div.officer{float:left;margin:0 2px}#two-command-queue .units div.officer span{transform:scale(.7);width:25px;height:25px}#two-command-queue .remove-command{float:right;margin-top:3px}#two-command-queue .tbl-units td{text-align:center}#two-command-queue .tbl-speed{margin-top:10px}#two-command-queue .tbl-speed th{text-align:center}#two-command-queue .tbl-speed td{font-size:12px}#two-command-queue .tbl-speed .box-time-sub-icon{position:relative}#two-command-queue .tbl-speed .box-time-sub-icon .time-icon{position:absolute;top:-3px;left:27px;transform:scale(.7)}#two-command-queue .tbl-speed .box-time-sub-icon.time-relocate .time-icon{top:-6px;left:26px}#two-command-queue .dateType{width:200px}#two-command-queue .dateType .custom-select-handler{text-align:left}#two-command-queue .filters .icon{width:38px;float:left;margin:0 6px}#two-command-queue .filters .icon.active:before{box-shadow:0 0 0 1px #000,-1px -1px 0 2px #ac9c44,0 0 0 3px #ac9c44,0 0 0 4px #000;border-radius:1px;content:"";position:absolute;width:38px;height:38px;left:-1px;top:-1px}#two-command-queue .filters .text{margin-left:262px}#two-command-queue .filters .text input{height:36px;margin-top:1px;width:100%;text-align:left;padding:0 5px}#two-command-queue .filters .text input::placeholder{color:white}#two-command-queue .filters .text input:focus::placeholder{color:transparent}#two-command-queue .filters td{padding:6px}#two-command-queue .icon-34x34-barbarian-village:before{filter:grayscale(100%);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-220px -906px}#two-command-queue .icon-20x20-time-arrival:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-529px -454px}#two-command-queue .icon-20x20-attack:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-546px -1086px;width:26px;height:26px}#two-command-queue .icon-20x20-support:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-462px -360px;width:26px;height:26px}#two-command-queue .icon-20x20-relocate:before{transform:scale(.8);background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-1090px -130px;width:26px;height:26px}#two-command-queue .icon-26x26-attack:before{background-image:url(https://i.imgur.com/ozI4k0h.png);background-position:-546px -1086px}')}}),define("two/farmOverflow",["two/farmOverflow/Village","two/farmOverflow/errorTypes","two/farmOverflow/settings","two/farmOverflow/settingsMap","two/farmOverflow/settingsUpdate","two/farmOverflow/logTypes","two/utils","helper/math","conf/conf","struct/MapData","helper/mapconvert","helper/time","conf/gameStates","Lockr","queues/EventQueue"],function(e,t,a,s,u,g,p,m,E,v,f,T,b,h,A){var S,w,O,I,R,x,C,L,y=!1,N=null,M={},D=[],G=!1,P=[],k=[],U=[],q=[],V={},j=[],B="farmoverflow_indexes",H="farmoverflow_logs",z="farmoverflow_last_attack",Y="farmoverflow_last_activity",F="farmoverflow_settings",Q="no_units",W="no_units_no_commands",K="attacking",X="paused",$="loading_targets",Z="analyse_targets",J="command_limit",ee="no_villages",te="step_cycle_end",ie="step_cycle_end_no_villages",ae="step_cycle_next",ne="full_storage",oe="units",le="commands",re="full_storage",se=X,ce=[],de=[],ue={},ge=!1,_e="",pe={},me=[function(e){return e.id<0},function(e){return e.character_id===w.getId()},function(e){return!!e.attack_protection},function(e){return e.character_id&&!q.includes(e.id)},function(e){return e.points<M[a.MIN_POINTS]||e.points>M[a.MAX_POINTS]},function(e){var t=m.actualDistance(I.position,e);return t<M[a.MIN_DISTANCE]||t>M[a.MAX_DISTANCE]}],Ee=function(){return angular.isArray(M[a.GROUP_INCLUDE])?angular.isArray(M[a.GROUP_ONLY])?(G=M[a.GROUP_IGNORE],P=M[a.GROUP_INCLUDE],void(k=M[a.GROUP_ONLY])):(console.error("groupOnly must be an Array"),!1):(console.error("groupInclude must be an Array"),!1)},ve=function(){var e,t=n.getGroupList();U=[],q=[],G&&("number"!=typeof G?console.error("groupIgnore must be a id number"):U=t.getGroupVillageIds(G)),P.length&&P.forEach(function(i){e=t.getGroupVillageIds(i),q=q.concat(e)})},fe=function(){var t,i,a=w.getVillageList().map(function(t){return new e(t)}).filter(function(e){return!U.includes(e.id)});k.length&&(t=n.getGroupList(),i=[],k.forEach(function(e){i=i.concat(t.getGroupVillageIds(e))}),a=a.filter(function(e){return i.includes(e.id)})),R=1===(ce=a).length,I=ce[0],N.running&&ge&&a.some(function(e){if(!V[e.id])return ge=!1,N.analyse(),!0}),A.trigger(r.FARM_VILLAGES_UPDATE)},Te=function(e){var t=function(t){D=[],M[a.PRESETS].length?(M[a.PRESETS].forEach(function(e){D.push({id:e,units:function(e){var t,i={};for(t in e)e[t]>0&&(i[t]=e[t]);return i}(t[e].units)})}),e&&e()):e&&e()};n.getPresetList().isLoaded()?t(n.getPresetList().getPresets()):o.emit(l.GET_PRESETS,{},function(e){var i,a;A.trigger(r.FARM_PRESETS_LOADED),t((i=e.presets,a={},i.forEach(function(e){a[e.id]=e}),a))})},be=function(){var e=[],t=function(e){xe(e.id,function(e){var t=e.ReportAttack,i=t.attVillageId,a=t.defVillageId;if(pe.hasOwnProperty(i)||(pe[i]=[]),pe[i].includes(a))return!1;pe[i].push(a),A.trigger(r.FARM_PRIORITY_TARGET_ADDED,{id:a,name:t.defVillageName,x:t.defVillageX,y:t.defVillageY})})};i.$on(r.REPORT_NEW,function(i,n){if(!N.running||"attack"!==n.type)return!1;var o;M[a.IGNORE_ON_LOSS]&&1!==n.result&&(o=Ie(n.target_village_id))&&Oe(o),M[a.PRIORITY_TARGETS]&&"full"===n.haul&&(c.isTemplateOpen("report")?e.push(n):t(n))}),i.$on(r.WINDOW_CLOSED,function(i,a){"report"===a&&(e.forEach(function(e){t(e)}),e=[])})},he=function(e){if(!e)return!1;j.unshift(e),De(j),A.trigger(r.FARM_LOGS_UPDATED)},Ae=function(){C=T.gameTime(),h.set(z,C)},Se=function(e){var t=ce.indexOf(e);return-1!==t&&ce[t]},we=function(e){var t=Se(e);return!!t&&(I=t,!0)},Oe=function(e){if(!G)return!1;o.emit(l.GROUPS_LINK_VILLAGE,{group_id:G,village_id:e.id},function(){A.trigger(r.FARM_IGNORED_VILLAGE,e)})},Ie=function(e){var t,i,a,n;for(t in ue)for(i=ue[t],a=0;a<i.length;a++)if((n=i[a]).id===e)return n;return!1},Re=function(){V={}},xe=function(e,t){o.emit(l.REPORT_GET,{id:e},t)},Ce=function(e,t){o.emit(l.MESSAGE_REPLY,{message_id:e,message:t})},Le=function(){var e,t,n=_("i18n")("status",i.loc.ale,"common"),o=_("i18n")("selected_village",i.loc.ale,"farm"),l=_("i18n")("last_attack",i.loc.ale,"farm"),r=null,s=p.genVillageLabel(I),c=p.formatDate(C),d=I.id,u=[];return se===ae&&(e=T.gameTime()+60*M[a.STEP_CYCLE_INTERVAL],r=p.formatDate(e)),t=_("i18n")(se,i.loc.ale,"farm",r),u.push(`[b]${n}:[/b] ${t}[br]`),u.push(`[b]${o}:[/b] `),u.push(`[village=${d}]${s}[/village][br]`),u.push(`[b]${l}:[/b] ${c}`),u.join("")},ye=function(e){se=e,A.trigger(r.FARM_STATUS_CHANGE,e)},Ne=function(){return ce.filter(function(e){return!V[e.id]&&(!M[a.IGNORE_FULL_STORAGE]||!Ge(e)||(V[e.id]=re,!1))})},Me=function(e,t){V[e]=t||!0},De=function(e){e.length>M[a.LOGS_LIMIT]&&(e=e.slice(0,M[a.LOGS_LIMIT])),j=e,h.set(H,j)},Ge=function(e){var t,i,a,n=e||I;return!!n.original.isReady()&&(t=n.original.getResources(),i=t.getComputed(),a=t.getMaxStorage(),["wood","clay","iron"].every(function(e){return i[e].currentStock===a}))},Pe=function(){clearTimeout(N.timeoutId),N.running=!1},ke=function(){x=T.gameTime(),h.set(Y,x)},Ue=function(e){var t,i,n,o,l,s,c=I.id;if(!ue[c])return N.analyse(),!1;if(t=ue[c],M[a.PRIORITY_TARGETS]&&pe[c])for(;i=pe[c].shift();)if(!U.includes(i))for(n=0;n<t.length;n++)if(t[n].id===i)return S=t[n],!0;for(o=L[c],l=!1,e||(o=++L[c]);o<t.length;o++){if(s=t[o],!U.includes(s.id)){S=s,l=!0;break}A.trigger(r.FARM_IGNORED_TARGET,[s])}return l?L[c]=o:(S=t[0],L[c]=0),h.set(B,L),!0},qe=function(e){var t,i,a,n=I.position,o=I.id,l=E.MAP_CHUNK_SIZE,s=n.x-l,c=n.y-l,d=2*l,u=2*l;if(o in ue)return e();!function(e,t,i,a,n,o){var l,s,c,d;if(v.hasTownDataInChunk(e,t))return l=v.loadTownData(e,t,i,a,n),o(l);A.trigger(r.FARM_LOADING_TARGETS_START),s=f.scaledGridCoordinates(e,t,i,a,n),c=s.length,d=0,v.loadTownDataAsync(e,t,i,a,function(){++d===c&&(A.trigger(r.FARM_LOADING_TARGETS_END),l=v.loadTownData(e,t,i,a,n),o(l))})}(s,c,d,u,l,function(n){if(t=function(e){for(var t,i,a,n,o,l=e.length,r=[];l--;)for(i in t=e[l].data)for(n in a=t[i])o=a[n],r.push(o);return r}(n),i=t.filter(function(e){return me.every(function(t){return!t(e)})}),0===(a=function(e){var t,i,a=[],n=I.position;for(i=0;i<e.length;i++)t=e[i],a.push({x:t.x,y:t.y,distance:m.actualDistance(n,t),id:t.id,name:t.name,pid:t.character_id});return a}(i)).length)return Ve()?qe(e):A.trigger(r.FARM_NO_TARGETS),!1;ue[o]=a.sort(function(e,t){return e.distance-t.distance}),L.hasOwnProperty(o)?L[o]>ue[o].length&&(L[o]=0,h.set(B,L)):(L[o]=0,h.set(B,L)),e()})},Ve=function(){var e;return!R&&(M[a.STEP_CYCLE]?He.nextVillage():(e=de.shift())?Ne().some(function(t){return t.id===e.id})?(I=e,A.trigger(r.FARM_NEXT_VILLAGE,I),ke(),!0):Ve():(de=Ne()).length?Ve():(R?A.trigger(r.FARM_NO_UNITS):A.trigger(r.FARM_NO_VILLAGES),!1))},je=function(e){if(!D.length)return ze.pause(),A.trigger(r.FARM_NO_PRESET),!1;var t,i=I.id,a=n.getPresetList().getPresetsByVillageId(i),s=!1,c=[];if(D.forEach(function(e){a.hasOwnProperty(e.id)||(s=!0,c.push(e.id))}),s){for(t in a)c.push(t);!function(e,t){o.emit(l.ASSIGN_PRESETS,{village_id:I.id,preset_ids:e},t)}(c,e)}else e()},Be=function(){var e=!1;function n(){return this.preventNextCommand=!1,this.timeoutId=null,this.running=!1,this}return n.prototype.analyse=function(){var e;if(this.running){if(!D.length)return ze.pause(),void A.trigger(r.FARM_NO_PRESET);if(!I)return A.trigger(r.FARM_NO_VILLAGE_SELECTED);if(I.loaded())if(V.hasOwnProperty(I.id)||U.includes(I.id))Ve()?this.analyse():A.trigger(_e);else if(M[a.IGNORE_FULL_STORAGE]&&Ge())Ve()?this.analyse():this.handleError(t.FULL_STORAGE);else{if(!ue.hasOwnProperty(I.id))return qe(()=>{this.analyse()});var i,n,o;if(i=I.id,n=L[i],(o=ue[i]).length&&((void 0===n||n>o.length)&&(L[i]=n=0),o[n]))Ue(!0),je(()=>I.countCommands()>=M[a.COMMANDS_PER_VILLAGE]?this.handleError(t.COMMAND_LIMIT):(e=this.getPreset()).error?this.handleError(e.error):(this.getPresetNext(e),void this.send(e)));else Ve()?this.analyse():A.trigger(r.FARM_NO_TARGETS)}else I.load(()=>{this.analyse()})}},n.prototype.handleError=function(e){_e=e||this.preventNextCommand,this.preventNextCommand=!1;var i,n=I.id;switch(_e){case t.TIME_LIMIT:Ue(),this.analyse();break;case t.NO_UNITS:A.trigger(r.FARM_NO_UNITS,[I]),Me(n,oe),Ve()?this.analyse():ge=!0;break;case t.COMMAND_LIMIT:if(Me(n,le),function(){var e,t;for(e=0;e<ce.length;e++)if(t=ce[e].id,!V.hasOwnProperty(t))return!1;return!0}()&&(i=r.FARM_COMMAND_LIMIT_MULTI,A.trigger(i,[I]),ge=!0,M[a.STEP_CYCLE]))return He.endStep();Ve(),this.analyse();break;case t.FULL_STORAGE:Me(n,re)}},n.prototype.getPreset=function(e){var i,a,n=!1,o=e||I.units,l=!1;return D.forEach(e=>{if(l)return!1;for(a in i=!0,e.units)o[a].in_town<e.units[a]&&(i=!1);i&&(this.checkPresetTime(e)?l=e:n=!0)}),l||{error:n?t.TIME_LIMIT:t.NO_UNITS}},n.prototype.getPresetNext=function(e){var t,i,a=angular.copy(I.units),n=e.units;for(t in n)a[t].in_town-=n[t];(i=this.getPreset(a)).error&&(this.preventNextCommand=i.error)},n.prototype.checkPresetTime=function(e){var t=60*M[a.MAX_TRAVEL_TIME],i=I.position,n=m.actualDistance(i,S),o=d.calculateTravelTime(e,{barbarian:!S.pid,officers:!1});return t>d.getTravelTimeForDistance(e,o,n,"attack")},n.prototype.send=function(t,i){var n,r,s,c=Date.now();return!(e&&c-e<100)&&(e=c,!!this.running&&(this.simulate(),n=this.onCommandError(()=>{r(),I.updateCommands(()=>{this.analyse()})}),r=this.onCommandSend(()=>{n(),Ue(),s=100+1e3*(s=p.randomSeconds(M[a.RANDOM_BASE])),this.timeoutId=setTimeout(()=>{if(this.preventNextCommand)return this.handleError();this.analyse()},s),ke()}),o.emit(l.SEND_PRESET,{start_village:I.id,target_village:S.id,army_preset_id:t.id,type:"attack"}),!0))},n.prototype.onCommandSend=function(e){var t,a=angular.copy(I.units),n=i.$on(r.VILLAGE_UNIT_INFO,function(i,o){return I.id===o.village_id&&(t=I.units,!angular.equals(a,t)&&(A.trigger(r.FARM_SEND_COMMAND,[I,S]),n(),void e()))});return n},n.prototype.onCommandError=function(e){var t=i.$on(r.MESSAGE_ERROR,function(i,a){return!(!a.cause||!a.code)&&("Command/sendPreset"===a.cause&&("Command/attackLimitExceeded"===a.code&&(A.trigger(r.FARM_SEND_COMMAND_ERROR,[a.code]),t(),void e())))});return t},n.prototype.simulate=function(e){o.emit(l.GET_ATTACKING_FACTOR,{target_id:S.id}),e&&e()},n}(),He=function(){var e=[],t=null,i={intervalEnabled:function(){return!!M[a.STEP_CYCLE_INTERVAL]},startContinuous:function(e){(N=new Be).running=!0,A.trigger(r.FARM_START,e),Ne().length?(de=Ne(),N.analyse()):R?Ge()?A.trigger(r.FARM_FULL_STORAGE):A.trigger(r.FARM_NO_UNITS):A.trigger(r.FARM_NO_VILLAGES)},startStep:function(t){var a=Ne();if((N=new Be).running=!0,A.trigger(r.FARM_START,t),0===a.length)return A.trigger(r.FARM_STEP_CYCLE_NEXT_NO_VILLAGES),void(i.intervalEnabled()?i.setNextCycle():ze.pause(t));t||A.trigger(r.FARM_STEP_CYCLE_RESTART),e=a,N.analyse()},endStep:function(){return i.intervalEnabled()?(A.trigger(r.FARM_STEP_CYCLE_NEXT),Pe(),i.setNextCycle()):(A.trigger(r.FARM_STEP_CYCLE_END),ze.pause()),!1},setNextCycle:function(){t=setTimeout(function(){i.startStep()},60*M[a.STEP_CYCLE_INTERVAL])},nextVillage:function(){var t=e.shift();return t?Ne().some(function(e){return e.id===t.id})?(I=t,A.trigger(r.FARM_NEXT_VILLAGE,t),!0):i.nextVillage():i.endStep()},getTimeoutId:function(){return t}};return i}(),ze={};return ze.start=function(e){if(!D.length)return A.trigger(r.FARM_ERROR,[t.PRESET_FIRST,e]),t.PRESET_FIRST;if(!I)return A.trigger(r.FARM_ERROR,t.NO_SELECTED_VILLAGE,e),t.NO_SELECTED_VILLAGE;if(!O.getGameState(b.ALL_VILLAGES_READY)){var n=i.$on(r.GAME_STATE_ALL_VILLAGES_READY,function(){n(),ze.start(e)});return!1}return function(){var e=T.gameTime(),t=60*M[a.STEP_CYCLE_INTERVAL];if(M[a.STEP_CYCLE]&&He.intervalEnabled()){if(e>x+t+6e4)return!0}else if(e>x+18e5)return!0;return!1}()&&(pe={},L={}),M[a.STEP_CYCLE]?He.startStep(e):He.startContinuous(e),ke(),!0},ze.pause=function(e){return Pe(),A.trigger(r.FARM_PAUSE,e),clearTimeout(He.getTimeoutId()),!0},ze.restart=function(e){ze.pause(e),ze.start(e)},ze.switchState=function(e){N.running?ze.pause(e):ze.start(e)},ze.updateSettings=function(e){var t,i,a,n,o={};for(n in e)t=s[n],i=e[n],t&&i!==M[n]&&(t.updates.forEach(function(e){o[e]=!0}),M[n]=i);if(h.set(F,M),o[u.GROUPS]&&(Ee(),ve()),o[u.VILLAGES]&&fe(),o[u.PRESET]&&(Te(),Re()),o[u.TARGETS]&&(ue={}),o[u.LOGS]&&(De(j),A.trigger(r.FARM_RESET_LOGS)),o[u.FULL_STORAGE])for(a in V)V[a]===re&&delete V[a];if(o[u.WAITING_VILLAGES])for(a in V)V[a]===le&&delete V[a];return N.running&&ze.restart(),A.trigger(r.FARM_SETTINGS_CHANGE,[o]),!0},ze.isInitialized=function(){return y},ze.isRunning=function(){return!!N.running},ze.getLogs=function(){return j},ze.clearLogs=function(){j=[],h.set(H,j),A.trigger(r.FARM_LOGS_RESETED)},ze.getSelectedVillage=function(){return I},ze.getLastAttack=function(){return C},ze.getCurrentStatus=function(){return se},ze.getSettings=function(){return M},ze.init=function(){var e,t,c,d;y=!0,w=n.getSelectedCharacter(),O=n.getGameState(),j=h.get(H,[],!0),x=h.get(Y,T.gameTime(),!0),C=h.get(z,-1,!0),L=h.get(B,{},!0),N=new Be,function(){var e,t=h.get(F,{},!0);for(e in s)M[e]=t.hasOwnProperty(e)?t[e]:s[e].default}(),Ee(),ve(),fe(),Te(),be(),i.$on(r.MESSAGE_SENT,function(e,t){var i=M[a.REMOTE_ID];if(1!==t.participants.length||t.title!==i)return!1;switch(t.message.content.trim().toLowerCase()){case"on":case"start":case"init":case"begin":ze.restart(),Ce(t.message_id,Le()),A.trigger(r.FARM_REMOTE_COMMAND,["on"]);break;case"off":case"stop":case"pause":case"end":ze.pause(),Ce(t.message_id,Le()),A.trigger(r.FARM_REMOTE_COMMAND,["off"]);break;case"status":case"current":Ce(t.message_id,Le()),A.trigger(r.FARM_REMOTE_COMMAND,["status"])}return!1}),e=function(){Ee(),ve(),A.trigger(r.FARM_GROUPS_CHANGED)},t=function(e,t){if(fe(),!P.length)return!1;P.includes(t.group_id)&&(ue={})},i.$on(r.GROUPS_UPDATED,e),i.$on(r.GROUPS_CREATED,e),i.$on(r.GROUPS_DESTROYED,e),i.$on(r.GROUPS_VILLAGE_LINKED,t),i.$on(r.GROUPS_VILLAGE_UNLINKED,t),c=function(){Te(),A.trigger(r.FARM_PRESETS_CHANGE),N.running&&(D.length?ge&&(Re(),ze.restart()):(A.trigger(r.FARM_NO_PRESET),ze.pause()))},i.$on(r.ARMY_PRESET_UPDATE,c),i.$on(r.ARMY_PRESET_DELETED,c),d=function(e){if(delete V[e],ge){if(ge=!1,M[a.STEP_CYCLE])return!1;N.running&&(we(e),N.analyse())}},i.$on(r.VILLAGE_ARMY_CHANGED,function(e,t){var i=t.village_id,a=V[i]||!1;if("units"===a||"commands"===a)return d(i),!1}),i.$on(r.VILLAGE_RESOURCES_CHANGED,function(e,t){var i,a=t.villageId;(V[a]||!1)===re?d(a):(i=Se(a),Ge(i)&&Me(a,re))}),v.setRequestFn(function(e){o.emit(l.MAP_GETVILLAGES,e)}),i.$on(r.RECONNECT,function(){N.running&&setTimeout(function(){ze.restart()},5e3)}),A.register(r.FARM_SEND_COMMAND,function(e,t){Ae(),ye(K);var i=t[0],a=t[1];he({icon:"attack-small",origin:{id:i.id,coords:`${i.x}|${i.y}`},target:{id:a.id,coords:`${a.x}|${a.y}`},type:g.ATTACK,time:T.gameTime()})}),A.register(r.FARM_NEXT_VILLAGE,function(e,t){he({icon:"village",village:{id:t.id,coords:`${t.x}|${t.y}`},type:g.VILLAGE_SWITCH,time:T.gameTime()})}),A.register(r.FARM_PRIORITY_TARGET_ADDED,function(e,t){he({icon:"parallel-recruiting",type:g.PRIORITY_TARGET,village:{id:t.id,coords:`${t.x}|${t.y}`},time:T.gameTime()})}),A.register(r.FARM_IGNORED_VILLAGE,function(e,t){he({icon:"check-negative",type:g.IGNORED_VILLAGE,village:{id:t.id,coords:`${t.x}|${t.y}`},time:T.gameTime()})}),A.register(r.FARM_NO_PRESET,function(){ye(X),he({icon:"village",type:g.NO_PRESET,time:T.gameTime()})}),A.register(r.FARM_NO_UNITS,function(){ye(Q)}),A.register(r.FARM_NO_UNITS_NO_COMMANDS,function(){ye(W)}),A.register(r.FARM_START,function(){ye(K)}),A.register(r.FARM_PAUSE,function(){ye(X)}),A.register(r.FARM_LOADING_TARGETS_START,function(){ye($)}),A.register(r.FARM_LOADING_TARGETS_END,function(){ye(Z)}),A.register(r.FARM_COMMAND_LIMIT_SINGLE,function(){ye(J)}),A.register(r.FARM_COMMAND_LIMIT_MULTI,function(){ye(ee)}),A.register(r.FARM_STEP_CYCLE_END,function(){ye(te)}),A.register(r.FARM_STEP_CYCLE_END_NO_VILLAGES,function(){ye(ie)}),A.register(r.FARM_STEP_CYCLE_NEXT,function(){ye(ae)}),A.register(r.FARM_FULL_STORAGE,function(){ye(ne)}),setInterval(function(){if(N.running){var e=T.gameTime()-C,t=3e5;M[a.STEP_CYCLE]&&He.intervalEnabled()&&(t+=60*M[a.STEP_CYCLE_INTERVAL]+6e4),e>t&&(ze.pause(),ze.start())}},6e4),setInterval(function(){ue={}},3e5)},ze}),define("two/farmOverflow/errorTypes",[],function(){return{TIME_LIMIT:"time_limit",COMMAND_LIMIT:"command_limit",FULL_STORAGE:"full_storage",NO_UNITS:"no_units",PRESET_FIRST:"preset_first",NO_SELECTED_VILLAGE:"no_selected_village"}}),define("two/farmOverflow/events",[],function(){angular.extend(r,{FARM_NO_PRESET:"farmoverflow_no_preset",FARM_NO_VILLAGE_SELECTED:"farmoverflow_no_village_selected",FARM_NO_TARGETS:"farmoverflow_no_targets",FARM_NO_UNITS:"farmoverflow_no_units",FARM_NO_UNITS_NO_COMMANDS:"farmoverflow_no_units_no_commands",FARM_COMMAND_LIMIT_SINGLE:"farmoverflow_command_limit_single",FARM_COMMAND_LIMIT_MULTI:"farmoverflow_command_limit_multi",FARM_FULL_STORAGE:"farmoverflow_full_storage",FARM_SEND_COMMAND:"farmoverflow_send_command",FARM_SEND_COMMAND_ERROR:"farmoverflow_send_command_error",FARM_VILLAGES_UPDATE:"farmoverflow_villages_update",FARM_PRESETS_LOADED:"farmoverflow_presets_loaded",FARM_PRIORITY_TARGET_ADDED:"farmoverflow_priority_target_added",FARM_REMOTE_COMMAND:"farmoverflow_remote_command",FARM_PRESETS_CHANGE:"farmoverflow_presets_change",FARM_GROUPS_CHANGED:"farmoverflow_groups_changed",FARM_LOGS_UPDATED:"farmoverflow_logs_updated",FARM_LOGS_RESETED:"farmoverflow_logs_reseted",FARM_IGNORED_VILLAGE:"farmoverflow_ignored_village",FARM_LOADING_TARGETS_START:"farmoverflow_loading_targets_start",FARM_LOADING_TARGETS_END:"farmoverflow_loading_targets_end",FARM_STATUS_CHANGE:"farmoverflow_status_change",FARM_START:"farmoverflow_start",FARM_PAUSE:"farmoverflow_pause",FARM_RESET_LOGS:"farmoverflow_reset_logs",FARM_SETTINGS_CHANGE:"farmoverflow_settings_change",FARM_IGNORED_TARGET:"farmoverflow_ignored_target",FARM_NEXT_VILLAGE:"farmoverflow_next_village",FARM_NO_VILLAGES:"farmoverflow_no_villages",FARM_STEP_CYCLE_RESTART:"farmoverflow_step_cycle_restart",FARM_STEP_CYCLE_START:"farmoverflow_step_cycle_start",FARM_STEP_CYCLE_END:"farmoverflow_step_cycle_end",FARM_STEP_CYCLE_NEXT:"farmoverflow_step_cycle_next",FARM_STEP_CYCLE_NEXT_NO_VILLAGES:"farmoverflow_step_cycle_next_no_villages",FARM_STEP_CYCLE_END_NO_VILLAGES:"farmoverflow_step_cycle_end_no_villages",FARM_ERROR:"farmoverflow_error"})}),define("two/farmOverflow/logTypes",[],function(){return{ATTACK:"attack",VILLAGE_SWITCH:"village_switch",NO_PRESET:"no_preset",PRIORITY_TARGET:"priority_target",IGNORED_VILLAGE:"ignored_village"}}),define("two/farmOverflow/settingsMap",["two/farmOverflow/settings","two/farmOverflow/settingsUpdate"],function(e,t){return{[e.PRESETS]:{default:[],updates:[t.PRESET]},[e.GROUP_IGNORE]:{default:!1,updates:[t.GROUPS]},[e.GROUP_INCLUDE]:{default:[],updates:[t.GROUPS,t.TARGETS]},[e.GROUP_ONLY]:{default:[],updates:[t.GROUPS,t.VILLAGES,t.TARGETS]},[e.RANDOM_BASE]:{default:3,updates:[]},[e.COMMANDS_PER_VILLAGE]:{default:48,updates:[t.WAITING_VILLAGES]},[e.PRIORITY_TARGETS]:{default:!0,updates:[]},[e.IGNORE_ON_LOSS]:{default:!0,updates:[]},[e.IGNORE_FULL_STORAGE]:{default:!0,updates:[t.FULL_STORAGE]},[e.STEP_CYCLE]:{default:!1,updates:[t.VILLAGES]},[e.STEP_CYCLE_NOTIFS]:{default:!1,updates:[]},[e.STEP_CYCLE_INTERVAL]:{default:0,updates:[]},[e.MAX_DISTANCE]:{default:10,updates:[t.TARGETS]},[e.MIN_DISTANCE]:{default:0,updates:[t.TARGETS]},[e.MIN_POINTS]:{default:0,updates:[t.TARGETS]},[e.MAX_POINTS]:{default:12500,updates:[t.TARGETS]},[e.MAX_TRAVEL_TIME]:{default:60,updates:[]},[e.LOGS_LIMIT]:{default:500,updates:[t.LOGS]},[e.EVENT_ATTACK]:{default:!0,updates:[t.LOGS]},[e.EVENT_VILLAGE_CHANGE]:{default:!0,updates:[t.LOGS]},[e.EVENT_PRIORITY_ADD]:{default:!0,updates:[t.LOGS]},[e.EVENT_IGNORED_VILLAGE]:{default:!0,updates:[t.LOGS]},[e.REMOTE_ID]:{default:"remote",updates:[]},[e.HOTKEY_SWITCH]:{default:"shift+z",updates:[]},[e.HOTKEY_WINDOW]:{default:"z",updates:[]}}}),define("two/farmOverflow/settingsUpdate",function(){return{PRESET:"preset",GROUPS:"groups",TARGETS:"targets",VILLAGES:"villages",WAITING_VILLAGES:"waiting_villages",FULL_STORAGE:"full_storage",LOGS:"logs"}}),define("two/farmOverflow/settings",[],function(){return{PRESETS:"presets",GROUP_IGNORE:"group_ignore",GROUP_INCLUDE:"group_include",GROUP_ONLY:"group_only",RANDOM_BASE:"random_base",COMMANDS_PER_VILLAGE:"commands_per_village",PRIORITY_TARGETS:"priority_targets",IGNORE_ON_LOSS:"ignore_on_loss",IGNORE_FULL_STORAGE:"ignore_full_storage",STEP_CYCLE:"step_cycle",STEP_CYCLE_NOTIFS:"step_cycle_notifs",STEP_CYCLE_INTERVAL:"step_cycle_interval",MAX_DISTANCE:"max_distance",MIN_DISTANCE:"min_distance",MIN_POINTS:"min_points",MAX_POINTS:"max_points",MAX_TRAVEL_TIME:"max_travel_time",LOGS_LIMIT:"logs_limit",EVENT_ATTACK:"event_attack",EVENT_VILLAGE_CHANGE:"event_village_change",EVENT_PRIORITY_ADD:"event_priority_add",EVENT_IGNORED_VILLAGE:"event_ignored_village",REMOTE_ID:"remote_id",HOTKEY_SWITCH:"hotkey_switch",HOTKEY_WINDOW:"hotkey_window"}}),define("two/farmOverflow/Village",["models/CommandListModel","models/CommandModel","conf/village"],function(e,t,i){function a(e){this.original=e,this.id=e.data.villageId,this.x=e.data.x,this.y=e.data.y,this.name=e.data.name,this.units=e.unitInfo.units,this.position=e.getPosition()}return a.prototype.countCommands=function(){return this.original.getCommandListModel().getOutgoingCommands(!0).length},a.prototype.updateCommands=function(i){var a=this;o.emit(l.GET_OWN_COMMANDS,{village_id:a.id},function(n){for(var o=new e([],a.id),l=0;l<n.commands.length;l++){var r=new t(n.commands[l]);o.add(r)}a.original.setCommandListModel(o),i()})},a.prototype.commandsLoaded=function(){return this.original.isReady(i.OWN_COMMANDS)},a.prototype.unitsLoaded=function(){return this.original.isReady(i.UNITS)},a.prototype.loaded=function(){return!!this.original.isReady()&&(!!this.original.isInitialized()&&(this.commandsLoaded()&&this.unitsLoaded()))},a.prototype.load=function(e){var t=this;return u.ensureVillageDataLoaded(this.id,function(){t.original.isInitialized()||u.initializeVillage(t.original),e()})},a}),require(["two/language","two/ready","two/farmOverflow","two/farmOverflow/ui","two/farmOverflow/events"],function(e,t,i,a){if(i.isInitialized())return!1;t(function(){e.add("farm_overflow",{en_us:{farm_overflow:{attacking:"Attacking.",paused:"Paused.",command_limit:"Limit of 50 attacks reached, waiting return.",last_attack:"Last attack",village_switch:"Changing to village",no_preset:"No presets avaliable.",no_selected_village:"No villages avaliable.",no_units:"No units avaliable in village, waiting attacks return.",no_units_no_commands:"No villages has units or commands returning.",no_villages:"No villages avaliable, waiting attacks return.",preset_first:"Set a preset first!",selected_village:"Village selected",loading_targets:"Loading targets...",checking_targets:"Checking targets...",restarting_commands:"Restarting commands...",ignored_village:"added to the ignored list",priority_target:"added to priorities.",analyse_targets:"Analysing targets.",step_cycle_restart:"Restarting the cycle of commands..",step_cycle_end:"The list of villages ended, waiting for the next run.",step_cycle_end_no_villages:"No villages available to start the cycle.",step_cycle_next:"The list of villages is over, next cycle: %{time}.",step_cycle_next_no_villages:"No village available to start the cycle, next cycle: %{time}.",full_storage:"The storage of the village is full.",farm_paused:"FarmOverflow paused.",farm_started:"FarmOverflow started.",groups_presets:"Groups & presets",presets:"Attack with the presets",group_ignored:"Ignore villages from group",group_include:"Include villages from groups",group_only:"Attack only with villages from groups",random_base:"Random interval between attacks",commands_per_village:"Commands limit per village",priority_targets:"Prioritize targets with full loot",ignore_on_loss:"Ignore target that cause loss",ignore_full_storage:"Do not farm with villages with full storage",step_cycle_header:"Step Cycle Settings",step_cycle:"Enable Step Cycle",step_cycle_interval:"Interval between cycles (minutes)",step_cycle_notifs:"Cycle notifications",target_filters:"Target Filters",min_distance:"Minimum distance",max_distance:"Maximum distance",min_points:"Minimum points",max_points:"Maximum points",max_travel_time:"Maximum travel time (minutes)",logs_limit:"Limit of logs",event_attack:"Log attacks",event_village_change:"Log village changes",event_priority_add:"Log priority targets",event_ignored_village:"Log ignored villages",remote:"Remote Control Message Subject",hotkey_switch:"Start/pause hotkey",hotkey_window:"Open window hotkey",settings_saved:"Settings saved!",misc:"Miscellaneous",attack:"attack",no_logs:"No logs registered",clear_logs:"Clear logs",reseted_logs:"Registered logs reseted."}},pl_pl:{farm_overflow:{attacking:"Atakuje.",paused:"Zatrzymany.",command_limit:"Limit 50 atak처w osi훳gni휌ty, oczekiwanie na powr처t wojsk.",last_attack:"Ostatni atak",village_switch:"Przej힄cie do wioski",no_preset:"Brak dost휌pnych szablon처w.",no_selected_village:"Brak dost휌pnych wiosek.",no_units:"Brak dost휌pnych jednostek w wiosce, oczekiwanie na powr처t wojsk.",no_units_no_commands:"Brak jednostek w wioskach lub powracaj훳cych wojsk.",no_villages:"Brak dost휌pnych wiosek, oczekiwanie na powr처t wojsk.",preset_first:"Wybierz najpierw szablon!",selected_village:"Wybrana wioska",loading_targets:"흟adowanie cel처w...",checking_targets:"Sprawdzanie cel처w...",restarting_commands:"Restartowanie polece흦...",ignored_village:"dodany do listy pomini휌tych",priority_target:"dodany do priorytetowych.",analyse_targets:"Analizowanie cel처w.",step_cycle_restart:"Restartowanie cyklu polece흦...",step_cycle_end:"Lista wiosek zako흦czona, oczekiwanie na nast휌pny cykl.",step_cycle_end_no_villages:"Brak wiosek do rozpocz휌cia cyklu.",step_cycle_next:"Lista wiosek si휌 sko흦czy흢a, nast휌pny cykl: %d.",step_cycle_next_no_villages:"Brak wioski do rozpocz휌cia cyklu, nast휌pny cykl: %d.",full_storage:"Magazyn w wiosce jest pe흢ny",farm_paused:"Farmer zatrzymany",farm_started:"Farmer uruchomiony",groups_presets:"Grupy i szablony",presets:"Szablony",group_ignored:"Pomijaj wioski z grupy",group_include:"Dodaj wioski z grupy",group_only:"Tylko wioski z grupy",random_base:"Domy힄lny odst휌p (sek)",commands_per_village:"Limit polece흦",priority_targets:"Priorytyzuj cele",ignore_on_loss:"Pomijaj cele je힄li straty",ignore_full_storage:"Pomijaj wioski je힄li magazyn pe흢ny",step_cycle_header:"Cykl Farmienia",step_cycle:"W흢훳cz Cykl farmienia",step_cycle_interval:"Odst휌p mi휌dzy cyklami (minuty)",step_cycle_notifs:"Powiadomienia",target_filters:"Filtry cel처w",min_distance:"Minimalna odleg흢o힄훶",max_distance:"Maksymalna odleg흢o힄훶",min_points:"Minimalna liczba punkt처w",max_points:"Maksymalna liczba punkt처w",max_travel_time:"Maksymalny czas podr처탉y (minuty)",logs_limit:"Limit log처w",event_attack:"Logi atak처w",event_village_change:"Logi zmiany wiosek",event_priority_add:"Logi cel처w priorytetowych",event_ignored_village:"Logi pomini휌tych wiosek",remote:"Sterowanie Zdalne za pomoc훳 wiadomo힄ci PW",hotkey_switch:"Skr처t Start/Pauza",hotkey_window:"Skr처t okna Farmera",settings_saved:"Ustawienia zapisane!",misc:"R처탉ne",attack:"atakuje",no_logs:"Brak zarejestrowanych log처w",clear_logs:"Wyczy힄훶 logi",reseted_logs:"Zarejestrowane logi zosta흢y wyczyszczone."}},pt_br:{farm_overflow:{attacking:"Atacando.",paused:"Pausado.",command_limit:"Limite de 50 ataques atingido, aguardando retorno.",last_attack:"횣ltimo ataque",village_switch:"Alternando para a aldeia",no_preset:"Nenhuma predefini챌찾o dispon챠vel.",no_selected_village:"Nenhuma aldeia dispon챠vel.",no_units:"Sem unidades na aldeia, aguardando ataques retornarem.",no_units_no_commands:"Nenhuma aldeia tem tropas nem ataques retornando.",no_villages:"Nenhuma aldeia dispon챠vel, aguardando ataques retornarem.",preset_first:"Configure uma predefini챌찾o primeiro!",selected_village:"Aldeia selecionada",loading_targets:"Carregando alvos...",checking_targets:"Checando alvos...",restarting_commands:"Reiniciando comandos...",ignored_village:"adicionado a lista de ignorados.",priority_target:"adicionado as prioridades.",analyse_targets:"Analisando alvos.",step_cycle_restart:"Reiniciando o ciclo de comandos..",step_cycle_end:"A lista de aldeias acabou, esperando pr처xima execu챌찾o.",step_cycle_end_no_villages:"Nenhuma aldeia dispon챠vel para iniciar o ciclo.",step_cycle_next:"A lista de aldeias acabou, pr처ximo ciclo: %{time}.",step_cycle_next_no_villages:"Nenhuma aldeia dispon챠vel para iniciar o ciclo, pr처ximo ciclo: %{time}.",full_storage:"O armaz챕m da aldeia est찼 cheio.",farm_paused:"FarmOverflow pausado.",farm_started:"FarmOverflow iniciado.",groups_presets:"Grupos & predefini챌천es",presets:"Atacar com as predefini챌천es",group_ignored:"Ignorar aldeias do grupo",group_include:"Include aldeias dos grupos",group_only:"Atacar apenas com aldeias dos grupos",random_base:"Intervalo aleat처rio entre ataques",commands_per_village:"Limite de comandos por aldeia",priority_targets:"Priorizar alvos com saques cheios",ignore_on_loss:"Ignorar alvos que causam perdas",ignore_full_storage:"Ignorar armaz챕ns lotados",step_cycle_header:"Configura챌천es de Ciclos",step_cycle:"Ativar Ciclo",step_cycle_interval:"Intervalo entre ciclos (minutos)",step_cycle_notifs:"Notifica챌천es de ciclos",target_filters:"Filtro de Alvos",min_distance:"Dist창ncia m챠nima",max_distance:"Dist창ncia m찼xima",min_points:"Pontua챌찾o m챠nima",max_points:"Pontua챌찾o m찼xima",max_travel_time:"Tempo m찼ximo de viagem (minutos)",logs_limit:"Limite de registros",event_attack:"Registrar ataques",event_village_change:"Registrar troca de aldeias",event_priority_add:"Registrar alvos prioritarios",event_ignored_village:"Registrar alvos ignorados",remote:"Controle Remoto - Mensagem",hotkey_switch:"Atalho para inicar/pausar",hotkey_window:"Atalho para abrir janela",settings_saved:"Configura챌천es salvas!",misc:"Diversos",attack:"ataca",no_logs:"Nenhum evento registrado",clear_logs:"Limpar eventos",reseted_logs:"Registro de eventos resetado."}}}),i.init(),a()},["map"])}),define("two/farmOverflow/ui",["two/ui","two/ui/button","two/farmOverflow","two/farmOverflow/errorTypes","two/farmOverflow/logTypes","two/farmOverflow/settings","two/utils","two/EventScope","queues/EventQueue","struct/MapData","helper/time"],function(e,t,a,o,l,d,u,m,E,v,f){var T,b,h="farm_overflow",A=[d.PRESETS,d.GROUP_IGNORE,d.GROUP_INCLUDE,d.GROUP_ONLY],S={SETTINGS:"settings",LOGS:"logs"},w=n.getPresetList(),O=n.getGroupList(),I=function(e){b.selectedTab=e},R=function(){b.logs=[],b.visibleLogs=[],a.clearLogs()},x=function(){var e=angular.copy(b.settings);A.forEach(function(t){angular.isArray(e[t])?e[t].length&&e[t][0].value?e[t]=e[t].map(function(e){return e.value}):e[t]=[]:e[t]=!!e[t].value&&e[t].value}),a.updateSettings(e)},C=function(e){var t,i,a=angular.copy(e),n={},o={};return b.groups.forEach(function(e){n[e.value]={name:e.name,leftIcon:e.leftIcon}}),b.presets.forEach(function(e){o[e.value]=e.name}),A.forEach(function(e){i=a[e],"presets"===e?a[e]=i.map(function(e){return{name:o[e],value:e}}):angular.isArray(i)?a[e]=i.map(function(e){return{name:n[e].name,value:e,leftIcon:n[e].leftIcon}}):i&&(t=a[e],a[e]={name:n[t].name,value:t,leftIcon:n[t].leftIcon})}),function(e){A.forEach(function(t){angular.isArray(e[t])?e[t].length||(e[t]=[L()]):e[t]||(e[t]=L())})}(a),a},L=function(){return{name:_("i18n")("disabled",i.loc.ale,"common"),value:!1}},y=function(){a.switchState(!0)},N=function(){var e=function(e){if(b.villagesLabel[e.coords])return!1;var t=e.coords.split("|"),i=parseInt(t[0],10),a=parseInt(t[1],10);v.getTownAtAsync(i,a,function(t){b.villagesLabel[e.coords]=`${t.name} (${e.coords})`})};b.logs.forEach(function(t){t.origin&&e(t.origin),t.target&&e(t.target),t.village&&e(t.village)})},M=function(){var e=b.pagination.offset,t=b.pagination.limit;b.visibleLogs=b.logs.slice(e,e+t)},D=function(){b.presets=u.obj2selectOptions(w.getPresets())},G=function(){b.groups=u.obj2selectOptions(O.getGroups(),!0),b.groupsWithDisabled=angular.copy(b.groups),b.groupsWithDisabled.unshift(L())},P=function(e,t){b.running=!0,t&&u.emitNotif("success",_("i18n")("farm_started",i.loc.ale,h))},k=function(e,t){b.running=!1,t&&u.emitNotif("success",_("i18n")("farm_paused",i.loc.ale,h))},U=function(){b.selectedVillage=a.getSelectedVillage()},q=function(){b.lastAttack=a.getLastAttack()},V=function(e,t){b.currentStatus=t},j=function(){b.logs=angular.copy(a.getLogs()),N(),M()},B=function(){u.emitNotif("success",_("i18n")("reseted_logs",i.loc.ale,h))},H=function(){a.getSettings()[d.STEP_CYCLE_NOTIFS]&&u.emitNotif("error",_("i18n")("step_cycle_end",i.loc.ale,h))},z=function(){u.emitNotif("error",_("i18n")("step_cycle_end_no_villages",i.loc.ale,h))},Y=function(){var e=a.getSettings();if(e[d.STEP_CYCLE_NOTIFS]){var t=f.gameTime()+60*e[d.STEP_CYCLE_INTERVAL];u.emitNotif("success",_("i18n")("step_cycle_next",i.loc.ale,h,u.formatDate(t)))}},F=function(e,t){var a=t[0];if(!t[1])return!1;switch(a){case o.PRESET_FIRST:u.emitNotif("error",_("i18n")("preset_first",i.loc.ale,h));break;case o.NO_SELECTED_VILLAGE:u.emitNotif("error",_("i18n")("no_selected_village",i.loc.ale,h))}},Q=function(){u.emitNotif("success",_("i18n")("settings_saved",i.loc.ale,h))},W=function(){var e;(b=i.$new()).textObject=h,b.textObjectCommon="common",b.SETTINGS=d,b.TAB_TYPES=S,b.LOG_TYPES=l,b.presets=[],b.groups=[],b.groupsWithDisabled=[],b.selectedTab=S.SETTINGS,b.settings=(e={},A.forEach(function(t){e[t]="groupIgnore"===t?L():[L()]}),e),b.selectedVillage=a.getSelectedVillage(),b.lastAttack=a.getLastAttack(),b.running=a.isRunning(),b.currentStatus=a.getCurrentStatus(),b.logs=a.getLogs(),b.villagesLabel={},b.visibleLogs=[],b.pagination={count:b.logs.length,offset:0,loader:M,limit:p.getPaginationLimit()},D(),G(),U(),q(),M(),N(),b.selectTab=I,b.saveSettings=x,b.clearLogs=R,b.switchFarm=y,b.jumpToVillage=g.jumpToVillage,b.openVillageInfo=s.openVillageInfo,(T=new m("twoverflow_farm_window")).register(r.ARMY_PRESET_UPDATE,D,!0),T.register(r.ARMY_PRESET_DELETED,D,!0),T.register(r.GROUPS_UPDATED,G,!0),T.register(r.GROUPS_CREATED,G,!0),T.register(r.GROUPS_DESTROYED,G,!0),T.register(r.FARM_START,P),T.register(r.FARM_PAUSE,k),T.register(r.FARM_VILLAGES_UPDATE,U),T.register(r.FARM_NEXT_VILLAGE,U),T.register(r.FARM_SEND_COMMAND,q),T.register(r.FARM_STATUS_CHANGE,V),T.register(r.FARM_RESET_LOGS,j),T.register(r.FARM_LOGS_RESETED,B),T.register(r.FARM_LOGS_UPDATED,j),T.register(r.FARM_STEP_CYCLE_END,H),T.register(r.FARM_STEP_CYCLE_END_NO_VILLAGES,z),T.register(r.FARM_STEP_CYCLE_NEXT,Y),T.register(r.FARM_ERROR,F),T.register(r.FARM_SETTINGS_CHANGE,Q),c.getScreenWithInjectedScope("!twoverflow_farm_window",b),b.settings=C(a.getSettings())};return function(){var i=new t("Farmer",{classHover:!1,classBlur:!1,onClick:W});E.register(r.FARM_START,function(){i.$elem.classList.remove("btn-green"),i.$elem.classList.add("btn-red")}),E.register(r.FARM_PAUSE,function(){i.$elem.classList.remove("btn-red"),i.$elem.classList.add("btn-green")}),e.addTemplate("twoverflow_farm_window",'<div id="two-farmoverflow" class="win-content two-window"><header class="win-head"><h2>FarmOverflow</h2><ul class="list-btn"><li><a href="#" class="size-34x34 btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main" scrollbar=""><div class="tabs tabs-bg"><div class="tabs-two-col"><div class="tab" ng-click="selectTab(TAB_TYPES.SETTINGS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.SETTINGS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.SETTINGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.SETTINGS}">{{ TAB_TYPES.SETTINGS | i18n:loc.ale:textObjectCommon }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.LOGS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.LOGS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.LOGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.LOGS}">{{ TAB_TYPES.LOGS | i18n:loc.ale:textObjectCommon }}</a></div></div></div></div></div><div class="box-paper footer"><div class="scroll-wrap"><div class="settings" ng-show="selectedTab === TAB_TYPES.SETTINGS"><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"></colgroup><tr><th colspan="2">{{ \'groups_presets\' | i18n:loc.ale:textObject }}</th></tr><tr><td><span class="ff-cell-fix">{{ \'presets\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="presets" selected="settings[SETTINGS.PRESETS]" drop-down="true"></div></td></tr><tr><td><span class="ff-cell-fix">{{ \'group_ignored\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="groupsWithDisabled" selected="settings[SETTINGS.GROUP_IGNORE]" drop-down="true"></div></td></tr><tr><td><span class="ff-cell-fix">{{ \'group_include\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="groups" selected="settings[SETTINGS.GROUP_INCLUDE]" drop-down="true"></div></td></tr><tr><td><span class="ff-cell-fix">{{ \'group_only\' | i18n:loc.ale:textObject }}</span></td><td><div select="" list="groups" selected="settings[SETTINGS.GROUP_ONLY]" drop-down="true"></div></td></tr></table><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"><col width="60px"></colgroup><tr><th colspan="3">{{ \'misc\' | i18n:loc.ale:textObject }}</th></tr><tr><td><span class="ff-cell-fix">{{ \'random_base\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="30" value="settings[SETTINGS.RANDOM_BASE]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.RANDOM_BASE]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'commands_per_village\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="50" value="settings[SETTINGS.COMMANDS_PER_VILLAGE]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.COMMANDS_PER_VILLAGE]"></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'priority_targets\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.PRIORITY_TARGETS]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'ignore_on_loss\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="settings[SETTINGS.GROUP_IGNORE].value" border="true" value="settings[SETTINGS.IGNORE_ON_LOSS]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'ignore_full_storage\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.IGNORE_FULL_STORAGE]" vertical="false" size="\'56x28\'"></div></td></tr></table><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"><col width="60px"></colgroup><tr><th colspan="3">{{ \'step_cycle_header\' | i18n:loc.ale:textObject }}</th></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'step_cycle\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.STEP_CYCLE]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'step_cycle_notifs\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="settings[SETTINGS.STEP_CYCLE]" border="true" value="settings[SETTINGS.STEP_CYCLE_NOTIFS]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td><span class="ff-cell-fix">{{ \'step_cycle_interval\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="120" value="settings[SETTINGS.STEP_CYCLE_INTERVAL]" enabled="settings[SETTINGS.STEP_CYCLE]"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.STEP_CYCLE_INTERVAL]" ng-disabled="!settings[SETTINGS.STEP_CYCLE]"></td></tr></table><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"><col width="60px"></colgroup><tr><th colspan="3">{{ \'target_filters\' | i18n:loc.ale:textObject }}</th></tr><tr><td><span class="ff-cell-fix">{{ \'min_distance\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="50" value="settings[SETTINGS.MIN_DISTANCE]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.MIN_DISTANCE]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'max_distance\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="50" value="settings[SETTINGS.MAX_DISTANCE]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.MAX_DISTANCE]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'min_points\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="13000" value="settings[SETTINGS.MIN_POINTS]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.MIN_POINTS]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'max_points\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="13000" value="settings[SETTINGS.MAX_POINTS]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.MAX_POINTS]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'max_travel_time\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="180" value="settings[SETTINGS.MAX_TRAVEL_TIME]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.MAX_TRAVEL_TIME]"></td></tr></table><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"><col width="60px"></colgroup><tr><th colspan="3">{{ TAB_TYPES.LOGS | i18n:loc.ale:textObjectCommon }}</th></tr><tr><td><span class="ff-cell-fix">{{ \'logs_limit\' | i18n:loc.ale:textObject }}</span></td><td><div range-slider="" min="0" max="1000" value="settings[SETTINGS.LOGS_LIMIT]" enabled="true"></div></td><td class="cell-bottom"><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.LOGS_LIMIT]"></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'event_attack\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.EVENT_ATTACK]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'event_village_change\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.EVENT_VILLAGE_CHANGE]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'event_priority_add\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.EVENT_PRIORITY_ADD]" vertical="false" size="\'56x28\'"></div></td></tr><tr><td colspan="2"><span class="ff-cell-fix">{{ \'event_ignored_village\' | i18n:loc.ale:textObject }}</span></td><td><div switch-slider="" enabled="true" border="true" value="settings[SETTINGS.EVENT_IGNORED_VILLAGE]" vertical="false" size="\'56x28\'"></div></td></tr></table><table class="tbl-border-light tbl-content tbl-medium-height"><colgroup><col><col width="200px"></colgroup><tr><th colspan="2">{{ \'others\' | i18n:loc.ale:textObjectCommon }}</th></tr><tr><td><span class="ff-cell-fix">{{ \'remote\' | i18n:loc.ale:textObject }}</span></td><td><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.REMOTE_ID]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'hotkey_switch\' | i18n:loc.ale:textObject }}</span></td><td><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.HOTKEY_SWITCH]"></td></tr><tr><td><span class="ff-cell-fix">{{ \'hotkey_window\' | i18n:loc.ale:textObject }}</span></td><td><input type="text" class="fit textfield-border text-center" ng-model="settings[SETTINGS.HOTKEY_WINDOW]"></td></tr></table></div><div class="logs rich-text" ng-show="selectedTab === TAB_TYPES.LOGS"><table class="status tbl-border-light"><colgroup><col width="135px"><col width="*"></colgroup><tbody><tr><td>{{ \'status\' | i18n:loc.ale:textObjectCommon }}</td><td><span>{{ currentStatus | i18n:loc.ale:textObject }}</span></td></tr><tr><td>{{ \'selected_village\' | i18n:loc.ale:textObject }}</td><td><span ng-show="selectedVillage" class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(selectedVillage.id)">{{ selectedVillage.name }} ({{ selectedVillage.x }}|{{ selectedVillage.y }})</span> <span ng-show="!selectedVillage">{{ \'none\' | i18n:loc.ale:textObjectCommon }}</span></td></tr><tr><td>{{ \'last_attack\' | i18n:loc.ale:textObject }}</td><td><span ng-show="lastAttack !== -1">{{ lastAttack | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</span> <span ng-show="lastAttack === -1">{{ \'none\' | i18n:loc.ale:textObjectCommon }}</span></td></tr></tbody></table><h5 class="twx-section">{{ TAB_TYPES.LOGS | i18n:loc.ale:textObjectCommon }}</h5><div class="page-wrap" pagination="pagination"></div><p class="text-center" ng-show="!visibleLogs.length">{{ \'no_logs\' | i18n:loc.ale:textObject }}</p><table class="log-list tbl-border-light tbl-striped" ng-show="visibleLogs.length"><colgroup><col width="180px"><col width="30px"><col></colgroup><tr ng-repeat="log in visibleLogs"><td>{{ log.time | readableDateFilter:loc.ale:GAME_TIMEZONE:GAME_TIME_OFFSET }}</td><td><span class="icon-bg-black icon-26x26-{{ log.icon }}"></span></td><td ng-if="log.type === LOG_TYPES.ATTACK"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(log.origin.id)" tooltip="" tooltip-content="{{ villagesLabel[log.origin.coords] }}">{{ villagesLabel[log.origin.coords] }}</span> {{ \'attack\' | i18n:loc.ale:textObject }} <span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(log.target.id)" tooltip="" tooltip-content="{{ villagesLabel[log.target.coords] }}">{{ villagesLabel[log.target.coords] }}</span></td><td ng-if="log.type === LOG_TYPES.VILLAGE_SWITCH">{{ \'village_switch\' | i18n:loc.ale:textObject }} <span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(log.village.id)" tooltip="" tooltip-content="{{ villagesLabel[log.village.coords] }}">{{ villagesLabel[log.village.coords] }}</span></td><td ng-if="log.type === LOG_TYPES.NO_PRESET">{{ \'no_preset\' | i18n:loc.ale:textObject }}</td><td ng-if="log.type === LOG_TYPES.PRIORITY_TARGET"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(log.village.id)" tooltip="" tooltip-content="{{ villagesLabel[log.village.coords] }}">{{ villagesLabel[log.village.coords] }}</span> {{ \'priority_target\' | i18n:loc.ale:textObject }}</td><td ng-if="log.type === LOG_TYPES.IGNORED_VILLAGE"><span class="village-link img-link icon-20x20-village btn btn-orange padded" ng-click="openVillageInfo(log.village.id)" tooltip="" tooltip-content="{{ villagesLabel[log.village.coords] }}">{{ villagesLabel[log.village.coords] }}</span> {{ \'ignored_village\' | i18n:loc.ale:textObject }}</td></tr></table><div class="page-wrap" pagination="pagination"></div></div></div></div></div><footer class="win-foot"><ul class="list-btn list-center"><li ng-show="selectedTab === TAB_TYPES.SETTINGS"><a href="#" class="btn-border btn-orange" ng-click="saveSettings()">{{ \'save\' | i18n:loc.ale:textObjectCommon }}</a></li><li ng-show="selectedTab === TAB_TYPES.LOGS"><a href="#" class="btn-border btn-orange" ng-click="clearLogs()">{{ \'clear_logs\' | i18n:loc.ale:textObject }}</a></li><li><a href="#" ng-class="{false:\'btn-green\', true:\'btn-red\'}[running]" class="btn-border" ng-click="switchFarm()"><span ng-show="running">{{ \'pause\' | i18n:loc.ale:textObjectCommon }}</span> <span ng-show="!running">{{ \'start\' | i18n:loc.ale:textObjectCommon }}</span></a></li></ul></footer></div>'),e.addStyle("#two-farmoverflow .settings table{margin-bottom:15px}#two-farmoverflow .settings input.textfield-border{padding-top:6px;width:219px;height:34px}#two-farmoverflow .settings input.textfield-border.fit{width:100%}#two-farmoverflow .settings span.select-wrapper{width:219px}#two-farmoverflow .settings .range-container{width:350px}#two-farmoverflow .logs .status tr{height:25px}#two-farmoverflow .logs .status td{padding:0 6px}#two-farmoverflow .logs .log-list{margin-bottom:10px}#two-farmoverflow .logs .log-list td{text-align:center}#two-farmoverflow .logs .log-list td .village-link{max-width:200px;white-space:nowrap;text-overflow:ellipsis}")}}),define("two/minimap",["two/minimap/actionTypes","two/minimap/settings","two/minimap/settingsMap","two/utils","two/ready","queues/EventQueue","Lockr","struct/MapData","helper/mapconvert","cdn","conf/colors","conf/colorGroups","conf/conf","version"],function(t,a,o,l,s,c,d,u,g,_,p,m,E,v){var f,T,b,h,A,S,w,O,I,R,x,C=!1,L={},y=5,N=1,M=/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,D={village:{},character:{},tribe:{}},G={},P=null,k={},U={},q={},V="minimap_cache_villages",j="minimap_settings",B=injector.get("colorService"),H=!0,z=!1,Y={},F=function(e){var t=ge.getVillageBlock(),i=ge.getVillageAxisOffset(),a=Math.ceil(k.x+e.offsetX),n=Math.ceil(k.y+e.offsetY);return Math.floor(n/t%2)%2&&(a-=i),a-=a%t,n-=n%t,{x:Math.ceil((a-U.x/2)/t),y:Math.ceil((n-U.y/2)/t)}},Q=function(e,t){return{x:e/E.TILESIZE.x,y:t/E.TILESIZE.y/E.TILESIZE.off}},W=function(e,t){var i,n,o,l,r,s=O.getId(),c=O.getTribeId(),d=ge.getVillageBlock(),u=ge.getVillageSize(),g=ge.getVillageAxisOffset(),_=O.getVillagesColors();for(r=0;r<e.length;r++)if(!((i=e[r]).id<0)){if(t)l=t,n=i[0]*d,o=i[1]*d,i[1]%2&&(n+=g);else if(n=i.x*d,o=i.y*d,i.y%2&&(n+=g),q[a.SHOW_ONLY_CUSTOM_HIGHLIGHTS])if(i.character_id in L.character)l=L.character[i.character_id];else{if(!(i.tribe_id in L.tribe))continue;l=L.tribe[i.tribe_id]}else if(null===i.character_id){if(!q[a.SHOW_BARBARIANS])continue;l=_.barbarian}else l=i.character_id===s?i.id===R.getId()&&q[a.HIGHLIGHT_SELECTED]?_.selected:i.character_id in L.character?L.character[i.character_id]:q[a.HIGHLIGHT_OWN]?_.player:_.ugly:i.character_id in L.character?L.character[i.character_id]:i.tribe_id in L.tribe?L.tribe[i.tribe_id]:c&&c===i.tribe_id&&q[a.HIGHLIGHT_DIPLOMACY]?_.tribe:I&&q[a.HIGHLIGHT_DIPLOMACY]?I.isAlly(i.tribe_id)?_.ally:I.isEnemy(i.tribe_id)?_.enemy:I.isNAP(i.tribe_id)?_.friendly:_.ugly:_.ugly;h.fillStyle=l,h.fillRect(n,o,u,u)}},K=function(){var e,t,i,n=_.getPath(E.getMapPath()),o=ge.getVillageBlock(),r=Math.round(o/2);l.xhrGet(n,function(n){for(x=new DataView(n),t=1;t<999;t++)for(i=1;i<999;i++)(e=g.toTile(x,t,i)).key.b&&(e.key.c?(h.fillStyle=q[a.COLOR_CONTINENT],h.fillRect(t*o+r-1,i*o+r-1,3,1),h.fillRect(t*o+r,i*o+r-2,1,3)):(h.fillStyle=q[a.COLOR_PROVINCE],h.fillRect(t*o+r,i*o+r-1,1,1)))},"arraybuffer")},X=function(){W(u.getTowns())},$=function(){var e,t,i,n,o,l=ge.getVillageBlock(),r=ge.getVillageSize(),s=ge.getVillageAxisOffset();for(e in G)for(i=0;i<G[e].length;i++)n=e*l,o=(t=G[e][i])*l,t%2&&(n+=s),h.fillStyle=q[a.COLOR_GHOST],h.fillRect(n,o,r,r)},Z=function(){if(C){var t={x:k.x-U.x/2,y:k.y-U.y/2};T.clearRect(0,0,f.width,f.height),S.clearRect(0,0,A.width,A.height),function(e){T.drawImage(b,-e.x,-e.y)}(t),q[a.SHOW_CROSS]&&function(e){var t=ge.getVillageBlock(),i=ge.getLineSize(),n=ge.getMapPosition(),o=(n[0]+n[2]-2)*t-e.x,l=(n[1]+n[3]-2)*t-e.y;S.fillStyle=q[a.COLOR_CROSS],S.fillRect(0|o,0,1,i),S.fillRect(0,0|l,i,1)}(t)}e.requestAnimationFrame(Z)},J=function(e){var t,i;for(t=0;t<e.length;t++)(i=e[t]).id<0||(i.x in D.village||(D.village[i.x]={}),i.x in G||(G[i.x]=[]),D.village[i.x][i.y]=i.character_id||0,G[i.x].push(i.y),i.character_id&&(i.character_id in D.character?D.character[i.character_id].push([i.x,i.y]):D.character[i.character_id]=[[i.x,i.y]],i.tribe_id&&(i.tribe_id in D.tribe?D.tribe[i.tribe_id].push(i.character_id):D.tribe[i.tribe_id]=[i.character_id])));d.set(V,G)},ee=function(){var e;if(!P)return!1;e=D.village[P.x][P.y],ie(e?D.character[e]:[[P.x,P.y]]),P=!1,c.trigger(r.MINIMAP_VILLAGE_BLUR)},te=function(e){W(e,q[a.COLOR_QUICK_HIGHLIGHT])},ie=function(e){var t,i=[];for(t=0;t<e.length;t++)i.push(u.getTownAt(e[t][0],e[t][1]));W(i)},ae=function(e){e.preventDefault(),H=!0,z=!0,Y={x:k.x+e.pageX,y:k.y+e.pageY},P&&(c.trigger(r.MINIMAP_VILLAGE_CLICK,[P,e]),3===e.which&&function(e){var i=u.getTownAt(e.x,e.y),n=(q[a.RIGHT_CLICK_ACTION],{});if(!i)return!1;switch(q[a.RIGHT_CLICK_ACTION]){case t.HIGHLIGHT_PLAYER:if(!i.character_id)return!1;n.type="character",n.id=i.character_id;break;case t.HIGHLIGHT_TRIBE:if(!i.tribe_id)return!1;n.type="tribe",n.id=i.tribe_id}ge.addHighlight(n,"#"+p.palette.random().random())}(P))},ne=function(){z=!1,Y={},H||c.trigger(r.MINIMAP_STOP_MOVE)},oe=function(e){var t,i,n;if(H=!1,z&&(k.x=Y.x-e.pageX,k.y=Y.y-e.pageY,c.trigger(r.MINIMAP_START_MOVE)),(t=F(e)).x in D.village&&t.y in D.village[t.x])return i=u.getTownAt(t.x,t.y),!(!q[a.SHOW_BARBARIANS]&&!i.character_id)&&(!(q[a.SHOW_ONLY_CUSTOM_HIGHLIGHTS]&&(n=!1,i.character_id in L.character?n=!0:i.tribe_id in L.tribe&&(n=!0),!n))&&function(e,t){var i;if(P){if(P.x===e.x&&P.y===e.y)return!1;ee()}c.trigger(r.MINIMAP_VILLAGE_HOVER,{village:u.getTownAt(e.x,e.y),event:t}),P={x:e.x,y:e.y},i=D.village[e.x][e.y],te(i?D.character[i]:[[e.x,e.y]])}(t,e));ee()},le=function(){P&&ee(),c.trigger(r.MINIMAP_MOUSE_LEAVE)},re=function(e){if(!H)return!1;var t=F(e);i.$broadcast(r.MAP_CENTER_ON_POSITION,t.x,t.y,!0)},se=function(e){return e.preventDefault(),!1},ce=function(e,t){W(t.villages),J(t.villages)},de=function(){L.tribe=B.getCustomColorsByGroup(m.TRIBE_COLORS)||{},L.character=B.getCustomColorsByGroup(m.PLAYER_COLORS)||{},X()},ue=function(){var e={id:R.getId(),x:R.getX(),y:R.getY()};R=O.getSelectedVillage(),W([{character_id:O.getId(),id:e.id,x:e.x,y:e.y},{character_id:O.getId(),id:R.getId(),x:R.getX(),y:R.getY()}])},ge={SETTINGS_MAP:o,ACTION_TYPES:t,setVillageSize:function(e){y=e},getVillageSize:function(){return y},setVillageMargin:function(e){N=e},getVillageMargin:function(){return N},getVillageBlock:function(){return y+N},getLineSize:function(){return 1e3*(y+N)},getVillageAxisOffset:function(){return Math.round(y/2)},addHighlight:function(e,t){var a;return e&&e.type&&e.id?M.test(t)?(L[e.type][e.id]=t,a="character"===e.type?m.PLAYER_COLORS:m.TRIBE_COLORS,B.setCustomColorsByGroup(a,L[e.type]),i.$broadcast(r.GROUPS_VILLAGES_CHANGED),X(),!0):(c.trigger(r.MINIMAP_HIGHLIGHT_ADD_ERROR_INVALID_COLOR),!1):(c.trigger(r.MINIMAP_HIGHLIGHT_ADD_ERROR_NO_ENTRY),!1)},removeHighlight:function(e,t){var a="character"===e?m.PLAYER_COLORS:m.TRIBE_COLORS;return!!L[e][t]&&(delete L[e][t],B.setCustomColorsByGroup(a,L[e]),i.$broadcast(r.GROUPS_VILLAGES_CHANGED),X(),!0)},getHighlight:function(e,t){return!!L[e].hasOwnProperty(t)&&L[e][t]},getHighlights:function(){return L},eachHighlight:function(e){for(var t in L)for(var i in L[t])e(t,i,L[t][i])},setViewport:function(e){(f=e).style.background=q[a.COLOR_BACKGROUND],T=f.getContext("2d")},setCross:function(e){S=(A=e).getContext("2d")},setCurrentPosition:function(e,t){var i=ge.getVillageBlock();k.x=e*i+50,k.y=t*i+(1e3-(document.body.clientHeight-238)/2)+50}};return ge.getMapPosition=function(){var t;return!(!w.width||!w.height)&&function(e,t){t=1/(t||1);var i=Q(e[0]*t,e[1]*t),a=Q(e[2]*t,e[3]*t);return[i.x-1,i.y-1,a.x+3||1,a.y+3||1]}([-(t=1===v.product.major&&v.product.minor<94?e.twx.game.map.engine.getView():u.getMap().engine.getView()).x,-t.y,w.width/2,w.height/2],t.z)},ge.updateSettings=function(e){var t,i,a,n=!1;for(i in e)a=o[i],t=e[i],a&&!angular.equals(q[i],t)&&(a.update&&(n=!0),q[i]=t);return d.set(j,q),n&&ge.update(),c.trigger(r.MINIMAP_SETTINGS_SAVE),!0},ge.resetSettings=function(){for(var e in o)q[e]=o[e].default;d.set(j,q),ge.update(),c.trigger(r.MINIMAP_SETTINGS_RESET)},ge.getSettings=function(){return q},ge.update=function(){ge.getVillageBlock();f.style.background=q[a.COLOR_BACKGROUND],h.clearRect(0,0,b.width,b.height),q[a.SHOW_DEMARCATIONS]&&K(),q[a.SHOW_GHOST_VILLAGES]&&$(),X()},ge.enableRendering=function(){C=!0},ge.disableRendering=function(){C=!1},ge.init=function(){var e,t,i;for(t in ge.initialized=!0,b=document.createElement("canvas"),h=b.getContext("2d"),e=d.get(j,{},!0),o)i=o[t].default,q[t]=e.hasOwnProperty(t)?e[t]:i;L.tribe=B.getCustomColorsByGroup(m.TRIBE_COLORS)||{},L.character=B.getCustomColorsByGroup(m.PLAYER_COLORS)||{}},ge.run=function(){var e;s(function(){w=document.getElementById("main-canvas"),O=n.getSelectedCharacter(),I=O.getTribeRelations(),G=d.get(V,{},!0),e=ge.getVillageBlock(),k.x=500*e,k.y=500*e,U.x=701,U.y=2e3,f.setAttribute("width",U.x),f.setAttribute("height",U.y),T.imageSmoothingEnabled=!1,b.setAttribute("width",1e3*e),b.setAttribute("height",1e3*e),b.imageSmoothingEnabled=!1,A.setAttribute("width",U.x),A.setAttribute("height",U.y),S.imageSmoothingEnabled=!1,R=O.getSelectedVillage(),k.x=R.getX()*e,k.y=R.getY()*e,q[a.SHOW_DEMARCATIONS]&&K(),q[a.SHOW_GHOST_VILLAGES]&&$(),X(),J(u.getTowns()),Z(),A.addEventListener("mousedown",ae),A.addEventListener("mouseup",ne),A.addEventListener("mousemove",oe),A.addEventListener("mouseleave",le),A.addEventListener("click",re),A.addEventListener("contextmenu",se),i.$on(r.MAP_VILLAGE_DATA,ce),i.$on(r.VILLAGE_SELECTED_CHANGED,ue),i.$on(r.TRIBE_RELATION_CHANGED,X),i.$on(r.GROUPS_VILLAGES_CHANGED,de)},["initial_village","tribe_relations"])},ge}),define("two/minimap/actionTypes",[],function(){return{HIGHLIGHT_PLAYER:"highlight_player",HIGHLIGHT_TRIBE:"highlight_tribe"}}),define("two/minimap/events",[],function(){angular.extend(r,{MINIMAP_SETTINGS_RESET:"minimap_settings_reset",MINIMAP_SETTINGS_SAVE:"minimap_settings_save",MINIMAP_HIGHLIGHT_ADD_ERROR_EXISTS:"minimap_highlight_add_error_exists",MINIMAP_HIGHLIGHT_ADD_ERROR_NO_ENTRY:"minimap_highlight_add_error_no_entry",MINIMAP_HIGHLIGHT_ADD_ERROR_INVALID_COLOR:"minimap_highlight_add_error_invalid_color",MINIMAP_VILLAGE_CLICK:"minimap_village_click",MINIMAP_VILLAGE_HOVER:"minimap_village_hover",MINIMAP_VILLAGE_BLUR:"minimap_village_blur",MINIMAP_MOUSE_LEAVE:"minimap_mouse_leave",MINIMAP_START_MOVE:"minimap_start_move",MINIMAP_STOP_MOVE:"minimap_stop_move"})}),define("two/minimap/settingsMap",["two/minimap/settings","two/minimap/actionTypes"],function(e,t){return{[e.RIGHT_CLICK_ACTION]:{default:t.HIGHLIGHT_PLAYER,inputType:"select",update:!1},[e.SHOW_CROSS]:{default:!0,inputType:"checkbox",update:!0},[e.SHOW_DEMARCATIONS]:{default:!0,inputType:"checkbox",update:!0},[e.SHOW_BARBARIANS]:{default:!1,inputType:"checkbox",update:!0},[e.SHOW_GHOST_VILLAGES]:{default:!1,inputType:"checkbox",update:!0},[e.SHOW_ONLY_CUSTOM_HIGHLIGHTS]:{default:!1,inputType:"checkbox",update:!0},[e.HIGHLIGHT_OWN]:{default:!0,inputType:"checkbox",update:!0},[e.HIGHLIGHT_SELECTED]:{default:!0,inputType:"checkbox",update:!0},[e.HIGHLIGHT_DIPLOMACY]:{default:!0,inputType:"checkbox",update:!0},[e.COLOR_SELECTED]:{default:"#ffffff",inputType:"color",update:!0},[e.COLOR_BARBARIAN]:{default:"#969696",inputType:"color",update:!0},[e.COLOR_PLAYER]:{default:"#f0c800",inputType:"color",update:!0},[e.COLOR_QUICK_HIGHLIGHT]:{default:"#ffffff",inputType:"color",update:!0},[e.COLOR_BACKGROUND]:{default:"#436213",inputType:"color",update:!0},[e.COLOR_PROVINCE]:{default:"#ffffff",inputType:"color",update:!0},[e.COLOR_CONTINENT]:{default:"#cccccc",inputType:"color",update:!0},[e.COLOR_CROSS]:{default:"#999999",inputType:"color",update:!0},[e.COLOR_TRIBE]:{default:"#0000DB",inputType:"color",update:!0},[e.COLOR_ALLY]:{default:"#00a0f4",inputType:"color",update:!0},[e.COLOR_ENEMY]:{default:"#ED1212",inputType:"color",update:!0},[e.COLOR_FRIENDLY]:{default:"#BF4DA4",inputType:"color",update:!0},[e.COLOR_UGLY]:{default:"#A96534",inputType:"color",update:!0},[e.COLOR_GHOST]:{default:"#3E551C",inputType:"color",update:!0}}}),define("two/minimap/settings",[],function(){return{RIGHT_CLICK_ACTION:"right_click_action",FLOATING_MINIMAP:"floating_minimap",SHOW_CROSS:"show_cross",SHOW_DEMARCATIONS:"show_demarcations",SHOW_BARBARIANS:"show_barbarians",SHOW_GHOST_VILLAGES:"show_ghost_villages",SHOW_ONLY_CUSTOM_HIGHLIGHTS:"show_only_custom_highlights",HIGHLIGHT_OWN:"highlight_own",HIGHLIGHT_SELECTED:"highlight_selected",HIGHLIGHT_DIPLOMACY:"highlight_diplomacy",COLOR_GHOST:"color_ghost",COLOR_QUICK_HIGHLIGHT:"color_quick_highlight",COLOR_BACKGROUND:"color_background",COLOR_PROVINCE:"color_province",COLOR_CONTINENT:"color_continent",COLOR_CROSS:"color_cross"}}),require(["two/language","two/ready","two/minimap","two/minimap/ui","two/minimap/events","two/minimap/actionTypes","two/minimap/settings","two/minimap/settingsMap"],function(e,t,i,a){if(i.initialized)return!1;t(function(){e.add("minimap",{en_us:{minimap:{minimap:"Minimap",highlights:"Highlights",add:"Add highlight",remove:"Remove highlight",placeholder_search:"Search player/tribe",highlight_add_success:"Highlight added",highlight_add_error:"Specify a highlight first",highlight_update_success:"Highlight updated",highlight_remove_success:"Highlight removed",highlight_villages:"Villages",highlight_players:"Players",highlight_tribes:"Tribes",highlight_add_error_exists:"Highlight already exists!",highlight_add_error_no_entry:"Select a player/tribe first!",highlight_add_error_invalid_color:"Invalid color!",village:"Village",player:"Player",tribe:"Tribe",color:"Color (Hex)",tooltip_pick_color:"Select a color",misc:"Miscellaneous settings",colors_misc:"Miscellaneous colors",colors_diplomacy:"Diplomacy colors",settings_saved:"Settings saved!",settings_right_click_action:"Village's right click action",highlight_village:"Highlight village",highlight_player:"Highlight player",highlight_tribe:"Highlight tribe",settings_show_floating_minimap:"Show floating minimap",settings_show_cross:"Show position cross",settings_show_demarcations:"Show province/continent demarcations",settings_show_barbarians:"Show barbarian villages",settings_show_ghost_villages:"Show non-loaded villages",settings_show_only_custom_highlights:"Show only custom highlights",settings_highlight_own:"Highlight own villages",settings_highlight_selected:"highlight selected village",settings_highlight_diplomacy:"Auto highlight tribe diplomacies",settings_colors_background:"Minimap background",settings_colors_province:"Province demarcation",settings_colors_continent:"Continent demarcation",settings_colors_quick_highlight:"Quick highlight",settings_colors_tribe:"Own tribe",settings_colors_player:"Own villages",settings_colors_selected:"Selected village",settings_colors_ghost:"Non-loaded villages",settings_colors_ally:"Ally",settings_colors_pna:"PNA",settings_colors_enemy:"Enemy",settings_colors_other:"Other",settings_colors_barbarian:"Barbarian",settings_colors_cross:"Position cross",settings_reset:"Settings reseted",tooltip_village:"Village",tooltip_village_points:"Village points",tooltip_player:"Player name",tooltip_player_points:"Player points",tooltip_tribe:"Tribe",tooltip_tribe_points:"Tribe points",tooltip_province:"Province name",no_highlights:"No highlights created",reset_confirm_title:"Reset settings",reset_confirm_text:"All settings gonna be reseted to the default settings.",reset_confirm_highlights_text:"Also, all highlights are going to be deleted."}},pl_pl:{minimap:{minimap:"Kartograf",highlights:"Pod힄wietlenie",add:"Dodaj pod힄wietlenie",remove:"Usu흦 pod힄wietlenie",placeholder_search:"gracz/plemie",highlight_add_success:"Pod힄wietlenie dodane",highlight_add_error:"Najpierw sprecyzuj pod힄wietlenie",highlight_update_success:"Pod힄wietlenie zaktualizowane",highlight_remove_success:"Pod힄wietlenie usuni휌te",highlight_villages:"Wioski",highlight_players:"Gracze",highlight_tribes:"Plemiona",highlight_add_error_exists:"Pod힄wietlenie ju탉 istnieje!",highlight_add_error_no_entry:"Najpierw wybierz gracza/plemi휌!",highlight_add_error_invalid_color:"Nieprawid흢owy kolor!",village:"Wioska",player:"Gracz",tribe:"Plemi휌",color:"Kolor (Hex)",tooltip_pick_color:"Wybierz kolor",misc:"Pozosta흢e ustawienia",colors_misc:"Pozosta흢e kolory",colors_diplomacy:"Dyplomacja",settings_saved:"Ustawienia zapisane!",settings_right_click_action:"Wioska - dzia흢anie prawym przyciskiem myszy",highlight_village:"Pod힄wietl wiosk휌",highlight_player:"Pod힄wietl gracza",highlight_tribe:"Pod힄wietl plemie",settings_show_floating_minimap:"Poka탉 p흢ywaj훳c훳 minimap휌",settings_show_cross:"Poka탉 krzy탉 pozycjonowania",settings_show_demarcations:"Poka탉 granice prowincji/kontynent처w",settings_show_barbarians:"Poka탉 wioski barbarzy흦skie",settings_show_ghost_villages:"Poka탉 nieza흢adowane wioski",settings_show_only_custom_highlights:"Poka탉 tylko w흢asne pod힄wietlenia",settings_highlight_own:"Pod힄wietl w흢asne wioski",settings_highlight_selected:"Pod힄wietl wybran훳 wiosk휌",settings_highlight_diplomacy:"Auto pod힄wietlanie dyplomacji plemiennej",settings_colors_background:"T흢o",settings_colors_province:"Granice prowincji",settings_colors_continent:"Granice kr처lestw",settings_colors_quick_highlight:"Szybkie pod힄wietlenie",settings_colors_tribe:"W흢asne plemie",settings_colors_player:"W흢asne wioski",settings_colors_selected:"Wybrana wioska",settings_colors_ghost:"Nie za흢adowane wioski",settings_colors_ally:"Sojusznik",settings_colors_pna:"PON",settings_colors_enemy:"Wr처g",settings_colors_other:"Inne",settings_colors_barbarian:"Barbarzy흦skie",settings_colors_cross:"Krzy탉 pozycjonowania",settings_reset:"Ustawienia zresetowane",tooltip_village:"Wioska",tooltip_village_points:"Punkty wioski",tooltip_player:"Nazwa gracza",tooltip_player_points:"Punkty gracza",tooltip_tribe:"Plemi휌",tooltip_tribe_points:"Punkty plemienia",tooltip_province:"Nazwa prowincji",no_highlights:"Brak utworzonych pod힄wietle흦",reset_confirm_title:"Resetuj ustawienia",reset_confirm_text:"Wszystkie ustawienia zostan훳 przywr처cone do domy힄lnych.",reset_confirm_highlights_text:"Jak r처wnie탉 wszystkie pod힄wietlenia zostan훳 usuni휌te."}},pt_br:{minimap:{minimap:"Minimapa",highlights:"Marca챌천es",add:"Adicionar marca챌찾o",remove:"Remover marca챌찾o",placeholder_search:"Procurar jogador/tribo",highlight_add_success:"Marca챌찾o adicionada",highlight_add_error:"Especifique uma marca챌찾o primeiro",highlight_update_success:"Marca챌찾o atualizada",highlight_remove_success:"Marca챌찾o removida",highlight_villages:"Aldeias",highlight_players:"Jogadores",highlight_tribes:"Tribos",highlight_add_error_exists:"Marca챌찾o j찼 existe!",highlight_add_error_no_entry:"Selecione uma jogador/tribo primeiro!",highlight_add_error_invalid_color:"Cor inv찼lida!",village:"Aldeia",player:"Jogador",tribe:"Tribo",color:"Cor (Hex)",tooltip_pick_color:"Selecione uma cor",misc:"Configura챌천es diversas",colors_misc:"Cores diversas",colors_diplomacy:"Cores da diplomacia",settings_saved:"Configura챌천es salvas!",settings_right_click_action:"A챌찾o de clique direito na aldeia",highlight_village:"Marcar aldeia",highlight_player:"Marcar jogador",highlight_tribe:"Marcar tribo",settings_show_floating_minimap:"Mostrar minimapa flutuante",settings_show_cross:"Mostrar marca챌찾o da posi챌찾o atual",settings_show_demarcations:"Mostrar demarca챌천es das provincias/continentes",settings_show_barbarians:"Mostrar aldeias b찼rbaras",settings_show_ghost_villages:"Mostrar aldeias n찾o carregadas",settings_show_only_custom_highlights:"Mostrar apenas marca챌천es manuais",settings_highlight_own:"Marcar pr처prias aldeias",settings_highlight_selected:"Marcar aldeia selecionada",settings_highlight_diplomacy:"Marca챌찾o autom찼tica baseado na diplomacia",settings_colors_background:"Fundo do minimapa",settings_colors_province:"Demarca챌찾o da provincia",settings_colors_continent:"Demarca챌찾o do continente",settings_colors_quick_highlight:"Marca챌찾o r찼pida",settings_colors_tribe:"Pr처pria tribo",settings_colors_player:"Aldeias pr처prias",settings_colors_selected:"Aldeia selecionada",settings_colors_ghost:"Aldeias n찾o carregadas",settings_colors_ally:"Aliados",settings_colors_pna:"PNA",settings_colors_enemy:"Inimigos",settings_colors_other:"Outros",settings_colors_barbarian:"Aldeias B찼rbaras",settings_colors_cross:"Cruz da posi챌찾o",settings_reset:"Configura챌천es resetadas",tooltip_village:"Aldeia",tooltip_village_points:"Pontos da aldeia",tooltip_player:"Nome do jogador",tooltip_player_points:"Pontos do jogador",tooltip_tribe:"Nome da Tribo",tooltip_tribe_points:"Pontos da tribo",tooltip_province:"Nome da prov챠ncia",no_highlights:"Nenhuma marca챌찾o criada",reset_confirm_title:"Resetar configura챌천es",reset_confirm_text:"Todas as configura챌천es ser찾o resetas para as configura챌천es padr천es.",reset_confirm_highlights_text:"Todas marca챌천es tamb챕m ser찾o deletadas"}}}),i.init(),a(),i.run()})}),define("two/minimap/ui",["two/ui","two/ui/button","two/minimap","two/minimap/actionTypes","two/minimap/settingsMap","two/minimap/settings","two/utils","two/EventScope","helper/util","struct/MapData","cdn","conf/colors"],function(t,n,d,u,g,p,m,E,v,f,T,b){var h,A,S,w,O,I,R,x,C,L={MINIMAP:"minimap",HIGHLIGHTS:"highlights",SETTINGS:"settings"},y=L.MINIMAP,N=[],M={},D={character:{},tribe:{}},G=function(e){h.selectedTab=e,e===L.MINIMAP?d.enableRendering():d.disableRendering()},P=function(){Object.keys(h.highlights.character).forEach(function(e){var t,i;e in D.character||(t={id:e},i=function(t){D.character[e]=t.character_name},o.emit(l.CHAR_GET_PROFILE,{character_id:t.id},i))}),Object.keys(h.highlights.tribe).forEach(function(e){var t,i;e in D.tribe||(t={id:e},i=function(t){D.tribe[e]=t.name},o.emit(l.TRIBE_GET_PROFILE,{tribe_id:t.id},i))})},k=function(e,t){C=setTimeout(function(){var e,i,a,n;R.appendChild(I),I.classList.remove("ng-hide"),O.tt.name=t.village.name,O.tt.x=t.village.x,O.tt.y=t.village.y,O.tt.province_name=t.village.province_name,O.tt.points=t.village.points,O.tt.character_name=t.village.character_name||"-",O.tt.character_points=t.village.character_points||0,O.tt.tribe_name=t.village.tribe_name||"-",O.tt.tribe_tag=t.village.tribe_tag||"-",O.tt.tribe_points=t.village.tribe_points||0,O.tt.morale=t.village.morale||0,O.tt.position={},O.tt.position.x=t.event.pageX+50,O.tt.position.y=t.event.pageY+50,O.tt.visible=!0,i=I.getBoundingClientRect(),e=R.getBoundingClientRect(),M.x=i.width+50,M.y=i.height+50,a=O.tt.position.y+M.y>e.top+e.height,n=O.tt.position.x+M.x>e.width,a&&(O.tt.position.y-=50),I.classList.toggle("left",n),I.classList.toggle("top",a)},50)},U=function(){clearTimeout(C),O.tt.visible=!1,I.classList.add("ng-hide"),x.appendChild(I)},q=function(e,t,a,n){var o,l,r=i.$new(),s=!0;r.colorPalettes=b.palette,"setting"===e?(l=t,o=h.settings[l],s=!1,r.submit=function(){h.settings[l]="#"+r.selectedColor,r.closeWindow()},r.reset=function(){h.settings[l]=g[l].default,r.closeWindow()}):"add_custom_highlight"===e?(o=h.addHighlightColor,r.submit=function(){h.addHighlightColor="#"+r.selectedColor,r.closeWindow()}):"edit_custom_highlight"===e&&(o=h.highlights[t][a],r.submit=function(){d.addHighlight({id:a,type:t},"#"+r.selectedColor),r.closeWindow()}),r.selectedColor=o.replace("#",""),r.hasCustomColors=!0,r.hideReset=s,r.finishAction=function(e,t){r.selectedColor=t},c.getModal("modal_color_palette",r)},V=function(){d.addHighlight(h.selectedHighlight,h.addHighlightColor)},j=function(){var e=angular.copy(h.settings);e[p.RIGHT_CLICK_ACTION]=e[p.RIGHT_CLICK_ACTION].value,d.updateSettings(e)},B=function(e){var t=angular.copy(e);return t[p.RIGHT_CLICK_ACTION]={value:t[p.RIGHT_CLICK_ACTION],name:_("i18n")(t[p.RIGHT_CLICK_ACTION],i.loc.ale,"minimap")},t},H=function(){var e=i.$new();e.title=_("i18n")("reset_confirm_title",i.loc.ale,"minimap"),e.text=_("i18n")("reset_confirm_text",i.loc.ale,"minimap"),e.submitText=_("i18n")("reset",i.loc.ale,"common"),e.cancelText=_("i18n")("cancel",i.loc.ale,"common"),e.showQuestionMarkIcon=!0,e.switchColors=!0,e.submit=function(){d.resetSettings(),e.closeWindow()},e.cancel=function(){e.closeWindow()},c.getModal("modal_attention",e)},z=function(){return Object.keys(h.highlights.character).length+Object.keys(h.highlights.tribe).length},Y=function(e,t){("character"===e?s.openCharacterProfile:s.openTribeProfile)(t)},F={addHighlightAutoCompleteSelect:function(e){h.selectedHighlight={id:e.id,type:e.type,name:e.name}},settingsReset:function(){h.settings=B(d.getSettings()),m.emitNotif("success",_("i18n")("settings_reset",i.loc.ale,"minimap"))},settingsSave:function(){m.emitNotif("success",_("i18n")("settings_saved",i.loc.ale,"minimap"))},highlightUpdate:function(e){P()},highlightAddErrorExists:function(e){m.emitNotif("error",_("i18n")("highlight_add_error_exists",i.loc.ale,"minimap"))},highlightAddErrorNoEntry:function(e){m.emitNotif("error",_("i18n")("highlight_add_error_no_entry",i.loc.ale,"minimap"))},highlightAddErrorInvalidColor:function(e){m.emitNotif("error",_("i18n")("highlight_add_error_invalid_color",i.loc.ale,"minimap"))},onMouseLeaveMinimap:function(t){t=new MouseEvent("mouseup",{view:e,bubbles:!0,cancelable:!0});U(),S.dispatchEvent(t)},onMouseMoveMinimap:function(e){U(),S.style.cursor="url("+T.getPath("/img/cursor/grab_pushed.png")+"), move"},onMouseStopMoveMinimap:function(e){S.style.cursor=""}},Q=function(){(h=i.$new()).textObject="minimap",h.textObjectCommon="common",h.SETTINGS=p,h.TAB_TYPES=L,h.selectedTab=y,h.selectedHighlight=!1,h.addHighlightColor="#000000",h.highlights=d.getHighlights(),h.highlightNames=D,h.settings=B(d.getSettings()),h.actionTypes=N,h.autoComplete={type:["character","tribe","village"],placeholder:_("i18n")("placeholder_search",i.loc.ale,"minimap"),onEnter:F.addHighlightAutoCompleteSelect},h.selectTab=G,h.openColorPalette=q,h.addCustomHighlight=V,h.removeHighlight=d.removeHighlight,h.saveSettings=j,h.resetSettings=H,h.highlightsCount=z,h.openProfile=Y,eventScope=new E("twoverflow_minimap_window"),eventScope.register(r.MINIMAP_SETTINGS_RESET,F.settingsReset),eventScope.register(r.MINIMAP_SETTINGS_SAVE,F.settingsSave),eventScope.register(r.GROUPS_VILLAGES_CHANGED,F.highlightUpdate,!0),eventScope.register(r.MINIMAP_HIGHLIGHT_ADD_ERROR_EXISTS,F.highlightAddErrorExists),eventScope.register(r.MINIMAP_HIGHLIGHT_ADD_ERROR_NO_ENTRY,F.highlightAddErrorNoEntry),eventScope.register(r.MINIMAP_HIGHLIGHT_ADD_ERROR_INVALID_COLOR,F.highlightAddErrorInvalidColor),eventScope.register(r.MINIMAP_VILLAGE_HOVER,k),eventScope.register(r.MINIMAP_VILLAGE_BLUR,U),eventScope.register(r.MINIMAP_MOUSE_LEAVE,F.onMouseLeaveMinimap),eventScope.register(r.MINIMAP_START_MOVE,F.onMouseMoveMinimap),eventScope.register(r.MINIMAP_STOP_MOVE,F.onMouseStopMoveMinimap),c.getScreenWithInjectedScope("!twoverflow_minimap_window",h),P(),(w=document.querySelector("#two-minimap .minimap-container")).appendChild(A),w.appendChild(S),d.enableRendering()};return function(){var e;for(e in O=a.getSharedData("MapController"),(A=document.createElement("canvas")).className="minimap",(S=document.createElement("canvas")).className="cross",d.setViewport(A),d.setCross(S),I=document.querySelector("#map-tooltip"),R=document.querySelector("#wrapper"),x=document.querySelector("#map"),u)N.push({value:u[e],name:_("i18n")(u[e],i.loc.ale,"minimap")});new n("Minimap",{classHover:!1,classBlur:!1,onClick:function(){var e=d.getMapPosition();if(!e)return!1;d.setCurrentPosition(e[0],e[1]),Q()}}),t.addTemplate("twoverflow_minimap_window",'<div id="two-minimap" class="win-content two-window"><header class="win-head"><h2>Minimap</h2><ul class="list-btn"><li><a href="#" class="size-34x34 btn-red icon-26x26-close" ng-click="closeWindow()"></a></li></ul></header><div class="win-main small-select" scrollbar=""><div class="tabs tabs-bg"><div class="tabs-three-col"><div class="tab" ng-click="selectTab(TAB_TYPES.MINIMAP)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.MINIMAP}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.MINIMAP}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.MINIMAP}">{{ \'minimap\' | i18n:loc.ale:textObject }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.HIGHLIGHTS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.HIGHLIGHTS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.HIGHLIGHTS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.HIGHLIGHTS}">{{ \'highlights\' | i18n:loc.ale:textObject }}</a></div></div></div><div class="tab" ng-click="selectTab(TAB_TYPES.SETTINGS)" ng-class="{\'tab-active\': selectedTab == TAB_TYPES.SETTINGS}"><div class="tab-inner"><div ng-class="{\'box-border-light\': selectedTab === TAB_TYPES.SETTINGS}"><a href="#" ng-class="{\'btn-icon btn-orange\': selectedTab !== TAB_TYPES.SETTINGS}">{{ \'settings\' | i18n:loc.ale:textObjectCommon }}</a></div></div></div></div></div><div ng-show="selectedTab === TAB_TYPES.MINIMAP" class="minimap-container"></div><div class="box-paper" ng-class="{\'footer\': selectedTab == TAB_TYPES.SETTINGS}"><div class="scroll-wrap"><div ng-show="selectedTab == TAB_TYPES.HIGHLIGHTS"><h5 class="twx-section">{{ \'add\' | i18n:loc.ale:textObject }}</h5><table class="tbl-border-light tbl-striped add-highlight"><colgroup><col width="40%"><col><col width="4%"><col width="4%"></colgroup><tbody><tr><td><div auto-complete="autoComplete"></div></td><td class="text-center"><span ng-show="selectedHighlight" class="icon-26x26-rte-{{ selectedHighlight.type }}"></span> {{ selectedHighlight.name }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'add_custom_highlight\')" ng-style="{\'background-color\': addHighlightColor }" tooltip="" tooltip-content="{{ \'tooltip_pick_color\' | i18n:loc.ale:textObject }}"></div></td><td><span class="btn-orange icon-26x26-plus" ng-click="addCustomHighlight()" tooltip="" tooltip-content="{{ \'add\' | i18n:loc.ale:textObject }}"></span></td></tr></tbody></table><h5 class="twx-section">{{ TAB_TYPES.HIGHLIGHTS | i18n:loc.ale:textObject }}</h5><p class="text-center" ng-show="!highlightsCount()">{{ \'no_highlights\' | i18n:loc.ale:textObject }}</p><table class="tbl-border-light tbl-striped" ng-show="highlightsCount()"><colgroup><col width="4%"><col><col width="4%"><col width="4%"></colgroup><tbody><tr ng-repeat="(id, color) in highlights.character"><td><span class="icon-26x26-rte-character"></span></td><td><span class="open-profile" ng-click="openProfile(\'character\', id)">{{ highlightNames.character[id] }}</span></td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'edit_custom_highlight\', \'character\', id)" ng-style="{\'background-color\': color }"></div></td><td><a class="size-26x26 btn-red icon-20x20-close" ng-click="removeHighlight(\'character\', id)" tooltip="" tooltip-content="{{ \'remove\' | i18n:loc.ale:textObject }}"></a></td></tr><tr ng-repeat="(id, color) in highlights.tribe"><td><span class="icon-26x26-rte-tribe"></span></td><td><span class="open-profile" ng-click="openProfile(\'tribe\', id)">{{ highlightNames.tribe[id] }}</span></td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'edit_custom_highlight\', \'tribe\', id)" ng-style="{\'background-color\': color }"></div></td><td><a class="size-26x26 btn-red icon-20x20-close" ng-click="removeHighlight(\'tribe\', id)" tooltip="" tooltip-content="{{ \'remove\' | i18n:loc.ale:textObject }}"></a></td></tr></tbody></table></div><div ng-show="selectedTab == TAB_TYPES.SETTINGS"><table class="tbl-border-light tbl-striped"><colgroup><col width="60%"><col><col width="56px"></colgroup><tbody><tr><th colspan="3">{{ \'misc\' | i18n:loc.ale:textObject }}</th></tr><tr><td>{{ \'settings_right_click_action\' | i18n:loc.ale:textObject }}</td><td colspan="3"><div select="" list="actionTypes" selected="settings[SETTINGS.RIGHT_CLICK_ACTION]" drop-down="true"></div></td></tr><tr><td colspan="2">{{ \'settings_show_cross\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.SHOW_CROSS]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_show_demarcations\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.SHOW_DEMARCATIONS]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_show_barbarians\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.SHOW_BARBARIANS]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_show_ghost_villages\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.SHOW_GHOST_VILLAGES]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_show_only_custom_highlights\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.SHOW_ONLY_CUSTOM_HIGHLIGHTS]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_highlight_own\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.HIGHLIGHT_OWN]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_highlight_selected\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.HIGHLIGHT_SELECTED]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr><tr><td colspan="2">{{ \'settings_highlight_diplomacy\' | i18n:loc.ale:textObject }}</td><td><div switch-slider="" value="settings[SETTINGS.HIGHLIGHT_DIPLOMACY]" vertical="false" size="\'56x28\'" enabled="true"></div></td></tr></tbody></table><table class="tbl-border-light tbl-striped"><colgroup><col><col width="29px"></colgroup><tbody><tr><th colspan="2">{{ \'colors_misc\' | i18n:loc.ale:textObject }}</th></tr><tr><td>{{ \'settings_colors_background\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_BACKGROUND)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_BACKGROUND] }"></div></td></tr><tr><td>{{ \'settings_colors_province\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_PROVINCE)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_PROVINCE] }"></div></td></tr><tr><td>{{ \'settings_colors_continent\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_CONTINENT)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_CONTINENT] }"></div></td></tr><tr><td>{{ \'settings_colors_cross\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_CROSS)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_CROSS] }"></div></td></tr><tr><td>{{ \'settings_colors_quick_highlight\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_QUICK_HIGHLIGHT)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_QUICK_HIGHLIGHT] }"></div></td></tr><tr><td>{{ \'settings_colors_ghost\' | i18n:loc.ale:textObject }}</td><td><div class="color-container box-border-dark" ng-click="openColorPalette(\'setting\', SETTINGS.COLOR_GHOST)" ng-style="{\'background-color\': settings[SETTINGS.COLOR_GHOST] }"></div></td></tr></tbody></table></div></div></div></div><footer class="win-foot" ng-show="selectedTab === TAB_TYPES.SETTINGS"><ul class="list-btn list-center"><li><a href="#" class="btn-border btn-red" ng-click="resetSettings()">{{ \'reset\' | i18n:loc.ale:textObjectCommon }}</a></li><li><a href="#" class="btn-border btn-green" ng-click="saveSettings()">{{ \'save\' | i18n:loc.ale:textObjectCommon }}</a></li></ul></footer></div>'),t.addStyle("#map-tooltip{z-index:1000}#two-minimap .minimap{position:absolute;left:0;top:38px;z-index:5}#two-minimap .cross{position:absolute;left:0;top:38px;z-index:6}#two-minimap .box-paper:not(.footer) .scroll-wrap{margin-bottom:40px}#two-minimap span.select-wrapper{width:100%}#two-minimap .add-highlight input{width:100%}#two-minimap .open-profile:hover{font-weight:bold;text-shadow:-1px 1px 0 #e0cc97}")}}),define("two/ui",["conf/conf","conf/cdn"],function(e,t){var a={},n={},o=document.querySelector("head"),l=injector.get("httpService"),r=injector.get("templateManagerService"),s=injector.get("$templateCache");return r.load=function(a,o,r){var c,d=function(e,t,a,n){s.put(c.substr(1),e),angular.isFunction(o)&&o(e,t,a,n),i.$$phase||i.$apply()};c=0!==a.indexOf("!")?e.TEMPLATE_PATH_EXT.join(a):a.substr(1),s.get(c.substr(1))?d(s.get(c.substr(1)),304):t.versionMap[c]?l.get(c,d,function(e,t,i,a){angular.isFunction(r)&&r(e,t,i,a)}):d(n[c],304)},a.addTemplate=function(e,t){n[e]=t},a.addStyle=function(e){var t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(e)),o.appendChild(t)},a}),define("two/ui/button",[],function(){function e(e,t){this.options=t=angular.merge({label:e,className:"",classHover:"expand-button",classBlur:"contract-button",tooltip:!1,onClick:function(){}},t),this.buildWrapper(),this.appendButton();var a=this.$elem,n=a.querySelector(".label"),o=a.querySelector(".quickview");return t.classHover&&a.addEventListener("mouseenter",function(){a.classList.add(t.classHover),a.classList.remove(t.classBlur),n.style.display="none",o.style.display=""}),t.classBlur&&a.addEventListener("mouseleave",function(){a.classList.add(t.classBlur),a.classList.remove(t.classHover),o.style.display="none",n.style.display=""}),t.tooltip&&(a.addEventListener("mouseenter",function(e){i.$broadcast(r.TOOLTIP_SHOW,"twoverflow-tooltip",t.tooltip,!0,e)}),a.addEventListener("mouseleave",function(){i.$broadcast(r.TOOLTIP_HIDE,"twoverflow-tooltip")})),t.onClick&&a.addEventListener("click",t.onClick),this}return e.prototype.updateQuickview=function(e){this.$elem.querySelector(".quickview").innerHTML=e},e.prototype.hover=function(e){this.$elem.addEventListener("mouseenter",e)},e.prototype.click=function(e){this.$elem.addEventListener("click",e)},e.prototype.buildWrapper=function(){var e=document.getElementById("two-bar");e||((e=document.createElement("div")).id="two-bar",document.querySelector("#wrapper").appendChild(e)),this.$wrapper=e},e.prototype.appendButton=function(){var e=document.createElement("div");e.innerHTML='<div class="btn-border btn-green button '+this.options.className+'"><div class="top-left"></div><div class="top-right"></div><div class="middle-top"></div><div class="middle-bottom"></div><div class="middle-left"></div><div class="middle-right"></div><div class="bottom-left"></div><div class="bottom-right"></div><div class="label">'+this.options.label+'</div><div class="quickview"></div></div>';var t=e.children[0];this.$wrapper.appendChild(t),this.$elem=t},e.prototype.destroy=function(){this.$elem.remove()},e}),require(["two/ui"],function(e){e.addStyle(".two-window a.select-handler{-webkit-box-shadow:none;box-shadow:none}.two-window .small-select a.select-handler{height:22px;line-height:22px}.two-window .small-select a.select-button{height:22px}.two-window input::placeholder{color:rgba(255,243,208,0.7)}.two-window .green{color:#07770b}.two-window .red{color:#770707}.two-window .blue{color:#074677}#toolbar-left{height:calc(100% - 390px) !important;top:275px !important}#two-bar{position:absolute;top:105px;left:5px;margin-bottom:7px;z-index:10;width:100px}#two-bar .button{white-space:nowrap;position:relative;top:-17px;left:0px;min-width:70px;height:24px;padding:0 3px}#two-bar .label,#two-bar .quickview{margin:5px 0;font-size:12px}#two-bar .quickview{display:none}#wrapper.window-open #two-bar{left:719px}#wrapper.window-open.window-fullsize #two-bar{display:none}")})}(this);
//# sourceMappingURL=tw2overflow.map
